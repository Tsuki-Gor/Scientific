<!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'><style type='text/css'>html {overflow-x: initial !important;}</style>
<style type='text/css'  id="style-base">:root { --bg-color: #ffffff; --text-color: #333333; --select-text-bg-color: #B5D6FC; --select-text-font-color: auto; --monospace: "Lucida Console",Consolas,"Courier",monospace; --title-bar-height: 20px; }
.mac-os-11 { --title-bar-height: 28px; }
html { font-size: 14px; background-color: var(--bg-color); color: var(--text-color); font-family: "Helvetica Neue", Helvetica, Arial, "Segoe UI Emoji", "SF Pro", sans-serif; -webkit-font-smoothing: antialiased; }
h1, h2, h3, h4, h5 { white-space: pre-wrap; }
body { margin: 0px; padding: 0px; height: auto; inset: 0px; font-size: 1rem; line-height: 1.42857; overflow-x: hidden; background: inherit; }
iframe { margin: auto; }
a.url { word-break: break-all; }
a:active, a:hover { outline: 0px; }
.in-text-selection, ::selection { text-shadow: none; background: var(--select-text-bg-color); color: var(--select-text-font-color); }
#write { margin: 0px auto; height: auto; width: inherit; word-break: normal; overflow-wrap: break-word; position: relative; white-space: normal; overflow-x: visible; padding-top: 36px; }
#write.first-line-indent p { text-indent: 2em; }
#write.first-line-indent li p, #write.first-line-indent p *, #write.first-line-indent svg * { text-indent: 0px; }
#write.first-line-indent li { margin-left: 2em; }
.for-image #write { padding-left: 8px; padding-right: 8px; }
body.typora-export { padding-left: 30px; padding-right: 30px; }
.typora-export .footnote-line, .typora-export li, .typora-export p { white-space: pre-wrap; }
.typora-export .task-list-item input { pointer-events: none; }
@media screen and (max-width: 500px) {
  body.typora-export { padding-left: 0px; padding-right: 0px; }
  #write { padding-left: 20px; padding-right: 20px; }
}
#write li > figure:last-child { margin-bottom: 0.5rem; }
#write ol, #write ul { position: relative; }
img { max-width: 100%; vertical-align: middle; image-orientation: from-image; }
button, input, select, textarea { color: inherit; font: inherit; }
input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }
*, ::after, ::before { box-sizing: border-box; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p, #write pre { width: inherit; position: relative; }
#write svg h1, #write svg h2, #write svg h3, #write svg h4, #write svg h5, #write svg h6, #write svg p { position: static; white-space: nowrap; overflow: visible; }
foreignobject { overflow: visible; }
p { line-height: inherit; }
h1, h2, h3, h4, h5, h6 { break-after: avoid-page; break-inside: avoid; orphans: 4; }
p { orphans: 4; }
li p { orphans: 1; }
h1 { font-size: 2rem; }
h2 { font-size: 1.8rem; }
h3 { font-size: 1.6rem; }
h4 { font-size: 1.4rem; }
h5 { font-size: 1.2rem; }
h6 { font-size: 1rem; }
.md-math-block, .md-rawblock, h1, h2, h3, h4, h5, h6, p { margin-top: 1rem; margin-bottom: 1rem; }
.hidden { display: none; }
.md-blockmeta { color: rgb(204, 204, 204); font-weight: 700; font-style: italic; }
a { cursor: pointer; }
sup.md-footnote { padding: 2px 4px; background-color: rgba(238, 238, 238, 0.7); color: rgb(85, 85, 85); border-radius: 4px; cursor: pointer; }
sup.md-footnote a, sup.md-footnote a:hover { color: inherit; text-transform: inherit; text-decoration: inherit; }
#write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; }
figure { overflow-x: auto; margin: 1.2em 0px; max-width: calc(100% + 16px); padding: 0px; }
figure > table { margin: 0px; }
thead, tr { break-inside: avoid; break-after: auto; }
thead { display: table-header-group; }
table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; break-inside: auto; text-align: left; }
table.md-table td { min-width: 32px; }
.CodeMirror-gutters { border-right: 0px; background-color: inherit; }
.CodeMirror-linenumber { user-select: none; }
.CodeMirror { text-align: left; }
.CodeMirror-placeholder { opacity: 0.3; }
.CodeMirror pre { padding: 0px 4px; }
.CodeMirror-lines { padding: 0px; }
div.hr:focus { cursor: none; }
#write pre { white-space: pre-wrap; }
#write.fences-no-line-wrapping pre { white-space: pre; }
#write pre.ty-contain-cm { white-space: normal; }
.CodeMirror-gutters { margin-right: 4px; }
.md-fences { font-size: 0.9rem; display: block; break-inside: avoid; text-align: left; overflow: visible; white-space: pre; background: inherit; position: relative !important; }
.md-fences-adv-panel { width: 100%; margin-top: 10px; text-align: center; padding-top: 0px; padding-bottom: 8px; overflow-x: auto; }
#write .md-fences.mock-cm { white-space: pre-wrap; }
.md-fences.md-fences-with-lineno { padding-left: 0px; }
#write.fences-no-line-wrapping .md-fences.mock-cm { white-space: pre; overflow-x: auto; }
.md-fences.mock-cm.md-fences-with-lineno { padding-left: 8px; }
.CodeMirror-line, twitterwidget { break-inside: avoid; }
svg { break-inside: avoid; }
.footnotes { opacity: 0.8; font-size: 0.9rem; margin-top: 1em; margin-bottom: 1em; }
.footnotes + .footnotes { margin-top: 0px; }
.md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; background: 0px 0px; text-decoration: none; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; -webkit-tap-highlight-color: transparent; line-height: normal; font-weight: 400; text-align: left; box-sizing: content-box; direction: ltr; }
li div { padding-top: 0px; }
blockquote { margin: 1rem 0px; }
li .mathjax-block, li p { margin: 0.5rem 0px; }
li blockquote { margin: 1rem 0px; }
li { margin: 0px; position: relative; }
blockquote > :last-child { margin-bottom: 0px; }
blockquote > :first-child, li > :first-child { margin-top: 0px; }
.footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; white-space: normal; }
#write .footnote-line { white-space: pre-wrap; }
@media print {
  body, html { border: 1px solid transparent; height: 99%; break-after: avoid; break-before: avoid; font-variant-ligatures: no-common-ligatures; }
  #write { margin-top: 0px; border-color: transparent !important; padding-top: 0px !important; padding-bottom: 0px !important; }
  .typora-export * { -webkit-print-color-adjust: exact; }
  .typora-export #write { break-after: avoid; }
  .typora-export #write::after { height: 0px; }
  .is-mac table { break-inside: avoid; }
  #write > p:nth-child(1) { margin-top: 0px; }
  .typora-export-show-outline .typora-export-sidebar { display: none; }
  figure { overflow-x: visible; }
}
.footnote-line { margin-top: 0.714em; font-size: 0.7em; }
a img, img a { cursor: pointer; }
pre.md-meta-block { font-size: 0.8rem; min-height: 0.8rem; white-space: pre-wrap; background: rgb(204, 204, 204); display: block; overflow-x: hidden; }
p > .md-image:only-child:not(.md-img-error) img, p > img:only-child { display: block; margin: auto; }
#write.first-line-indent p > .md-image:only-child:not(.md-img-error) img { left: -2em; position: relative; }
p > .md-image:only-child { display: inline-block; width: 100%; }
#write .MathJax_Display { margin: 0.8em 0px 0px; }
.md-math-block { width: 100%; }
.md-math-block:not(:empty)::after { display: none; }
.MathJax_ref { fill: currentcolor; }
[contenteditable="true"]:active, [contenteditable="true"]:focus, [contenteditable="false"]:active, [contenteditable="false"]:focus { outline: 0px; box-shadow: none; }
.md-task-list-item { position: relative; list-style-type: none; }
.task-list-item.md-task-list-item { padding-left: 0px; }
.md-task-list-item > input { position: absolute; top: 0px; left: 0px; margin-left: -1.2em; margin-top: calc(1em - 10px); border: none; }
.math { font-size: 1rem; }
.md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-radius: 10px; }
.md-toc-content { position: relative; margin-left: 0px; }
.md-toc-content::after, .md-toc::after { display: none; }
.md-toc-item { display: block; color: rgb(65, 131, 196); }
.md-toc-item a { text-decoration: none; }
.md-toc-inner:hover { text-decoration: underline; }
.md-toc-inner { display: inline-block; cursor: pointer; }
.md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: 700; }
.md-toc-h2 .md-toc-inner { margin-left: 2em; }
.md-toc-h3 .md-toc-inner { margin-left: 4em; }
.md-toc-h4 .md-toc-inner { margin-left: 6em; }
.md-toc-h5 .md-toc-inner { margin-left: 8em; }
.md-toc-h6 .md-toc-inner { margin-left: 10em; }
@media screen and (max-width: 48em) {
  .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }
  .md-toc-h4 .md-toc-inner { margin-left: 5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }
  .md-toc-h6 .md-toc-inner { margin-left: 8em; }
}
a.md-toc-inner { font-size: inherit; font-style: inherit; font-weight: inherit; line-height: inherit; }
.footnote-line a:not(.reversefootnote) { color: inherit; }
.reversefootnote { font-family: ui-monospace, sans-serif; }
.md-attr { display: none; }
.md-fn-count::after { content: "."; }
code, pre, samp, tt { font-family: var(--monospace); }
kbd { margin: 0px 0.1em; padding: 0.1em 0.6em; font-size: 0.8em; color: rgb(36, 39, 41); background: rgb(255, 255, 255); border: 1px solid rgb(173, 179, 185); border-radius: 3px; box-shadow: rgba(12, 13, 14, 0.2) 0px 1px 0px, rgb(255, 255, 255) 0px 0px 0px 2px inset; white-space: nowrap; vertical-align: middle; }
.md-comment { color: rgb(162, 127, 3); opacity: 0.6; font-family: var(--monospace); }
code { text-align: left; vertical-align: initial; }
a.md-print-anchor { white-space: pre !important; border-width: initial !important; border-style: none !important; border-color: initial !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: 0px !important; background: 0px 0px !important; text-decoration: initial !important; text-shadow: initial !important; }
.os-windows.monocolor-emoji .md-emoji { font-family: "Segoe UI Symbol", sans-serif; }
.md-diagram-panel > svg { max-width: 100%; }
[lang="flow"] svg, [lang="mermaid"] svg { max-width: 100%; height: auto; }
[lang="mermaid"] .node text { font-size: 1rem; }
table tr th { border-bottom: 0px; }
video { max-width: 100%; display: block; margin: 0px auto; }
iframe { max-width: 100%; width: 100%; border: none; }
.highlight td, .highlight tr { border: 0px; }
mark { background: rgb(255, 255, 0); color: rgb(0, 0, 0); }
.md-html-inline .md-plain, .md-html-inline strong, mark .md-inline-math, mark strong { color: inherit; }
.md-expand mark .md-meta { opacity: 0.3 !important; }
mark .md-meta { color: rgb(0, 0, 0); }
@media print {
  .typora-export h1, .typora-export h2, .typora-export h3, .typora-export h4, .typora-export h5, .typora-export h6 { break-inside: avoid; }
}
.md-diagram-panel .messageText { stroke: none !important; }
.md-diagram-panel .start-state { fill: var(--node-fill); }
.md-diagram-panel .edgeLabel rect { opacity: 1 !important; }
.md-fences.md-fences-math { font-size: 1em; }
.md-fences-advanced:not(.md-focus) { padding: 0px; white-space: nowrap; border: 0px; }
.md-fences-advanced:not(.md-focus) { background: inherit; }
.mermaid-svg { margin: auto; }
.typora-export-show-outline .typora-export-content { max-width: 1440px; margin: auto; display: flex; flex-direction: row; }
.typora-export-sidebar { width: 300px; font-size: 0.8rem; margin-top: 80px; margin-right: 18px; }
.typora-export-show-outline #write { --webkit-flex: 2; flex: 2 1 0%; }
.typora-export-sidebar .outline-content { position: fixed; top: 0px; max-height: 100%; overflow: hidden auto; padding-bottom: 30px; padding-top: 60px; width: 300px; }
@media screen and (max-width: 1024px) {
  .typora-export-sidebar, .typora-export-sidebar .outline-content { width: 240px; }
}
@media screen and (max-width: 800px) {
  .typora-export-sidebar { display: none; }
}
.outline-content li, .outline-content ul { margin-left: 0px; margin-right: 0px; padding-left: 0px; padding-right: 0px; list-style: none; overflow-wrap: anywhere; }
.outline-content ul { margin-top: 0px; margin-bottom: 0px; }
.outline-content strong { font-weight: 400; }
.outline-expander { width: 1rem; height: 1.42857rem; position: relative; display: table-cell; vertical-align: middle; cursor: pointer; padding-left: 4px; }
.outline-expander::before { content: ""; position: relative; font-family: Ionicons; display: inline-block; font-size: 8px; vertical-align: middle; }
.outline-item { padding-top: 3px; padding-bottom: 3px; cursor: pointer; }
.outline-expander:hover::before { content: ""; }
.outline-h1 > .outline-item { padding-left: 0px; }
.outline-h2 > .outline-item { padding-left: 1em; }
.outline-h3 > .outline-item { padding-left: 2em; }
.outline-h4 > .outline-item { padding-left: 3em; }
.outline-h5 > .outline-item { padding-left: 4em; }
.outline-h6 > .outline-item { padding-left: 5em; }
.outline-label { cursor: pointer; display: table-cell; vertical-align: middle; text-decoration: none; color: inherit; }
.outline-label:hover { text-decoration: underline; }
.outline-item:hover { border-color: rgb(245, 245, 245); background-color: var(--item-hover-bg-color); }
.outline-item:hover { margin-left: -28px; margin-right: -28px; border-left: 28px solid transparent; border-right: 28px solid transparent; }
.outline-item-single .outline-expander::before, .outline-item-single .outline-expander:hover::before { display: none; }
.outline-item-open > .outline-item > .outline-expander::before { content: ""; }
.outline-children { display: none; }
.info-panel-tab-wrapper { display: none; }
.outline-item-open > .outline-children { display: block; }
.typora-export .outline-item { padding-top: 1px; padding-bottom: 1px; }
.typora-export .outline-item:hover { margin-right: -8px; border-right: 8px solid transparent; }
.typora-export .outline-expander::before { content: "+"; font-family: inherit; top: -1px; }
.typora-export .outline-expander:hover::before, .typora-export .outline-item-open > .outline-item > .outline-expander::before { content: "−"; }
.typora-export-collapse-outline .outline-children { display: none; }
.typora-export-collapse-outline .outline-item-open > .outline-children, .typora-export-no-collapse-outline .outline-children { display: block; }
.typora-export-no-collapse-outline .outline-expander::before { content: "" !important; }
.typora-export-show-outline .outline-item-active > .outline-item .outline-label { font-weight: 700; }
.md-inline-math-container mjx-container { zoom: 0.95; }
mjx-container { break-inside: avoid; }
.md-alert.md-alert-note { border-left-color: rgb(9, 105, 218); }
.md-alert.md-alert-important { border-left-color: rgb(130, 80, 223); }
.md-alert.md-alert-warning { border-left-color: rgb(154, 103, 0); }
.md-alert.md-alert-tip { border-left-color: rgb(31, 136, 61); }
.md-alert.md-alert-caution { border-left-color: rgb(207, 34, 46); }
.md-alert { padding: 0px 1em; margin-bottom: 16px; color: inherit; border-left: 0.25em solid rgb(0, 0, 0); }
.md-alert-text-note { color: rgb(9, 105, 218); }
.md-alert-text-important { color: rgb(130, 80, 223); }
.md-alert-text-warning { color: rgb(154, 103, 0); }
.md-alert-text-tip { color: rgb(31, 136, 61); }
.md-alert-text-caution { color: rgb(207, 34, 46); }
.md-alert-text { font-size: 0.9rem; font-weight: 700; }
.md-alert-text svg { fill: currentcolor; position: relative; top: 0.125em; margin-right: 1ch; overflow: visible; }
.md-alert-text-container::after { content: attr(data-text); text-transform: capitalize; pointer-events: none; margin-right: 1ch; }

</style>
<style type='text/css'  id="style-theme_css">
:root {
  /* == 字体设置 == */
  /* 基准字体 */
  /* 备选：Times, "Times New Roman" */
  --base-Latin-font: "Latin Modern Roman", "Latin Modern Roman 10", Times;
  --base-Chinese-font: "家族宋", "宋体-简", "华文宋体", "Noto Serif CJK SC";
  --base-font-size: 9.5pt;
  /* 引言字体 */
  --quote-font: "Latin Modern Roman", "Latin Modern Roman 10", Times,
    "Times New Roman", "华文仿宋";
  /* em单位为一个正文字符（--base-font-size）大小，
  例如，如果您设置 --base-font-size 为 9.5pt，那么 1.05em = 1.05*9.5pt ≈ 10pt。下面的标题字体等设置也遵循该规则。
  这样，您就可以仅通过调整基准字体大小，而动态对其他元素大小做出调整。
  当然，您也可以直接设置以pt或px为单位的数值，将元素的大小固定下来，如 --quote-font-size: 10pt; */
  --quote-font-size: 1.05em;
  /* 代码字体（代码中的中文会调用 ui-font） */
  /* "Courier New" 从 Windows 3.1 起成为 Windows 官方提供的字体 */
  /* "Consolas" 从 Windows Vista 起成为 Windows 官方提供的字体 */
  --code-font: "Latin Modern Mono", "Latin Modern Mono 10", "Consolas", "Courier New";
  /* 侧边栏字体 */
  --ui-font: "阿里巴巴普惠体 2.0", "微软雅黑";
  /* source mode 字体 */
  /* 默认调用 code-font 和 ui-font */
  --sourceMode-font: "SF Mono", "阿里巴巴普惠体 2.0", "微软雅黑";
  /* 目录字体 */
  /* 默认调用 base-font */
  --toc-font: "";
  /* 默认调用 base-font-size */
  --toc-font-size: "";
  /* 公式字体 */
  --math-font-size: 1em;
  /* 表格字体 */
  /* 默认调用 heading-font */
  --table-title-font: "";
  /* 默认调用 base-font */
  --table-font: "";
  /* 标题字体（总设置） */
  --heading-Latin-font: var(--base-Latin-font);
  --heading-Chinese-font: "华文黑体";
  /* 标题字体分别设置 */
  /* 大标题（h1）字体 */
  --title-Chinese-font: "华文黑体";
  --title-font-size: 1.9em;
  /* h2字体 */
  --h2-Chinese-font: "华文黑体";
  --h2-font-size: 1.5em;
  /* h3字体 */
  --h3-Chinese-font: "华文黑体";
  --h3-font-size: 1.25em;
  /* h4字体 */
  --h4-Chinese-font: "华文楷体";
  --h4-font-size: 1.15em;
  /* h5字体 */
  --h5-Chinese-font: "华文仿宋";
  --h5-font-size: 1.10em;
  /* h6字体 */
  --h6-Chinese-font: "华文仿宋";
  --h6-font-size: 1.05em;
  /* 粗体样式设置 */
  /* 加粗风格时使用的字重；400等同于 normal，700等同于 bold，900等同于 heavy */
  --strong-weight: 900;
  /* 基础行距 */
  --base-line-height: 1.618em;
  /* == 页面设置 == */
  /* 打印页边距 */
  --set-margin: 1.8cm 2cm 1.2cm 2cm !important;
  /* == 控制设置 == */
  /* 目录中是否显示一级标题 */
  --toc-show-title: none;
  /* == 颜色设置 == */
  /* 超链接颜色 */
  --link-color-light: #2E67D3;
  --link-color-dark: #8bb1f9;
  /* == 二级标题强制分页 == */
  /* 默认值为 auto */
  /* 更改为 page 启用强制分页 */
  --page-break-before-h2: auto;
}

body {
  padding: 0 !important;
  margin: 0 !important;
  /* counter-reset: tableHead 0 imgHead 0; */
}

@media print {
  #write {
    padding: 0 !important;
  }
  h2 {
    break-before: var(--page-break-before-h2);
  }
  h2:first-of-type {
    break-before: avoid-page;
  }
  @page {
    margin: 1.8cm 2cm 1.2cm 2cm !important; /* 页边距 */
  }
}
#write {
  font-family: var(--base-Latin-font), var(--base-Chinese-font), serif;
  font-size: var(--base-font-size);
  /* A4标准宽度 */
  max-width: 21cm;
  background-color: white;
  /* column-count: 2;
    column-gap: 25px;
    column-width: 8cm; 
    display: inline-block; */
  /* 这里可以试分栏的，但确实不适合实现 */
}
#write .md-math-block,
#write .md-rawblock,
#write p {
  margin-top: 1em;
  margin-bottom: 1em;
}
#write p {
  text-align: left;
  line-height: var(--base-line-height);
}
#write a {
  color: var(--link-color-light);
}

hr {
  border-top: solid 1px #ddd;
  margin-top: 1.8em;
  margin-bottom: 1.8em;
}

img {
  /* 避免图片在导出时被断开 */
  break-inside: avoid-page;
}

strong {
  font-weight: var(--strong-weight);
}

@media screen {
  #write {
    padding: var(--set-margin);
    /* 添加一个淡蓝色的边框 */
    /* border: 0.8px solid #AAC ; */
    /* 页边阴影 */
    box-shadow: 0 0 24px 12px #cccccc;
  }
}
.MathJax {
  font-size: var(--math-font-size);
}

/* typora 编写模式 */
#typora-source {
  font-family: var(--sourceMode-font), var(--code-font), var(--ui-font), monospace;
  line-height: 2em;
}

/* 侧边大纲标题 */
.sidebar-content {
  counter-reset: outline-h1 outline-h2 outline-h3 outline-h4 outline-h5 outline-h6;
}
.sidebar-content .outline-h1 {
  counter-reset: outline-h2 outline-h3 outline-h4 outline-h5 outline-h6;
}
.sidebar-content .outline-h2 {
  counter-reset: outline-h3 outline-h4 outline-h5 outline-h6;
}
.sidebar-content .outline-h2 .outline-label:before {
  counter-increment: outline-h2;
  content: counter(outline-h2) " ";
}
.sidebar-content .outline-h3 {
  counter-reset: outline-h4 outline-h5 outline-h6;
}
.sidebar-content .outline-h3 .outline-label:before {
  counter-increment: outline-h3;
  content: counter(outline-h2) "." counter(outline-h3) "  ";
}
.sidebar-content .outline-h4 {
  counter-reset: outline-h5 outline-h6;
}
.sidebar-content .outline-h4 .outline-label:before {
  counter-increment: outline-h4;
  content: counter(outline-h2) "." counter(outline-h3) "." counter(outline-h4) "  ";
}
.sidebar-content .outline-h5 {
  counter-reset: outline-h6;
}
.sidebar-content .outline-h5 .outline-label:before {
  counter-increment: outline-h5;
  content: counter(outline-h2) "." counter(outline-h3) "." counter(outline-h4) "." counter(outline-h5) "  ";
}

.sidebar-content {
  /* 侧边栏的字体修改 */
  font-family: var(--ui-font);
  list-style: none;
}

/* 元数据（如 YAML front matter）的背景框 */
pre.md-meta-block {
  background: #cccccc;
  padding: 1.4em;
  font-family: var(--code-font), var(--ui-font), monospace;
  font-size: 0.8em;
}

#write > h3.md-focus:before,
#write > h4.md-focus:before,
#write > h5.md-focus:before,
#write > h6.md-focus:before,
h3.md-focus:before,
h4.md-focus:before,
h5.md-focus:before,
h6.md-focus:before {
  color: inherit;
  border: inherit;
  border-radius: inherit;
  position: inherit;
  left: initial;
  float: none;
  top: initial;
  font-size: inherit;
  padding-left: inherit;
  padding-right: inherit;
  vertical-align: inherit;
  font-weight: inherit;
  line-height: inherit;
}

#write {
  counter-reset: heading-h2 heading-h3 heading-h4 heading-h5 heading-h6;
}
#write h1,
#write h2,
#write h3,
#write h4,
#write h5,
#write h6 {
  font-weight: bold;
  break-after: avoid-page !important;
}
#write h1 {
  font-family: var(--heading-Latin-font), var(--title-Chinese-font), serif;
  text-align: center;
  column-span: all;
  font-size: var(--title-font-size);
}
#write h2 {
  font-family: var(--heading-Latin-font), var(--h2-Chinese-font), serif;
  font-size: var(--h2-font-size);
}
#write h3 {
  font-family: var(--heading-Latin-font), var(--h3-Chinese-font), serif;
  font-size: var(--h3-font-size);
  line-height: var(--h3-font-size);
}
#write h4 {
  font-family: var(--heading-Latin-font), var(--h4-Chinese-font), serif;
  font-size: var(--h4-font-size);
  line-height: var(--h4-font-size);
}
#write h5 {
  font-family: var(--heading-Latin-font), var(--h5-Chinese-font), serif;
  font-size: var(--h5-font-size);
  line-height: var(--h5-font-size);
}
#write h6 {
  font-family: var(--heading-Latin-font), var(--h6-Chinese-font), serif;
  font-size: var(--h6-font-size);
  /* 没有写错，为了避免行距太小才这么写 */
  line-height: var(--h5-font-size);
}
#write h1 {
  counter-set: heading-h2 0 heading-h3 0 heading-h4 0 heading-h5 0 heading-h6 0;
}
#write h2 {
  counter-set: heading-h3 0 heading-h4 0 heading-h5 0 heading-h6 0;
}
#write h3 {
  counter-set: heading-h4 0 heading-h5 0 heading-h6 0;
}
#write h4 {
  counter-set: heading-h5 0 heading-h6 0;
}
#write h5 {
  counter-set: heading-h6 0;
}
#write h2:before, h2.md-focus.md-heading:before {
  content: counter(heading-h2);
  counter-increment: heading-h2;
  margin-right: 1.2em;
}

#write h3:before, h3.md-focus.md-heading:before {
  content: counter(heading-h2) "." counter(heading-h3);
  counter-increment: heading-h3;
  margin-right: 1.2em;
}

#write h4:before, h4.md-focus.md-heading:before {
  content: counter(heading-h2) "." counter(heading-h3) "." counter(heading-h4);
  counter-increment: heading-h4;
  margin-right: 1.2em;
}

#write h5:before, h5.md-focus.md-heading:before {
  content: counter(heading-h2) "." counter(heading-h3) "." counter(heading-h4) "." counter(heading-h5);
  counter-increment: heading-h5;
  margin-right: 1.2em;
}

#write h6:before, h6.md-focus.md-heading:before {
  content: counter(heading-h2) "." counter(heading-h3) "." counter(heading-h4) "." counter(heading-h5) "." counter(heading-h6);
  counter-increment: heading-h6;
  margin-right: 1.2em;
}

/* 参考文献（脚注）块，在 Typora 中的样式 */
.md-def-footnote {
  display: flex;
  position: relative;
  font-size: 0.95em;
  opacity: 1;
  margin: 0;
}
.md-def-footnote:not(:first-child), .md-def-footnote + *:not(.md-def-footnote) {
  margin-top: 1em;
}
.md-def-footnote + .md-def-footnote {
  margin-top: 0.5em;
}
.md-def-footnote .md-def-name {
  font-weight: inherit;
  padding: 0;
  flex-shrink: 0;
  width: 3em;
  margin-inline-start: -1ch;
  white-space: nowrap;
  text-align: left;
}
.md-def-footnote .md-def-name:before {
  content: "［";
  position: static;
  color: inherit;
}
.md-def-footnote .md-def-name:after {
  content: "］";
  position: static;
  color: inherit;
}
.md-def-footnote .md-reverse-footnote-area {
  display: none;
}
.md-def-footnote:hover .md-reverse-footnote-area {
  position: absolute;
  right: -6px;
  display: inline;
}

/* 参考文献（脚注）块，在导出 HTML 或 PDF 时的样式（导出后的 HTML tag 和 Typora 中的 HTML tag 不一致） */
.footnotes-area {
  padding-inline-start: 2.5em;
}
.footnotes-area hr {
  display: none;
}
.footnotes-area .footnote-line {
  color: var(--text-color);
  font-size: 0.95em;
  margin-top: 0.5em;
}
.footnotes-area .footnote-line *:not(.md-fn-count) {
  display: inline-block;
  vertical-align: top;
}
.footnotes-area .footnote-line span.md-fn-count {
  font-weight: inherit;
  padding: 0;
  margin-inline-start: -3em;
  white-space: nowrap;
  display: inline-block;
  width: 2.5em;
}
.footnotes-area .footnote-line span.md-fn-count:before {
  content: "［";
  position: static;
  color: inherit;
}
.footnotes-area .footnote-line span.md-fn-count:after {
  content: "］";
  position: static;
  color: inherit;
}
.footnotes-area .footnote-line a.reversefootnote {
  display: none;
}

/* 参考文献（脚注）上标 */
sup.md-footnote {
  display: inline;
  padding: 0;
  margin: 0;
  background: transparent;
  color: inherit;
}
sup.md-footnote a {
  color: inherit !important;
}
sup.md-footnote:not(.md-expand) {
  margin-inline: -0.44em;
}
sup.md-footnote:not(.md-expand):before {
  content: "［";
}
sup.md-footnote:not(.md-expand):after {
  content: "］";
}

/* 无序列表 */
#write ul {
  list-style: disc;
}
#write ul ul {
  /*list-style: circle;*/
  /* 请勿删除“–”后的空格, 他们对缩进有一定影响, 下同 */
  list-style: "–   ";
}
#write ul ul ul {
  list-style: "◦  ";
}

/* 有序列表 */
#write ol {
  list-style: decimal;
}
#write ol ol {
  counter-reset: liist;
  list-style: none;
}
#write ol ol > li {
  counter-increment: liist;
  position: relative;
}
#write ol ol > li::before {
  content: "(" counter(liist, lower-alpha) ")";
  position: absolute;
  left: -1.8em;
}
#write ol ol ol {
  counter-reset: liiist;
  list-style: none;
  margin: 0;
}
#write ol ol ol > li {
  counter-increment: liiist;
  position: relative;
}
#write ol ol ol > li::before {
  content: counter(liiist, lower-roman) ".";
  align-self: flex-end;
  position: absolute;
  left: -4.5em;
  /* -moz-box-sizing: border-box;
    -webkit-box-sizing: border-box;
    box-sizing: border-box;*/
  /* 为了让项目编号是重新用句点对齐而不是左对齐 */
  width: 4em;
  text-align: right;
}

#write ol,
#write ul {
  padding-inline-start: 2em;
}

#write li {
  position: relative;
}
#write li + li,
#write ul + ol > li,
#write ol + ul > li,
#write li > ul > li,
#write li > ol > li {
  margin-top: -0.8em;
}

/* task列表 */
.md-task-list-item > input {
  margin-top: 0.42em;
  margin-left: -1.5em;
  width: 1em !important;
  height: 1em !important;
}

#write table {
  /* 三线表第一条线宽度 */
  border-top: 1.2pt solid;
  /* 三线表第二条线宽度 */
  border-bottom: 1.2pt solid;
  font-family: var(--table-font), var(--base-Latin-font), var(--base-Chinese-font), serif;
  /* font-size: var(--base-font-size); */
  text-align: center;
  break-inside: avoid-page;
  border-spacing: 6px;
  /* 自动布局表格宽度，如果有时内容太紧建议直接加空格吧，我自己看不惯和页面等宽的大表格 */
  width: auto;
  /* 使表格默认居中；虽然这个代码不好，但好像没别的实现办法 */
  margin: 0 auto;
}
#write table td {
  padding: 2px;
}
#write table tr {
  padding: 2px;
}
#write th {
  padding: 0px 6px;
}
#write thead {
  /* 表格标题（首行）样式 */
  /* 三线表表头的线 */
  border-bottom: 0.5pt solid;
  font-family: var(--table-title-font), var(--heading-Latin-font), var(--heading-Chinese-font), serif !important;
  /* font-size: var(--base-font-size); */
  font-weight: var(--strong-weight);
}

/* 一个>的引言仅为两字符缩进，使用>>的引言为传统引言样式，具有左竖线、左缩进 */
blockquote {
  font-style: normal;
  font-family: var(--quote-font), var(--base-Latin-font), var(--base-Chinese-font), -apple-system, serif;
  font-size: var(--quote-font-size);
  /* 文字离左边框的距离 */
  padding-left: 2em;
  padding-right: 2em;
  /* 左边框离页面边的距离 */
  margin-left: 0;
}

blockquote blockquote {
  border-left: 4px solid hsl(0, 0%, 70%);
  padding-left: calc(2ch - 4px);
  padding-right: 0;
  margin-left: -4px;
  border-radius: 0;
}

/* 行内代码 */
code {
  font-family: var(--code-font), var(--ui-font), monospace;
}

h1 code, h2 code, h3 code, h4 code, h5 code, h6 code,
p code,
li code {
  color: rgb(60, 112, 198);
  background-color: #fefefe;
  /* 阴影 */
  box-shadow: 0 0 1px 1px #c8d3df;
  font-family: var(--code-font), var(--ui-font), monospace;
  box-sizing: border-box;
  border-right: 0px;
  margin: 0 2px 0 2px;
  padding: 0 2px 0 2px;
  /* 圆角 */
  border-radius: 2px 2px 2px 2px;
}

/* 代码块样式 */
.md-fences,
.CodeMirror pre,
.CodeMirror-wrap {
  /* padding: 10px; */
  font-size: 1em;
}

.CodeMirror-code pre,
.CodeMirror-sizer {
  font-family: var(--code-font), var(--ui-font), monospace;
}

/* 目录 */
.md-toc {
  font-size: var(--toc-font-size);
}

.md-toc-content {
  margin-left: 2em;
  /* 修复缺失上级标题时无法递增 */
  counter-reset: toc-h2 toc-h3 toc-h4 toc-h5 toc-h6;
  break-after: page;
}

.md-toc-inner {
  margin-left: 0 !important;
  color: var(--text-color) !important;
}

.md-toc-item {
  color: var(--text-color) !important;
}

/* 目录标题内容属性 */
.md-toc-h2,
.md-toc-h3,
.md-toc-h4,
.md-toc-h5,
.md-toc-h6 {
  font-size: var(--toc-font-size);
  font-family: var(--toc-font), var(--base-Latin-font), var(--base-Chinese-font), serif;
}

.md-toc-h2 {
  font-weight: var(--strong-weight);
}

/* 目录标题前 */
.md-toc-content .md-toc-h1 {
  display: var(--toc-show-title);
  counter-set: toc-h2 0 toc-h3 0 toc-h4 0 toc-h5 0 toc-h6 0;
}
.md-toc-content .md-toc-h2 {
  counter-set: toc-h3 0 toc-h4 0 toc-h5 0 toc-h6 0;
}
.md-toc-content .md-toc-h3 {
  counter-set: toc-h4 0 toc-h5 0 toc-h6 0;
}
.md-toc-content .md-toc-h4 {
  counter-set: toc-h5 0 toc-h6 0;
}
.md-toc-content .md-toc-h5 {
  counter-set: toc-h6 0;
}
.md-toc-content .md-toc-h2:before {
  counter-increment: toc-h2;
  content: counter(toc-h2);
  margin-right: 1em;
  font-weight: var(--strong-weight);
}
.md-toc-content .md-toc-h3:before {
  counter-increment: toc-h3;
  content: counter(toc-h2) "." counter(toc-h3);
  margin-left: 1.5em;
  margin-right: 0.5em;
}
.md-toc-content .md-toc-h4:before {
  counter-increment: toc-h4;
  content: counter(toc-h2) "." counter(toc-h3) "." counter(toc-h4);
  margin-left: 3.5em;
  margin-right: 0.5em;
}
.md-toc-content .md-toc-h5:before {
  counter-increment: toc-h5;
  content: counter(toc-h2) "." counter(toc-h3) "." counter(toc-h4) "." counter(toc-h5);
  margin-left: 5.5em;
  margin-right: 0.5em;
}
.md-toc-content .md-toc-h6:before {
  counter-increment: toc-h6;
  content: counter(toc-h2) "." counter(toc-h3) "." counter(toc-h4) "." counter(toc-h5) "." counter(toc-h6);
  margin-left: 7.5em;
  margin-right: 0.5em;
}
</style>
<style type='text/css'  id="style-mathjax">
mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
  min-height: 1px;
  min-width: 1px;
}

mjx-container[jax="SVG"] > svg a {
  fill: blue;
  stroke: blue;
}

mjx-assistive-mml {
  position: absolute !important;
  top: 0px;
  left: 0px;
  clip: rect(1px, 1px, 1px, 1px);
  padding: 1px 0px 0px 0px !important;
  border: 0px !important;
  display: block !important;
  width: auto !important;
  overflow: hidden !important;
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -khtml-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

mjx-assistive-mml[display="block"] {
  width: 100% !important;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][display="true"][width="full"] {
  display: flex;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line], svg[data-table] > g > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame], svg[data-table] > g > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed, svg[data-table] > g > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted, svg[data-table] > g > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > g > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

mjx-container[jax="SVG2"] path[data-c], mjx-container[jax="SVG2"] use[data-c] {
  stroke-width: 3;
}

g[data-mml-node="xypic"] path {
  stroke-width: inherit;
}

.MathJax g[data-mml-node="xypic"] path {
  stroke-width: inherit;
}
</style>
<style type='text/css'  id="style-mathjax-ni">mjx-container[jax="SVG"] path[data-c], mjx-container[jax="SVG"] use[data-c] {
							stroke-width: 0;
						}</style>
<style type='text/css'  id="style-lp">ol, ul {padding-left: 40px}</style>

<title>2025-AgentProg_2026-02-18-20_13_29_NewPicLink</title>
</head>
<body class='typora-export os-windows typora-export-show-outline typora-export-collapse-outline'><div class='typora-export-content'>
<div class="typora-export-sidebar"><div class="outline-content"><li class="outline-item-wrapper outline-h1 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#agentprog-empowering-long-horizon-gui-agents-with-program-guided-context-management">AgentProg: Empowering Long-Horizon GUI Agents with Program-Guided Context Management</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h1"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#agentprog-使用程序引导上下文管理的长时窗-gui-代理">AgentProg: 使用程序引导上下文管理的长时窗 GUI 代理</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h2 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#abstract">Abstract</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#摘要">摘要</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#1-introduction">1 Introduction</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#1-引言">1 引言</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#2-related-work-and-motivation">2 Related Work and Motivation</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#2-相关工作与动机">2 相关工作与动机</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#21-gui-agent">2.1 GUI Agent</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#21-gui-代理">2.1 GUI 代理</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#22-related-work">2.2 Related Work</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#22-相关工作">2.2 相关工作</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#23-motivation-and-challenges">2.3 Motivation and Challenges</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#23-动机与挑战">2.3 动机与挑战</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h2 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#3-our-approach-agentprog">3 Our Approach: AgentProg</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#3-我们的方法agentprog">3 我们的方法：AgentProg</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#31-semantic-task-program-a-dsl-for-long-horizon-task-planning">3.1 Semantic Task Program: A DSL for Long-Horizon Task Planning</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#31-语义任务程序用于长时程任务规划的dsl">3.1 语义任务程序：用于长时程任务规划的DSL</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#32-stp-generation-and-execution">3.2 STP Generation and Execution</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#32-stp-生成与执行">3.2 STP 生成与执行</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h2 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#execution-phase">Execution Phase.</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#执行阶段">执行阶段。</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#33-program-guided-context-management">3.3 Program-Guided Context Management</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#33-程序引导的上下文管理">3.3 程序引导的上下文管理</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#34-global-belief-state">3.4 Global Belief State</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#34-全局信念状态">3.4 全局信念状态</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h2 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#4-aw-extend-benchmark">4 AW-Extend Benchmark</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#4-aw-extend-基准测试">4 AW-Extend 基准测试</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#5-experiments">5 Experiments</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#5-实验">5 实验</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#51-experimental-settings">5.1 Experimental Settings</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#51-实验设置">5.1 实验设置</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#52-analysis-of-success-rate">5.2 Analysis of Success Rate</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#52-成功率分析">5.2 成功率分析</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#53-analysis-of-latency-and-cost">5.3 Analysis of Latency and Cost</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#53-延迟与成本分析">5.3 延迟与成本分析</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h2 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#6-conclusion">6 Conclusion</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#6-结论">6 结论</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#references">References</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#参考文献">参考文献</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#a-syntax-of-semantic-task-program">A Syntax of Semantic Task Program</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#a-syntax-of-semantic-task-program-2">A Syntax of Semantic Task Program</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#a1-basic-statements-and-comments">A.1 Basic Statements and Comments</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#a1-基本语句与注释">A.1 基本语句与注释</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#a2-variables-and-data-management">A.2 Variables and Data Management</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#a2-变量与数据管理">A.2 变量与数据管理</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#a3-control-flow">A.3 Control Flow</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#a3-控制流">A.3 控制流</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#a4-functions">A.4 Functions</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#a4-函数">A.4 函数</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#a5-interactions-with-external-tools">A.5 Interactions with External Tools</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#a5-与外部工具的交互">A.5 与外部工具的交互</a></div><ul class="outline-children"></ul></li></ul></li></ul></li></div></div><div id='write'  class=''><h1 id='agentprog-empowering-long-horizon-gui-agents-with-program-guided-context-management'><span>AgentProg: Empowering Long-Horizon GUI Agents with Program-Guided Context Management</span></h1><h1 id='agentprog-使用程序引导上下文管理的长时窗-gui-代理'><span>AgentProg: 使用程序引导上下文管理的长时窗 GUI 代理</span></h1><p><span>Shizuo Tian</span>
<span>Shizuo Tian</span></p><p><span>Tsinghua University</span>
<span>清华大学</span></p><p><span>Beijing, China</span>
<span>中国北京</span></p><p><span>Hao Wen</span>
<span>Hao Wen</span></p><p><span>Tsinghua University</span>
<span>清华大学</span></p><p><span>Beijing, China</span>
<span>中国北京</span></p><p><span>Yuxuan Chen</span>
<span>Yuxuan Chen</span></p><p><span>Tsinghua University</span>
<span>清华大学</span></p><p><span>Beijing, China</span>
<span>中国北京</span></p><p><span>Jiacheng Liu</span>
<span>Jiacheng Liu</span></p><p><span>Peking University</span>
<span>北京大学</span></p><p><span>Beijing, China</span>
<span>中国北京</span></p><p><span>Shanhui Zhao</span>
<span>Shanhui Zhao</span></p><p><span>Tsinghua University</span>
<span>清华大学</span></p><p><span>Beijing, China</span>
<span>中国北京</span></p><p><span>Guohong Liu</span>
<span>郭宏 刘</span></p><p><span>Tsinghua University</span>
<span>清华大学</span></p><p><span>Beijing, China</span>
<span>中国，北京</span></p><p><span>Ju Ren</span>
<span>如仁</span></p><p><span>Tsinghua University</span>
<span>清华大学</span></p><p><span>Beijing, China</span>
<span>中国，北京</span></p><p><span>Yunxin Liu</span>
<span>云欣 刘</span></p><p><span>Tsinghua University</span>
<span>清华大学</span></p><p><span>Beijing, China</span>
<span>中国，北京</span></p><p><span>Yuanchun Li</span>
<span>元春 李</span></p><p><span>Tsinghua University</span>
<span>清华大学</span></p><p><span>Beijing, China</span>
<span>中国，北京</span></p><h2 id='abstract'><span>Abstract</span></h2><h2 id='摘要'><span>摘要</span></h2><p><span>The rapid development of mobile GUI agents has stimulated growing research interest in long-horizon task automation. However, building agents for these tasks faces a critical bottleneck: the reliance on ever-expanding interaction history incurs substantial context overhead. Existing context management and compression techniques often fail to preserve vital semantic information, leading to degraded task performance. We propose AgentProg, a program-guided approach for agent context management that reframes the interaction history as a program with variables and control flow. By organizing information according to the structure of program, this structure provides a principled mechanism to determine which information should be retained and which can be discarded. We further integrate a global belief state mechanism inspired by Belief MDP framework to handle partial observability and adapt to unexpected environmental changes. Experiments on AndroidWorld and our extended long-horizon task suite demonstrate that AgentProg has achieved the state-of-the-art success rates on these benchmarks. More importantly, it maintains robust performance on long-horizon tasks while baseline methods experience catastrophic degradation. Our system is open-sourced at </span><a href='https://github.com/MobileLLM/AgentProg' target='_blank' class='url'>https://github.com/MobileLLM/AgentProg</a><span>.</span>
<span>移动GUI代理的快速发展推动了对长时间任务自动化的研究兴趣。然而，为这些任务构建代理面临一个关键瓶颈：对日益扩展的交互历史的依赖会带来巨大的上下文开销。现有的上下文管理与压缩技术往往难以保留关键语义信息，导致任务性能下降。我们提出 AgentProg，一种用于代理上下文管理的程序引导方法，将交互历史重新表述为带变量和控制流的程序。通过按程序结构组织信息，这一结构提供了一个原则性机制来判定哪些信息应被保留，哪些可以舍弃。我们进一步整合受 Belief MDP 框架启发的全局信念状态机制，以应对部分可观测性并适应意外的环境变化。在 AndroidWorld 的实验与我们扩展的长时任务集合上，AgentProg 显示出在这些基准测试中的最新状态的成功率。更重要的是，它在长时任务中保持稳健表现，而基线方法则出现灾难性退化。我们的系统开源，地址为 </span><a href='https://github.com/MobileLLM/AgentProg' target='_blank' class='url'>https://github.com/MobileLLM/AgentProg</a><span>。</span></p><h2 id='1-introduction'><span>1 Introduction</span></h2><h2 id='1-引言'><span>1 引言</span></h2><p><span>Building intelligent assistants that can operate mobile devices by following natural language instructions has long been a central goal of mobile systems </span><mjx-container class="MathJax" jax="SVG" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="8.926ex" height="2.262ex" role="img" focusable="false" viewBox="0 -750 3945.3 1000" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -0.566ex;"><defs><path id="MJX-3333-TEX-N-5B" d="M118 -250V750H255V710H158V-210H255V-250H118Z"></path><path id="MJX-3333-TEX-N-33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path id="MJX-3333-TEX-N-2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path><path id="MJX-3333-TEX-N-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path id="MJX-3333-TEX-N-38" d="M70 417T70 494T124 618T248 666Q319 666 374 624T429 515Q429 485 418 459T392 417T361 389T335 371T324 363L338 354Q352 344 366 334T382 323Q457 264 457 174Q457 95 399 37T249 -22Q159 -22 101 29T43 155Q43 263 172 335L154 348Q133 361 127 368Q70 417 70 494ZM286 386L292 390Q298 394 301 396T311 403T323 413T334 425T345 438T355 454T364 471T369 491T371 513Q371 556 342 586T275 624Q268 625 242 625Q201 625 165 599T128 534Q128 511 141 492T167 463T217 431Q224 426 228 424L286 386ZM250 21Q308 21 350 55T392 137Q392 154 387 169T375 194T353 216T330 234T301 253T274 270Q260 279 244 289T218 306L210 311Q204 311 181 294T133 239T107 157Q107 98 150 60T250 21Z"></path><path id="MJX-3333-TEX-N-34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path><path id="MJX-3333-TEX-N-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path><path id="MJX-3333-TEX-N-5D" d="M22 710V750H159V-250H22V-210H119V710H22Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mrow"><g data-mml-node="mo"><use data-c="5B" xlink:href="#MJX-3333-TEX-N-5B"></use></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(278,0)"><g data-mml-node="mn"><use data-c="33" xlink:href="#MJX-3333-TEX-N-33"></use></g><g data-mml-node="mo" transform="translate(500,0)"><use data-c="2C" xlink:href="#MJX-3333-TEX-N-2C"></use></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(944.7,0)"><g data-mml-node="mn"><use data-c="31" xlink:href="#MJX-3333-TEX-N-31"></use><use data-c="38" xlink:href="#MJX-3333-TEX-N-38" transform="translate(500,0)"></use></g></g><g data-mml-node="mo" transform="translate(1944.7,0)"><use data-c="2C" xlink:href="#MJX-3333-TEX-N-2C"></use></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(2389.3,0)"><g data-mml-node="mn"><use data-c="34" xlink:href="#MJX-3333-TEX-N-34"></use><use data-c="30" xlink:href="#MJX-3333-TEX-N-30" transform="translate(500,0)"></use></g></g></g><g data-mml-node="mo" transform="translate(3667.3,0)"><use data-c="5D" xlink:href="#MJX-3333-TEX-N-5D"></use></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">[</mo><mrow data-mjx-texclass="ORD"><mn>3</mn><mo>,</mo><mrow data-mjx-texclass="ORD"><mn>18</mn></mrow><mo>,</mo><mrow data-mjx-texclass="ORD"><mn>40</mn></mrow></mrow><mo data-mjx-texclass="CLOSE">]</mo></mrow></math></mjx-assistive-mml></mjx-container><script type="math/tex">\left\lbrack  {3,{18},{40}}\right\rbrack</script><span> and artificial intelligence researchers [19, 21, 32]. Graphical User Interface (GUI) agents aim to simulate human user operations on graphical interfaces (e.g. such as clicking, scrolling, and inputting text, etc.) to interact with devices and complete complex tasks within existing software ecosystems. Recent advances in large language models (LLMs) and vision-language models (VLMs) have shown promising results in this domain. Building upon these foundation models, researchers have developed rich agent frameworks that enable agents to successfully complete relatively simple tasks through interactive decision-making processes [7, 17, 41, 45, 49, 51, 53].</span>
<span>设计能够通过自然语言指令在移动设备上操作的智能助手，一直是移动系统 </span><mjx-container class="MathJax" jax="SVG" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="8.926ex" height="2.262ex" role="img" focusable="false" viewBox="0 -750 3945.3 1000" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -0.566ex;"><defs><path id="MJX-3333-TEX-N-5B" d="M118 -250V750H255V710H158V-210H255V-250H118Z"></path><path id="MJX-3333-TEX-N-33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path id="MJX-3333-TEX-N-2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path><path id="MJX-3333-TEX-N-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path id="MJX-3333-TEX-N-38" d="M70 417T70 494T124 618T248 666Q319 666 374 624T429 515Q429 485 418 459T392 417T361 389T335 371T324 363L338 354Q352 344 366 334T382 323Q457 264 457 174Q457 95 399 37T249 -22Q159 -22 101 29T43 155Q43 263 172 335L154 348Q133 361 127 368Q70 417 70 494ZM286 386L292 390Q298 394 301 396T311 403T323 413T334 425T345 438T355 454T364 471T369 491T371 513Q371 556 342 586T275 624Q268 625 242 625Q201 625 165 599T128 534Q128 511 141 492T167 463T217 431Q224 426 228 424L286 386ZM250 21Q308 21 350 55T392 137Q392 154 387 169T375 194T353 216T330 234T301 253T274 270Q260 279 244 289T218 306L210 311Q204 311 181 294T133 239T107 157Q107 98 150 60T250 21Z"></path><path id="MJX-3333-TEX-N-34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path><path id="MJX-3333-TEX-N-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path><path id="MJX-3333-TEX-N-5D" d="M22 710V750H159V-250H22V-210H119V710H22Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mrow"><g data-mml-node="mo"><use data-c="5B" xlink:href="#MJX-3333-TEX-N-5B"></use></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(278,0)"><g data-mml-node="mn"><use data-c="33" xlink:href="#MJX-3333-TEX-N-33"></use></g><g data-mml-node="mo" transform="translate(500,0)"><use data-c="2C" xlink:href="#MJX-3333-TEX-N-2C"></use></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(944.7,0)"><g data-mml-node="mn"><use data-c="31" xlink:href="#MJX-3333-TEX-N-31"></use><use data-c="38" xlink:href="#MJX-3333-TEX-N-38" transform="translate(500,0)"></use></g></g><g data-mml-node="mo" transform="translate(1944.7,0)"><use data-c="2C" xlink:href="#MJX-3333-TEX-N-2C"></use></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(2389.3,0)"><g data-mml-node="mn"><use data-c="34" xlink:href="#MJX-3333-TEX-N-34"></use><use data-c="30" xlink:href="#MJX-3333-TEX-N-30" transform="translate(500,0)"></use></g></g></g><g data-mml-node="mo" transform="translate(3667.3,0)"><use data-c="5D" xlink:href="#MJX-3333-TEX-N-5D"></use></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">[</mo><mrow data-mjx-texclass="ORD"><mn>3</mn><mo>,</mo><mrow data-mjx-texclass="ORD"><mn>18</mn></mrow><mo>,</mo><mrow data-mjx-texclass="ORD"><mn>40</mn></mrow></mrow><mo data-mjx-texclass="CLOSE">]</mo></mrow></math></mjx-assistive-mml></mjx-container><script type="math/tex">\left\lbrack  {3,{18},{40}}\right\rbrack</script><span> 与人工智能研究者的核心目标之一 [19, 21, 32]。图形用户界面（GUI）代理旨在模拟人类用户在图形界面上的操作（如点击、滚动、输入文本等），以在现有软件生态系统中与设备交互并完成复杂任务。近期大型语言模型（LLMs）与视觉-语言模型（VLMs）的进展在该领域展现出良好前景。在这些基础模型的基础上，研究者开发了丰富的代理框架，使代理能够通过交互式决策过程成功完成相对简单的任务 [7, 17, 41, 45, 49, 51, 53]。</span></p><p><span>However, despite their success on simple tasks, existing methods face significant challenges when scaling to long-horizon scenarios-tasks that require dozens or even hundreds of steps to complete. The ability to complete such long tasks is usually more desirable, as they are often cumbersome and difficult for human users. For instance, an example long task is to review all events on today&#39;s calendar (including sending messages, creating notes, etc.) and generate followup steps on all scheduled items, or to navigate between multiple shopping and note apps to compare and record product prices. These challenges manifest in two critical dimensions. First, model performance degrades significantly on extended tasks, as language models struggle to maintain coherence and task-relevant reasoning over protracted sequences [2, 22]. Second, the computational cost grows substantially as the interaction history increases, with each decision requiring to process an increasingly long context.</span>
<span>然而，尽管他们在简单任务上取得了成功，现有方法在扩展到长时域情景时面临显著挑战——这些任务通常需要几十甚至上百步才能完成。完成如此长的任务的能力通常更令人向往，因为它们往往繁琐且难以被人类用户完成。例如，一个长任务的示例是查看日历上今天的所有事件（包括发送消息、创建笔记等）并对所有已安排事项生成后续步骤，或在多个购物与笔记应用之间切换以比较并记录产品价格。这些挑战在两个关键维度上表现出来。首先，随着任务扩展，模型性能显著下降，因为语言模型难以在漫长序列中维持连贯性和与任务相关的推理[2, 22]。其次，随着交互历史的增加，计算成本显著提高，每次决策都需要处理越来越长的上下文。</span></p><p><span>Existing approaches attempt to address the context management problem through various techniques, such as context window [26], summarization [27, 49] or hierarchical planning [1, 16]. While these methods partially alleviate the computational burden, they face a fundamental limitation: they lack a principled framework for determining which information is essential for future steps and which can be safely discarded. This often results in the loss of crucial state information, leading to task failure [28, 52, 55]. Moreover, existing methods demonstrate a critical gap in generalization-an agent&#39;s ability to solve individual atomic tasks does not directly transfer to solving compositional or iterative long-horizon tasks, revealing deeper limitations in their reasoning capabilities [23]. The core challenge in long-horizon task execution lies in effective context management during task execution. An agent must maintain a comprehensive understanding of the task progress and dynamically assess the evolving environment to make informed decisions. This requires task-aware context management to preserve the essential state while discarding irrelevant details.</span>
<span>现有方法通过多种技术来解决上下文管理问题，如上下文窗口[26]、摘要[27, 49]或分层规划[1, 16]。虽然这些方法在一定程度上减轻了计算负担，但它们面临一个根本性限制：缺乏一个 principled 的框架来决定哪些信息对未来步骤是必需的，哪些信息可以安全丢弃。 这常常导致关键状态信息的丢失，进而导致任务失败[28, 52, 55]。此外，现有方法在泛化能力方面存在关键差距——一个代理能解决的单一原子任务并不能直接转化为解决组合性或迭代性的长时任务，暴露出它们在推理能力方面的更深层次局限[23]。长时任务执行的核心挑战在于在任务执行过程中实现有效的上下文管理。代理必须对任务进展有全面的理解，并动态评估不断变化的环境，以做出明智的决策。这需要以任务为导向的上下文管理，在保留关键状态的同时丢弃不相关的细节。</span></p><hr /><p>&nbsp;</p><p><span>Corresponding Author: </span><a href='mailto:liyuanchun@air.tsinghua.edu.cn' target='_blank' class='url'>liyuanchun@air.tsinghua.edu.cn</a><span>.</span>
<span>通讯作者： </span><a href='mailto:liyuanchun@air.tsinghua.edu.cn' target='_blank' class='url'>liyuanchun@air.tsinghua.edu.cn</a><span>。</span></p><hr /><p>&nbsp;</p><p><span>Based on a pilot test of mobile GUI agents on long-horizon tasks (detailed in Section 2.3), we observed three key difficulties that hinder more accurate and robust task execution.</span>
<span>基于对移动GUI代理在长时任务上的初步测试（详见第2.3节），我们观察到三个关键困难，阻碍更高准确性和鲁棒性的任务执行。</span></p><p><span>(1) Task Planning and Decomposition. Long-horizon tasks often involve composition, repetition, and recursion of multiple subtasks. Existing methods typically decompose tasks into sequences or trees [39, 48], but these structures are overly simplistic for complex scenarios, necessitating frequent replanning that introduces overhead and instability. For instance, tasks like &quot;read today&#39;s todo list and complete each item&quot; cannot be fully planned upfront since the items are unknown initially, leading to repeated replanning that increases error risks.</span>
<span>(1) 任务规划与分解。长时任务通常涉及对多个子任务的组合、重复和递归。现有方法通常将任务分解为序列或树形结构[39, 48]，但对于复杂场景，这些结构过于简化，需要频繁重新规划，增加开销和不稳定性。例如，“读取今天的待办事项并逐项完成”这类任务在初始阶段无法完全事先规划，因为待办项最初未知，导致重复重新规划，增加错误风险。</span></p><p><span>(2) Interaction History Management. Due to the limited context length of LLMs, agents must determine what information to retain or forget in the task execution process. Current approaches lack task-aware context management, struggling to preserve critical intermediate results (e.g., restaurant details across a reservation task) while discarding irrelevant navigation history.</span>
<span>(2) 交互历史管理。由于大型语言模型的上下文长度有限，代理在任务执行过程中必须决定保留或遗忘哪些信息。当前方法缺乏任务感知的上下文管理，在保持关键中间结果（例如在预订任务中记录的餐厅详情）的同时，难以保留无关的导航历史。</span></p><p><span>(3) Environment State Comprehension. Agents must maintain accurate understanding about environment states throughout execution. Software environments are usually dynamic and partially-observable with hidden UI elements, unexpected state changes, and transient failures, which are hard to handle for agents in the long task process. For instance, without proper environment understanding, agents may incorrectly believe tasks are complete when operations actually failed, causing workflow derailment that becomes critical in long-horizon scenarios.</span>
<span>(3) 环境状态理解。代理在执行过程中必须对环境状态保持准确理解。软件环境通常是动态且部分可观测的，存在隐藏的用户界面元素、意外的状态变化以及短暂的故障，这些都对长时任务过程中的代理较难处理。例如，如果没有对环境有正确理解，代理可能错误地认为任务已完成，而实际操作却失败，导致工作流偏离，在长时情景中会变得十分关键。</span></p><p><span>Our inspiration to address these challenges stems from traditional programs, which are capable to execute extremely long tasks with limited memory capacity. A program is naturally a representation of task decomposition. Its &quot;context management&quot; strategy is the program itself, which seamlessly handles information retaining/discarding in the system heap and stack through the mechanisms of functions, threads, global/local variables, etc. In principle, the task execution process of a GUI agent can also be represented as a program, and the agent context can be maintained in the same way as the CPU memory during program execution.</span>
<span>我们解决这些挑战的灵感来自传统程序，它们能够在有限内存容量下执行极其长的任务。程序本质上就是任务分解的表现形式。其“上下文管理”策略就是程序本身，借助函数、线程、全局/局部变量等机制在系统堆和栈中无缝处理信息的保留与丢弃。原则上，GUI代理的任务执行过程也可以表示为一个程序，代理上下文可以像程序执行时的CPU内存那样进行维护。</span></p><p><span>Therefore, we propose AgentProg, a program-guided context management approach for long-horizon GUI agent tasks. AgentProg reframes the agent&#39;s interaction history-traditionally represented as a flat, ever-expanding sequence - as a program with variables and control flow. This program structure, generated based on the task requirements, provides a principled and task-aware mechanism for context management. By organizing information according to the program&#39;s structure, AgentProg can systematically determine which information to retain and which to discard at each step, enabling task-specific context management that preserves crucial details.</span>
<span>因此，我们提出 AgentProg，一种用于长时域 GUI 代理任务的程序引导上下文管理方法。AgentProg 将代理的交互历史——传统上表现为一个平坦、不断扩展的序列——重新表述为一个具有变量和控制流的程序。这个基于任务需求生成的程序结构，为上下文管理提供了一个原则性且任务感知的机制。通过按照程序结构组织信息，AgentProg 可以在每一步系统地确定需要保留哪些信息、应丢弃哪些信息，从而实现保留关键细节的任务特定上下文管理。</span></p><p><span>A key question in our agent-program analogy is how to handle environment dynamicity. Letting the agent follow a program in the task process may lead to poor adaptivity, since the programs are generated before observing the actual environment at each step. We introduce a domain-specific language named Semantic Task Program (STP) to handle this problem. Unlike traditional programs that are based on precise symbolic instructions (e.g. name = getElement(&#39;user Name&#39;).text), STP uses fuzzy, natural-language-style instructions (e.g. get user name as </span><span>{</span><span>name</span><span>}</span><span>) to construct the program. The STP instructions capture necessary information for interaction context management, while they are interpreted adaptively at runtime based on the actual environment state. Furthermore, we incorporate a Global Belief State module into the STP execution process to address the inherent partial observability of GUI environments, a characteristic absent in traditional programming paradigms.</span>
<span>一个关键问题在于如何处理环境的动态性。让智能体在任务处理中依照一个程序执行可能导致适应性差，因为在每一步观察实际环境之前就生成了程序。为了解决这个问题，我们引入了一个领域特定语言，称为语义任务程序（STP）。与基于精确符号指令（例如 name = getElement(&#39;user Name&#39;).text）的传统程序不同，STP 使用模糊、自然语言风格的指令（例如 get user name as {name}）来构造程序。STP 指令捕捉了交互上下文管理所需的信息，同时在运行时根据实际环境状态进行自适应解释。此外，我们在 STP 执行过程中引入全局信念状态模块，以应对 GUI 环境固有的部分可观测性，这点是传统编程范式所不具备的。</span></p><p><span>We evaluate AgentProg on AndroidWorld [27], a challenging and widely-used benchmark for mobile device-control agents, and introduce an extended task suite that we construct based on AndroidWorld to specifically test agent performance on long-horizon scenarios. Our experiments reveal that while existing methods perform well on the original An-droidWorld benchmark, they exhibit substantial performance degradation on our extended task suite, highlighting their fundamental limitations in handling long-horizon reasoning. In contrast, our program-guided approach demonstrates robust performance across both benchmarks. The context organization ability of AgentProg also helps it achieve the new state of the art on AndroidWorld.</span>
<span>我们在 AndroidWorld [27] 上评估 AgentProg，这是一项具有挑战性且被广泛使用的移动设备控制代理基准，并基于 AndroidWorld 构建扩展任务套件，专门用于测试代理在长时域场景中的表现。实验表明，现有方法在原始的 AndroidWorld 基准上表现良好，但在我们扩展的任务套件上表现显著下降，凸显它们在处理长时域推理方面的基本局限性。相比之下，我们的程序引导方法在两个基准测试上都显示出稳健的性能。AgentProg 的上下文组织能力也帮助其在 AndroidWorld 上达到新的状态最优。</span></p><p><span>Our main contributions are summarized as follows:</span>
<span>我们的主要贡献概括如下：</span></p><p><span>(1) We identify three key challenges for GUI agents on long-horizon tasks, and propose program-guided context management as a principled approach to address these challenges.</span>
<span>(1) 我们识别了长时域任务中 GUI 代理的三个关键挑战，并提出以程序引导的上下文管理作为解决这些挑战的原理性方法。</span></p><p><span>(2) We design and implement AgentProg, a mobile GUI agent based on program-guided context management. We introduce Semantic Task Program and global belief state to address the dynamicity and partial observability problems in program-driven task execution.</span>
<span>(2) 我们设计并实现 AgentProg，这是一种基于程序引导的上下文管理的移动 GUI 代理。我们引入语义任务程序和全局信念状态，以应对程序驱动任务执行中的动态性和部分可观测性问题。</span></p><p><span>(3) AgentProg has been evaluated on AndroidWorld and AW-Extend and achieved the new state of the art.</span>
<span>(3) AgentProg 已在 AndroidWorld 和 AW-Extend 上进行了评估并达到新的状态最优。</span></p><h2 id='2-related-work-and-motivation'><span>2 Related Work and Motivation</span></h2><h2 id='2-相关工作与动机'><span>2 相关工作与动机</span></h2><h3 id='21-gui-agent'><span>2.1 GUI Agent</span></h3><h3 id='21-gui-代理'><span>2.1 GUI 代理</span></h3><p><span>Graphical User Interface (GUI) agents are autonomous systems designed to interact with software applications through their visual interfaces, mimicking human user behavior to accomplish complex tasks. A GUI agent typically takes as input a natural language task instruction (e.g., &quot;Send an email to John about the meeting&quot;) and the current screen state, which includes visual information (screenshots) and optionally structural information (UI element hierarchies such as accessibility trees or HTML DOMs) [25]. The agent outputs a sequence of actions such as clicking on specific UI elements, scrolling, typing text, or navigating between applications to accomplish the specified task within existing software ecosystems.</span>
<span>图形用户界面（GUI）代理是自主系统，设计用于通过可视界面与软件应用交互，模仿人类用户行为以完成复杂任务。一个 GUI 代理通常以自然语言任务指令（例如“给 John 发送一封关于会议的邮件”）以及当前屏幕状态（包括视觉信息（截图）以及可选的结构信息（UI 元素层次结构，如辅助性树或 HTML DOM））作为输入 [25]。代理输出一系列操作，如点击特定 UI 元素、滚动、输入文本，或在应用之间导航，以在现有软件生态中完成指定任务。</span></p><p><span>The decision-making process of a GUI agent can be formalized as a partially observable Markov decision process (POMDP) [30]. At each timestep </span><mjx-container class="MathJax" jax="SVG" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="0.817ex" height="1.441ex" role="img" focusable="false" viewBox="0 -626 361 637" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -0.025ex;"><defs><path id="MJX-546-TEX-I-1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D461" xlink:href="#MJX-546-TEX-I-1D461"></use></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi></math></mjx-assistive-mml></mjx-container><script type="math/tex">t</script><span> ,the agent observes the current screen state </span><mjx-container class="MathJax" jax="SVG" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="1.863ex" height="1.355ex" role="img" focusable="false" viewBox="0 -441 823.3 598.8" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -0.357ex;"><defs><path id="MJX-970-TEX-I-1D45C" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path><path id="MJX-970-TEX-I-1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="TeXAtom" data-mjx-texclass="ORD"><g data-mml-node="mi"><use data-c="1D45C" xlink:href="#MJX-970-TEX-I-1D45C"></use></g></g><g data-mml-node="TeXAtom" transform="translate(518,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><use data-c="1D461" xlink:href="#MJX-970-TEX-I-1D461"></use></g></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mrow data-mjx-texclass="ORD"><mi>o</mi></mrow><mrow data-mjx-texclass="ORD"><mi>t</mi></mrow></msub></math></mjx-assistive-mml></mjx-container><script type="math/tex">{o}_{t}</script><span> and selects an action </span><mjx-container class="MathJax" jax="SVG" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="1.962ex" height="1.355ex" role="img" focusable="false" viewBox="0 -441 867.3 598.8" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -0.357ex;"><defs><path id="MJX-971-TEX-I-1D44E" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path><path id="MJX-971-TEX-I-1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="TeXAtom" data-mjx-texclass="ORD"><g data-mml-node="mi"><use data-c="1D44E" xlink:href="#MJX-971-TEX-I-1D44E"></use></g></g><g data-mml-node="TeXAtom" transform="translate(562,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><use data-c="1D461" xlink:href="#MJX-971-TEX-I-1D461"></use></g></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mrow data-mjx-texclass="ORD"><mi>a</mi></mrow><mrow data-mjx-texclass="ORD"><mi>t</mi></mrow></msub></math></mjx-assistive-mml></mjx-container><script type="math/tex">{a}_{t}</script><span> based on the task goal </span><mjx-container class="MathJax" jax="SVG" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="1.079ex" height="1.464ex" role="img" focusable="false" viewBox="0 -442 477 647" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -0.464ex;"><defs><path id="MJX-1815-TEX-I-1D454" d="M311 43Q296 30 267 15T206 0Q143 0 105 45T66 160Q66 265 143 353T314 442Q361 442 401 394L404 398Q406 401 409 404T418 412T431 419T447 422Q461 422 470 413T480 394Q480 379 423 152T363 -80Q345 -134 286 -169T151 -205Q10 -205 10 -137Q10 -111 28 -91T74 -71Q89 -71 102 -80T116 -111Q116 -121 114 -130T107 -144T99 -154T92 -162L90 -164H91Q101 -167 151 -167Q189 -167 211 -155Q234 -144 254 -122T282 -75Q288 -56 298 -13Q311 35 311 43ZM384 328L380 339Q377 350 375 354T369 368T359 382T346 393T328 402T306 405Q262 405 221 352Q191 313 171 233T151 117Q151 38 213 38Q269 38 323 108L331 118L384 328Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D454" xlink:href="#MJX-1815-TEX-I-1D454"></use></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>g</mi></math></mjx-assistive-mml></mjx-container><script type="math/tex">g</script><span> and the interaction history </span><mjx-container class="MathJax" jax="SVG" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="14.497ex" height="2.262ex" role="img" focusable="false" viewBox="0 -750 6407.7 1000" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -0.566ex;"><defs><path id="MJX-3337-TEX-I-210E" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path><path id="MJX-3337-TEX-N-3C" d="M694 -11T694 -19T688 -33T678 -40Q671 -40 524 29T234 166L90 235Q83 240 83 250Q83 261 91 266Q664 540 678 540Q681 540 687 534T694 519T687 505Q686 504 417 376L151 250L417 124Q686 -4 687 -5Q694 -11 694 -19Z"></path><path id="MJX-3337-TEX-I-1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path><path id="MJX-3337-TEX-N-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path><path id="MJX-3337-TEX-N-7B" d="M434 -231Q434 -244 428 -250H410Q281 -250 230 -184Q225 -177 222 -172T217 -161T213 -148T211 -133T210 -111T209 -84T209 -47T209 0Q209 21 209 53Q208 142 204 153Q203 154 203 155Q189 191 153 211T82 231Q71 231 68 234T65 250T68 266T82 269Q116 269 152 289T203 345Q208 356 208 377T209 529V579Q209 634 215 656T244 698Q270 724 324 740Q361 748 377 749Q379 749 390 749T408 750H428Q434 744 434 732Q434 719 431 716Q429 713 415 713Q362 710 332 689T296 647Q291 634 291 499V417Q291 370 288 353T271 314Q240 271 184 255L170 250L184 245Q202 239 220 230T262 196T290 137Q291 131 291 1Q291 -134 296 -147Q306 -174 339 -192T415 -213Q429 -213 431 -216Q434 -219 434 -231Z"></path><path id="MJX-3337-TEX-N-28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path><path id="MJX-3337-TEX-I-1D45C" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path><path id="MJX-3337-TEX-N-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path><path id="MJX-3337-TEX-N-2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path><path id="MJX-3337-TEX-I-1D44E" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path><path id="MJX-3337-TEX-N-29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="TeXAtom" data-mjx-texclass="ORD"><g data-mml-node="mi"><use data-c="210E" xlink:href="#MJX-3337-TEX-I-210E"></use></g></g><g data-mml-node="TeXAtom" transform="translate(609,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mo"><use data-c="3C" xlink:href="#MJX-3337-TEX-N-3C"></use></g><g data-mml-node="mi" transform="translate(778,0)"><use data-c="1D461" xlink:href="#MJX-3337-TEX-I-1D461"></use></g></g></g><g data-mml-node="mo" transform="translate(1742.2,0)"><use data-c="3D" xlink:href="#MJX-3337-TEX-N-3D"></use></g><g data-mml-node="mrow" transform="translate(2798,0)"><g data-mml-node="mo"><use data-c="7B" xlink:href="#MJX-3337-TEX-N-7B"></use></g><g data-mml-node="mrow" transform="translate(500,0)"><g data-mml-node="mo"><use data-c="28" xlink:href="#MJX-3337-TEX-N-28"></use></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(389,0)"><g data-mml-node="msub"><g data-mml-node="TeXAtom" data-mjx-texclass="ORD"><g data-mml-node="mi"><use data-c="1D45C" xlink:href="#MJX-3337-TEX-I-1D45C"></use></g></g><g data-mml-node="TeXAtom" transform="translate(518,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mn"><use data-c="30" xlink:href="#MJX-3337-TEX-N-30"></use></g></g></g><g data-mml-node="mo" transform="translate(921.6,0)"><use data-c="2C" xlink:href="#MJX-3337-TEX-N-2C"></use></g><g data-mml-node="msub" transform="translate(1366.2,0)"><g data-mml-node="TeXAtom" data-mjx-texclass="ORD"><g data-mml-node="mi"><use data-c="1D44E" xlink:href="#MJX-3337-TEX-I-1D44E"></use></g></g><g data-mml-node="TeXAtom" transform="translate(562,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mn"><use data-c="30" xlink:href="#MJX-3337-TEX-N-30"></use></g></g></g></g><g data-mml-node="mo" transform="translate(2720.8,0)"><use data-c="29" xlink:href="#MJX-3337-TEX-N-29"></use></g></g><g data-mml-node="mo" transform="translate(3609.8,0) translate(0 250)"></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mrow data-mjx-texclass="ORD"><mi>h</mi></mrow><mrow data-mjx-texclass="ORD"><mo>&lt;</mo><mi>t</mi></mrow></msub><mo>=</mo><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">{</mo><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><mrow data-mjx-texclass="ORD"><msub><mrow data-mjx-texclass="ORD"><mi>o</mi></mrow><mrow data-mjx-texclass="ORD"><mn>0</mn></mrow></msub><mo>,</mo><msub><mrow data-mjx-texclass="ORD"><mi>a</mi></mrow><mrow data-mjx-texclass="ORD"><mn>0</mn></mrow></msub></mrow><mo data-mjx-texclass="CLOSE">)</mo></mrow><mo data-mjx-texclass="CLOSE" fence="true" stretchy="true" symmetric="true"></mo></mrow></math></mjx-assistive-mml></mjx-container><script type="math/tex">{h}_{ < t} = \left\{  \left( {{o}_{0},{a}_{0}}\right) \right.</script><span> , </span><mjx-container class="MathJax" jax="SVG" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="23.888ex" height="2.262ex" role="img" focusable="false" viewBox="0 -750 10558.3 1000" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -0.566ex;"><defs><path id="MJX-3338-TEX-N-28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path><path id="MJX-3338-TEX-I-1D45C" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path><path id="MJX-3338-TEX-N-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path id="MJX-3338-TEX-N-2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path><path id="MJX-3338-TEX-I-1D44E" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path><path id="MJX-3338-TEX-N-29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path><path id="MJX-3338-TEX-N-2026" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60ZM525 60Q525 84 542 102T585 120Q609 120 627 104T646 61Q646 36 629 18T586 0T543 17T525 60ZM972 60Q972 84 989 102T1032 120Q1056 120 1074 104T1093 61Q1093 36 1076 18T1033 0T990 17T972 60Z"></path><path id="MJX-3338-TEX-I-1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path><path id="MJX-3338-TEX-N-2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path><path id="MJX-3338-TEX-N-7D" d="M65 731Q65 745 68 747T88 750Q171 750 216 725T279 670Q288 649 289 635T291 501Q292 362 293 357Q306 312 345 291T417 269Q428 269 431 266T434 250T431 234T417 231Q380 231 345 210T298 157Q293 143 292 121T291 -28V-79Q291 -134 285 -156T256 -198Q202 -250 89 -250Q71 -250 68 -247T65 -230Q65 -224 65 -223T66 -218T69 -214T77 -213Q91 -213 108 -210T146 -200T183 -177T207 -139Q208 -134 209 3L210 139Q223 196 280 230Q315 247 330 250Q305 257 280 270Q225 304 212 352L210 362L209 498Q208 635 207 640Q195 680 154 696T77 713Q68 713 67 716T65 731Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mrow"><g data-mml-node="mo" transform="translate(0 250)"></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD"><g data-mml-node="mrow"><g data-mml-node="mo"><use data-c="28" xlink:href="#MJX-3338-TEX-N-28"></use></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(389,0)"><g data-mml-node="msub"><g data-mml-node="TeXAtom" data-mjx-texclass="ORD"><g data-mml-node="mi"><use data-c="1D45C" xlink:href="#MJX-3338-TEX-I-1D45C"></use></g></g><g data-mml-node="TeXAtom" transform="translate(518,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mn"><use data-c="31" xlink:href="#MJX-3338-TEX-N-31"></use></g></g></g><g data-mml-node="mo" transform="translate(921.6,0)"><use data-c="2C" xlink:href="#MJX-3338-TEX-N-2C"></use></g><g data-mml-node="msub" transform="translate(1366.2,0)"><g data-mml-node="TeXAtom" data-mjx-texclass="ORD"><g data-mml-node="mi"><use data-c="1D44E" xlink:href="#MJX-3338-TEX-I-1D44E"></use></g></g><g data-mml-node="TeXAtom" transform="translate(562,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mn"><use data-c="31" xlink:href="#MJX-3338-TEX-N-31"></use></g></g></g></g><g data-mml-node="mo" transform="translate(2720.8,0)"><use data-c="29" xlink:href="#MJX-3338-TEX-N-29"></use></g></g><g data-mml-node="mo" transform="translate(3109.8,0)"><use data-c="2C" xlink:href="#MJX-3338-TEX-N-2C"></use></g><g data-mml-node="mo" transform="translate(3554.4,0)"><use data-c="2026" xlink:href="#MJX-3338-TEX-N-2026"></use></g><g data-mml-node="mo" transform="translate(4893.1,0)"><use data-c="2C" xlink:href="#MJX-3338-TEX-N-2C"></use></g><g data-mml-node="mrow" transform="translate(5337.8,0)"><g data-mml-node="mo"><use data-c="28" xlink:href="#MJX-3338-TEX-N-28"></use></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(389,0)"><g data-mml-node="msub"><g data-mml-node="TeXAtom" data-mjx-texclass="ORD"><g data-mml-node="mi"><use data-c="1D45C" xlink:href="#MJX-3338-TEX-I-1D45C"></use></g></g><g data-mml-node="TeXAtom" transform="translate(518,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><use data-c="1D461" xlink:href="#MJX-3338-TEX-I-1D461"></use></g><g data-mml-node="mo" transform="translate(361,0)"><use data-c="2212" xlink:href="#MJX-3338-TEX-N-2212"></use></g><g data-mml-node="mn" transform="translate(1139,0)"><use data-c="31" xlink:href="#MJX-3338-TEX-N-31"></use></g></g></g><g data-mml-node="mo" transform="translate(1726.9,0)"><use data-c="2C" xlink:href="#MJX-3338-TEX-N-2C"></use></g><g data-mml-node="msub" transform="translate(2171.6,0)"><g data-mml-node="TeXAtom" data-mjx-texclass="ORD"><g data-mml-node="mi"><use data-c="1D44E" xlink:href="#MJX-3338-TEX-I-1D44E"></use></g></g><g data-mml-node="TeXAtom" transform="translate(562,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><use data-c="1D461" xlink:href="#MJX-3338-TEX-I-1D461"></use></g><g data-mml-node="mo" transform="translate(361,0)"><use data-c="2212" xlink:href="#MJX-3338-TEX-N-2212"></use></g><g data-mml-node="mn" transform="translate(1139,0)"><use data-c="31" xlink:href="#MJX-3338-TEX-N-31"></use></g></g></g></g><g data-mml-node="mo" transform="translate(4331.6,0)"><use data-c="29" xlink:href="#MJX-3338-TEX-N-29"></use></g></g></g><g data-mml-node="mo" transform="translate(10058.3,0)"><use data-c="7D" xlink:href="#MJX-3338-TEX-N-7D"></use></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN" fence="true" stretchy="true" symmetric="true"></mo><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><mrow data-mjx-texclass="ORD"><msub><mrow data-mjx-texclass="ORD"><mi>o</mi></mrow><mrow data-mjx-texclass="ORD"><mn>1</mn></mrow></msub><mo>,</mo><msub><mrow data-mjx-texclass="ORD"><mi>a</mi></mrow><mrow data-mjx-texclass="ORD"><mn>1</mn></mrow></msub></mrow><mo data-mjx-texclass="CLOSE">)</mo></mrow><mo>,</mo><mo>…</mo><mo>,</mo><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><mrow data-mjx-texclass="ORD"><msub><mrow data-mjx-texclass="ORD"><mi>o</mi></mrow><mrow data-mjx-texclass="ORD"><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>,</mo><msub><mrow data-mjx-texclass="ORD"><mi>a</mi></mrow><mrow data-mjx-texclass="ORD"><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow><mo data-mjx-texclass="CLOSE">)</mo></mrow></mrow><mo data-mjx-texclass="CLOSE">}</mo></mrow></math></mjx-assistive-mml></mjx-container><script type="math/tex">\left. {\left( {{o}_{1},{a}_{1}}\right) ,\ldots ,\left( {{o}_{t - 1},{a}_{t - 1}}\right) }\right\}</script><span> . The environment then transitions to a new state,providing observation </span><mjx-container class="MathJax" jax="SVG" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="3.907ex" height="1.468ex" role="img" focusable="false" viewBox="0 -441 1726.9 649" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -0.471ex;"><defs><path id="MJX-972-TEX-I-1D45C" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path><path id="MJX-972-TEX-I-1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path><path id="MJX-972-TEX-N-2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path><path id="MJX-972-TEX-N-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="TeXAtom" data-mjx-texclass="ORD"><g data-mml-node="mi"><use data-c="1D45C" xlink:href="#MJX-972-TEX-I-1D45C"></use></g></g><g data-mml-node="TeXAtom" transform="translate(518,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><use data-c="1D461" xlink:href="#MJX-972-TEX-I-1D461"></use></g><g data-mml-node="mo" transform="translate(361,0)"><use data-c="2B" xlink:href="#MJX-972-TEX-N-2B"></use></g><g data-mml-node="mn" transform="translate(1139,0)"><use data-c="31" xlink:href="#MJX-972-TEX-N-31"></use></g></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mrow data-mjx-texclass="ORD"><mi>o</mi></mrow><mrow data-mjx-texclass="ORD"><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub></math></mjx-assistive-mml></mjx-container><script type="math/tex">{o}_{t + 1}</script><span> . This process continues until the task is completed or a maximum number of steps is reached. The core challenge lies in how agents manage the ever-growing interaction history </span><mjx-container class="MathJax" jax="SVG" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="3.313ex" height="1.973ex" role="img" focusable="false" viewBox="0 -694 1464.4 872.3" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -0.403ex;"><defs><path id="MJX-3339-TEX-I-210E" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path><path id="MJX-3339-TEX-N-3C" d="M694 -11T694 -19T688 -33T678 -40Q671 -40 524 29T234 166L90 235Q83 240 83 250Q83 261 91 266Q664 540 678 540Q681 540 687 534T694 519T687 505Q686 504 417 376L151 250L417 124Q686 -4 687 -5Q694 -11 694 -19Z"></path><path id="MJX-3339-TEX-I-1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="TeXAtom" data-mjx-texclass="ORD"><g data-mml-node="mi"><use data-c="210E" xlink:href="#MJX-3339-TEX-I-210E"></use></g></g><g data-mml-node="TeXAtom" transform="translate(609,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mo"><use data-c="3C" xlink:href="#MJX-3339-TEX-N-3C"></use></g><g data-mml-node="mi" transform="translate(778,0)"><use data-c="1D461" xlink:href="#MJX-3339-TEX-I-1D461"></use></g></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mrow data-mjx-texclass="ORD"><mi>h</mi></mrow><mrow data-mjx-texclass="ORD"><mo>&lt;</mo><mi>t</mi></mrow></msub></math></mjx-assistive-mml></mjx-container><script type="math/tex">{h}_{ < t}</script><span> while maintaining accurate understanding of the current environment state.</span>
<span>GUI 代理的决策过程可以形式化为部分可观测的马尔可夫决策过程（POMDP）[30]。在每个时间步 </span><mjx-container class="MathJax" jax="SVG" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="0.817ex" height="1.441ex" role="img" focusable="false" viewBox="0 -626 361 637" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -0.025ex;"><defs><path id="MJX-546-TEX-I-1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D461" xlink:href="#MJX-546-TEX-I-1D461"></use></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi></math></mjx-assistive-mml></mjx-container><script type="math/tex">t</script><span>，代理观察当前屏幕状态 </span><mjx-container class="MathJax" jax="SVG" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="1.863ex" height="1.355ex" role="img" focusable="false" viewBox="0 -441 823.3 598.8" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -0.357ex;"><defs><path id="MJX-970-TEX-I-1D45C" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path><path id="MJX-970-TEX-I-1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="TeXAtom" data-mjx-texclass="ORD"><g data-mml-node="mi"><use data-c="1D45C" xlink:href="#MJX-970-TEX-I-1D45C"></use></g></g><g data-mml-node="TeXAtom" transform="translate(518,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><use data-c="1D461" xlink:href="#MJX-970-TEX-I-1D461"></use></g></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mrow data-mjx-texclass="ORD"><mi>o</mi></mrow><mrow data-mjx-texclass="ORD"><mi>t</mi></mrow></msub></math></mjx-assistive-mml></mjx-container><script type="math/tex">{o}_{t}</script><span>，并基于任务目标 </span><mjx-container class="MathJax" jax="SVG" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="1.079ex" height="1.464ex" role="img" focusable="false" viewBox="0 -442 477 647" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -0.464ex;"><defs><path id="MJX-1815-TEX-I-1D454" d="M311 43Q296 30 267 15T206 0Q143 0 105 45T66 160Q66 265 143 353T314 442Q361 442 401 394L404 398Q406 401 409 404T418 412T431 419T447 422Q461 422 470 413T480 394Q480 379 423 152T363 -80Q345 -134 286 -169T151 -205Q10 -205 10 -137Q10 -111 28 -91T74 -71Q89 -71 102 -80T116 -111Q116 -121 114 -130T107 -144T99 -154T92 -162L90 -164H91Q101 -167 151 -167Q189 -167 211 -155Q234 -144 254 -122T282 -75Q288 -56 298 -13Q311 35 311 43ZM384 328L380 339Q377 350 375 354T369 368T359 382T346 393T328 402T306 405Q262 405 221 352Q191 313 171 233T151 117Q151 38 213 38Q269 38 323 108L331 118L384 328Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D454" xlink:href="#MJX-1815-TEX-I-1D454"></use></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>g</mi></math></mjx-assistive-mml></mjx-container><script type="math/tex">g</script><span>、交互历史 </span><mjx-container class="MathJax" jax="SVG" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="14.497ex" height="2.262ex" role="img" focusable="false" viewBox="0 -750 6407.7 1000" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -0.566ex;"><defs><path id="MJX-3337-TEX-I-210E" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path><path id="MJX-3337-TEX-N-3C" d="M694 -11T694 -19T688 -33T678 -40Q671 -40 524 29T234 166L90 235Q83 240 83 250Q83 261 91 266Q664 540 678 540Q681 540 687 534T694 519T687 505Q686 504 417 376L151 250L417 124Q686 -4 687 -5Q694 -11 694 -19Z"></path><path id="MJX-3337-TEX-I-1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path><path id="MJX-3337-TEX-N-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path><path id="MJX-3337-TEX-N-7B" d="M434 -231Q434 -244 428 -250H410Q281 -250 230 -184Q225 -177 222 -172T217 -161T213 -148T211 -133T210 -111T209 -84T209 -47T209 0Q209 21 209 53Q208 142 204 153Q203 154 203 155Q189 191 153 211T82 231Q71 231 68 234T65 250T68 266T82 269Q116 269 152 289T203 345Q208 356 208 377T209 529V579Q209 634 215 656T244 698Q270 724 324 740Q361 748 377 749Q379 749 390 749T408 750H428Q434 744 434 732Q434 719 431 716Q429 713 415 713Q362 710 332 689T296 647Q291 634 291 499V417Q291 370 288 353T271 314Q240 271 184 255L170 250L184 245Q202 239 220 230T262 196T290 137Q291 131 291 1Q291 -134 296 -147Q306 -174 339 -192T415 -213Q429 -213 431 -216Q434 -219 434 -231Z"></path><path id="MJX-3337-TEX-N-28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path><path id="MJX-3337-TEX-I-1D45C" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path><path id="MJX-3337-TEX-N-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path><path id="MJX-3337-TEX-N-2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path><path id="MJX-3337-TEX-I-1D44E" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path><path id="MJX-3337-TEX-N-29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="TeXAtom" data-mjx-texclass="ORD"><g data-mml-node="mi"><use data-c="210E" xlink:href="#MJX-3337-TEX-I-210E"></use></g></g><g data-mml-node="TeXAtom" transform="translate(609,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mo"><use data-c="3C" xlink:href="#MJX-3337-TEX-N-3C"></use></g><g data-mml-node="mi" transform="translate(778,0)"><use data-c="1D461" xlink:href="#MJX-3337-TEX-I-1D461"></use></g></g></g><g data-mml-node="mo" transform="translate(1742.2,0)"><use data-c="3D" xlink:href="#MJX-3337-TEX-N-3D"></use></g><g data-mml-node="mrow" transform="translate(2798,0)"><g data-mml-node="mo"><use data-c="7B" xlink:href="#MJX-3337-TEX-N-7B"></use></g><g data-mml-node="mrow" transform="translate(500,0)"><g data-mml-node="mo"><use data-c="28" xlink:href="#MJX-3337-TEX-N-28"></use></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(389,0)"><g data-mml-node="msub"><g data-mml-node="TeXAtom" data-mjx-texclass="ORD"><g data-mml-node="mi"><use data-c="1D45C" xlink:href="#MJX-3337-TEX-I-1D45C"></use></g></g><g data-mml-node="TeXAtom" transform="translate(518,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mn"><use data-c="30" xlink:href="#MJX-3337-TEX-N-30"></use></g></g></g><g data-mml-node="mo" transform="translate(921.6,0)"><use data-c="2C" xlink:href="#MJX-3337-TEX-N-2C"></use></g><g data-mml-node="msub" transform="translate(1366.2,0)"><g data-mml-node="TeXAtom" data-mjx-texclass="ORD"><g data-mml-node="mi"><use data-c="1D44E" xlink:href="#MJX-3337-TEX-I-1D44E"></use></g></g><g data-mml-node="TeXAtom" transform="translate(562,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mn"><use data-c="30" xlink:href="#MJX-3337-TEX-N-30"></use></g></g></g></g><g data-mml-node="mo" transform="translate(2720.8,0)"><use data-c="29" xlink:href="#MJX-3337-TEX-N-29"></use></g></g><g data-mml-node="mo" transform="translate(3609.8,0) translate(0 250)"></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mrow data-mjx-texclass="ORD"><mi>h</mi></mrow><mrow data-mjx-texclass="ORD"><mo>&lt;</mo><mi>t</mi></mrow></msub><mo>=</mo><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">{</mo><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><mrow data-mjx-texclass="ORD"><msub><mrow data-mjx-texclass="ORD"><mi>o</mi></mrow><mrow data-mjx-texclass="ORD"><mn>0</mn></mrow></msub><mo>,</mo><msub><mrow data-mjx-texclass="ORD"><mi>a</mi></mrow><mrow data-mjx-texclass="ORD"><mn>0</mn></mrow></msub></mrow><mo data-mjx-texclass="CLOSE">)</mo></mrow><mo data-mjx-texclass="CLOSE" fence="true" stretchy="true" symmetric="true"></mo></mrow></math></mjx-assistive-mml></mjx-container><script type="math/tex">{h}_{ < t} = \left\{  \left( {{o}_{0},{a}_{0}}\right) \right.</script><span>、</span><mjx-container class="MathJax" jax="SVG" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="23.888ex" height="2.262ex" role="img" focusable="false" viewBox="0 -750 10558.3 1000" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -0.566ex;"><defs><path id="MJX-3338-TEX-N-28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path><path id="MJX-3338-TEX-I-1D45C" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path><path id="MJX-3338-TEX-N-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path id="MJX-3338-TEX-N-2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path><path id="MJX-3338-TEX-I-1D44E" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path><path id="MJX-3338-TEX-N-29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path><path id="MJX-3338-TEX-N-2026" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60ZM525 60Q525 84 542 102T585 120Q609 120 627 104T646 61Q646 36 629 18T586 0T543 17T525 60ZM972 60Q972 84 989 102T1032 120Q1056 120 1074 104T1093 61Q1093 36 1076 18T1033 0T990 17T972 60Z"></path><path id="MJX-3338-TEX-I-1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path><path id="MJX-3338-TEX-N-2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path><path id="MJX-3338-TEX-N-7D" d="M65 731Q65 745 68 747T88 750Q171 750 216 725T279 670Q288 649 289 635T291 501Q292 362 293 357Q306 312 345 291T417 269Q428 269 431 266T434 250T431 234T417 231Q380 231 345 210T298 157Q293 143 292 121T291 -28V-79Q291 -134 285 -156T256 -198Q202 -250 89 -250Q71 -250 68 -247T65 -230Q65 -224 65 -223T66 -218T69 -214T77 -213Q91 -213 108 -210T146 -200T183 -177T207 -139Q208 -134 209 3L210 139Q223 196 280 230Q315 247 330 250Q305 257 280 270Q225 304 212 352L210 362L209 498Q208 635 207 640Q195 680 154 696T77 713Q68 713 67 716T65 731Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mrow"><g data-mml-node="mo" transform="translate(0 250)"></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD"><g data-mml-node="mrow"><g data-mml-node="mo"><use data-c="28" xlink:href="#MJX-3338-TEX-N-28"></use></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(389,0)"><g data-mml-node="msub"><g data-mml-node="TeXAtom" data-mjx-texclass="ORD"><g data-mml-node="mi"><use data-c="1D45C" xlink:href="#MJX-3338-TEX-I-1D45C"></use></g></g><g data-mml-node="TeXAtom" transform="translate(518,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mn"><use data-c="31" xlink:href="#MJX-3338-TEX-N-31"></use></g></g></g><g data-mml-node="mo" transform="translate(921.6,0)"><use data-c="2C" xlink:href="#MJX-3338-TEX-N-2C"></use></g><g data-mml-node="msub" transform="translate(1366.2,0)"><g data-mml-node="TeXAtom" data-mjx-texclass="ORD"><g data-mml-node="mi"><use data-c="1D44E" xlink:href="#MJX-3338-TEX-I-1D44E"></use></g></g><g data-mml-node="TeXAtom" transform="translate(562,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mn"><use data-c="31" xlink:href="#MJX-3338-TEX-N-31"></use></g></g></g></g><g data-mml-node="mo" transform="translate(2720.8,0)"><use data-c="29" xlink:href="#MJX-3338-TEX-N-29"></use></g></g><g data-mml-node="mo" transform="translate(3109.8,0)"><use data-c="2C" xlink:href="#MJX-3338-TEX-N-2C"></use></g><g data-mml-node="mo" transform="translate(3554.4,0)"><use data-c="2026" xlink:href="#MJX-3338-TEX-N-2026"></use></g><g data-mml-node="mo" transform="translate(4893.1,0)"><use data-c="2C" xlink:href="#MJX-3338-TEX-N-2C"></use></g><g data-mml-node="mrow" transform="translate(5337.8,0)"><g data-mml-node="mo"><use data-c="28" xlink:href="#MJX-3338-TEX-N-28"></use></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(389,0)"><g data-mml-node="msub"><g data-mml-node="TeXAtom" data-mjx-texclass="ORD"><g data-mml-node="mi"><use data-c="1D45C" xlink:href="#MJX-3338-TEX-I-1D45C"></use></g></g><g data-mml-node="TeXAtom" transform="translate(518,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><use data-c="1D461" xlink:href="#MJX-3338-TEX-I-1D461"></use></g><g data-mml-node="mo" transform="translate(361,0)"><use data-c="2212" xlink:href="#MJX-3338-TEX-N-2212"></use></g><g data-mml-node="mn" transform="translate(1139,0)"><use data-c="31" xlink:href="#MJX-3338-TEX-N-31"></use></g></g></g><g data-mml-node="mo" transform="translate(1726.9,0)"><use data-c="2C" xlink:href="#MJX-3338-TEX-N-2C"></use></g><g data-mml-node="msub" transform="translate(2171.6,0)"><g data-mml-node="TeXAtom" data-mjx-texclass="ORD"><g data-mml-node="mi"><use data-c="1D44E" xlink:href="#MJX-3338-TEX-I-1D44E"></use></g></g><g data-mml-node="TeXAtom" transform="translate(562,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><use data-c="1D461" xlink:href="#MJX-3338-TEX-I-1D461"></use></g><g data-mml-node="mo" transform="translate(361,0)"><use data-c="2212" xlink:href="#MJX-3338-TEX-N-2212"></use></g><g data-mml-node="mn" transform="translate(1139,0)"><use data-c="31" xlink:href="#MJX-3338-TEX-N-31"></use></g></g></g></g><g data-mml-node="mo" transform="translate(4331.6,0)"><use data-c="29" xlink:href="#MJX-3338-TEX-N-29"></use></g></g></g><g data-mml-node="mo" transform="translate(10058.3,0)"><use data-c="7D" xlink:href="#MJX-3338-TEX-N-7D"></use></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN" fence="true" stretchy="true" symmetric="true"></mo><mrow data-mjx-texclass="ORD"><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><mrow data-mjx-texclass="ORD"><msub><mrow data-mjx-texclass="ORD"><mi>o</mi></mrow><mrow data-mjx-texclass="ORD"><mn>1</mn></mrow></msub><mo>,</mo><msub><mrow data-mjx-texclass="ORD"><mi>a</mi></mrow><mrow data-mjx-texclass="ORD"><mn>1</mn></mrow></msub></mrow><mo data-mjx-texclass="CLOSE">)</mo></mrow><mo>,</mo><mo>…</mo><mo>,</mo><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">(</mo><mrow data-mjx-texclass="ORD"><msub><mrow data-mjx-texclass="ORD"><mi>o</mi></mrow><mrow data-mjx-texclass="ORD"><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>,</mo><msub><mrow data-mjx-texclass="ORD"><mi>a</mi></mrow><mrow data-mjx-texclass="ORD"><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow><mo data-mjx-texclass="CLOSE">)</mo></mrow></mrow><mo data-mjx-texclass="CLOSE">}</mo></mrow></math></mjx-assistive-mml></mjx-container><script type="math/tex">\left. {\left( {{o}_{1},{a}_{1}}\right) ,\ldots ,\left( {{o}_{t - 1},{a}_{t - 1}}\right) }\right\}</script><span> 选择一个动作 </span><mjx-container class="MathJax" jax="SVG" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="1.962ex" height="1.355ex" role="img" focusable="false" viewBox="0 -441 867.3 598.8" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -0.357ex;"><defs><path id="MJX-971-TEX-I-1D44E" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path><path id="MJX-971-TEX-I-1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="TeXAtom" data-mjx-texclass="ORD"><g data-mml-node="mi"><use data-c="1D44E" xlink:href="#MJX-971-TEX-I-1D44E"></use></g></g><g data-mml-node="TeXAtom" transform="translate(562,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><use data-c="1D461" xlink:href="#MJX-971-TEX-I-1D461"></use></g></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mrow data-mjx-texclass="ORD"><mi>a</mi></mrow><mrow data-mjx-texclass="ORD"><mi>t</mi></mrow></msub></math></mjx-assistive-mml></mjx-container><script type="math/tex">{a}_{t}</script><span>。环境随后转移到新状态，提供观测 </span><mjx-container class="MathJax" jax="SVG" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="3.907ex" height="1.468ex" role="img" focusable="false" viewBox="0 -441 1726.9 649" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -0.471ex;"><defs><path id="MJX-972-TEX-I-1D45C" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path><path id="MJX-972-TEX-I-1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path><path id="MJX-972-TEX-N-2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path><path id="MJX-972-TEX-N-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="TeXAtom" data-mjx-texclass="ORD"><g data-mml-node="mi"><use data-c="1D45C" xlink:href="#MJX-972-TEX-I-1D45C"></use></g></g><g data-mml-node="TeXAtom" transform="translate(518,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><use data-c="1D461" xlink:href="#MJX-972-TEX-I-1D461"></use></g><g data-mml-node="mo" transform="translate(361,0)"><use data-c="2B" xlink:href="#MJX-972-TEX-N-2B"></use></g><g data-mml-node="mn" transform="translate(1139,0)"><use data-c="31" xlink:href="#MJX-972-TEX-N-31"></use></g></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mrow data-mjx-texclass="ORD"><mi>o</mi></mrow><mrow data-mjx-texclass="ORD"><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub></math></mjx-assistive-mml></mjx-container><script type="math/tex">{o}_{t + 1}</script><span>。这个过程一直持续，直到任务完成或达到最大步数。核心挑战在于代理如何在不断增长的交互历史 </span><mjx-container class="MathJax" jax="SVG" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="3.313ex" height="1.973ex" role="img" focusable="false" viewBox="0 -694 1464.4 872.3" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -0.403ex;"><defs><path id="MJX-3339-TEX-I-210E" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path><path id="MJX-3339-TEX-N-3C" d="M694 -11T694 -19T688 -33T678 -40Q671 -40 524 29T234 166L90 235Q83 240 83 250Q83 261 91 266Q664 540 678 540Q681 540 687 534T694 519T687 505Q686 504 417 376L151 250L417 124Q686 -4 687 -5Q694 -11 694 -19Z"></path><path id="MJX-3339-TEX-I-1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="TeXAtom" data-mjx-texclass="ORD"><g data-mml-node="mi"><use data-c="210E" xlink:href="#MJX-3339-TEX-I-210E"></use></g></g><g data-mml-node="TeXAtom" transform="translate(609,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mo"><use data-c="3C" xlink:href="#MJX-3339-TEX-N-3C"></use></g><g data-mml-node="mi" transform="translate(778,0)"><use data-c="1D461" xlink:href="#MJX-3339-TEX-I-1D461"></use></g></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mrow data-mjx-texclass="ORD"><mi>h</mi></mrow><mrow data-mjx-texclass="ORD"><mo>&lt;</mo><mi>t</mi></mrow></msub></math></mjx-assistive-mml></mjx-container><script type="math/tex">{h}_{ < t}</script><span> 中保持对当前环境状态的准确理解。</span></p><h3 id='22-related-work'><span>2.2 Related Work</span></h3><h3 id='22-相关工作'><span>2.2 相关工作</span></h3><p><span>GUI Agents with Foundation Models. Recent advances in large language models and multimodal large language models have significantly enhanced their capabilities in language understanding and cognitive processing, enabling effective interpretation of human instructions, detailed planning, and complex task execution [44]. Early approaches combined LLMs with domain-specific knowledge to achieve smartphone automation [40, 51], while subsequent methods introduced refined control mechanisms for mobile applications through visual perception and multimodal reasoning [47, 50, 51]. Vision-centric approaches have been proposed that identify and locate UI elements directly from visual inputs without relying on XML metadata or system accessibility trees </span><mjx-container class="MathJax" jax="SVG" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="24.137ex" height="2.262ex" role="img" focusable="false" viewBox="0 -750 10668.7 1000" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -0.566ex;"><defs><path id="MJX-3341-TEX-N-5B" d="M118 -250V750H255V710H158V-210H255V-250H118Z"></path><path id="MJX-3341-TEX-N-34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path><path id="MJX-3341-TEX-N-2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path><path id="MJX-3341-TEX-N-39" d="M352 287Q304 211 232 211Q154 211 104 270T44 396Q42 412 42 436V444Q42 537 111 606Q171 666 243 666Q245 666 249 666T257 665H261Q273 665 286 663T323 651T370 619T413 560Q456 472 456 334Q456 194 396 97Q361 41 312 10T208 -22Q147 -22 108 7T68 93T121 149Q143 149 158 135T173 96Q173 78 164 65T148 49T135 44L131 43Q131 41 138 37T164 27T206 22H212Q272 22 313 86Q352 142 352 280V287ZM244 248Q292 248 321 297T351 430Q351 508 343 542Q341 552 337 562T323 588T293 615T246 625Q208 625 181 598Q160 576 154 546T147 441Q147 358 152 329T172 282Q197 248 244 248Z"></path><path id="MJX-3341-TEX-N-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path id="MJX-3341-TEX-N-36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z"></path><path id="MJX-3341-TEX-N-37" d="M55 458Q56 460 72 567L88 674Q88 676 108 676H128V672Q128 662 143 655T195 646T364 644H485V605L417 512Q408 500 387 472T360 435T339 403T319 367T305 330T292 284T284 230T278 162T275 80Q275 66 275 52T274 28V19Q270 2 255 -10T221 -22Q210 -22 200 -19T179 0T168 40Q168 198 265 368Q285 400 349 489L395 552H302Q128 552 119 546Q113 543 108 522T98 479L95 458V455H55V458Z"></path><path id="MJX-3341-TEX-N-33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path id="MJX-3341-TEX-N-35" d="M164 157Q164 133 148 117T109 101H102Q148 22 224 22Q294 22 326 82Q345 115 345 210Q345 313 318 349Q292 382 260 382H254Q176 382 136 314Q132 307 129 306T114 304Q97 304 95 310Q93 314 93 485V614Q93 664 98 664Q100 666 102 666Q103 666 123 658T178 642T253 634Q324 634 389 662Q397 666 402 666Q410 666 410 648V635Q328 538 205 538Q174 538 149 544L139 546V374Q158 388 169 396T205 412T256 420Q337 420 393 355T449 201Q449 109 385 44T229 -22Q148 -22 99 32T50 154Q50 178 61 192T84 210T107 214Q132 214 148 197T164 157Z"></path><path id="MJX-3341-TEX-N-5D" d="M22 710V750H159V-250H22V-210H119V710H22Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mrow"><g data-mml-node="mo"><use data-c="5B" xlink:href="#MJX-3341-TEX-N-5B"></use></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(278,0)"><g data-mml-node="mn"><use data-c="34" xlink:href="#MJX-3341-TEX-N-34"></use></g><g data-mml-node="mo" transform="translate(500,0)"><use data-c="2C" xlink:href="#MJX-3341-TEX-N-2C"></use></g><g data-mml-node="mn" transform="translate(944.7,0)"><use data-c="39" xlink:href="#MJX-3341-TEX-N-39"></use></g><g data-mml-node="mo" transform="translate(1444.7,0)"><use data-c="2C" xlink:href="#MJX-3341-TEX-N-2C"></use></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(1889.3,0)"><g data-mml-node="mn"><use data-c="31" xlink:href="#MJX-3341-TEX-N-31"></use><use data-c="36" xlink:href="#MJX-3341-TEX-N-36" transform="translate(500,0)"></use></g></g><g data-mml-node="mo" transform="translate(2889.3,0)"><use data-c="2C" xlink:href="#MJX-3341-TEX-N-2C"></use></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(3334,0)"><g data-mml-node="mn"><use data-c="31" xlink:href="#MJX-3341-TEX-N-31"></use><use data-c="37" xlink:href="#MJX-3341-TEX-N-37" transform="translate(500,0)"></use></g></g><g data-mml-node="mo" transform="translate(4334,0)"><use data-c="2C" xlink:href="#MJX-3341-TEX-N-2C"></use></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(4778.7,0)"><g data-mml-node="mn"><use data-c="33" xlink:href="#MJX-3341-TEX-N-33"></use><use data-c="34" xlink:href="#MJX-3341-TEX-N-34" transform="translate(500,0)"></use></g></g><g data-mml-node="mo" transform="translate(5778.7,0)"><use data-c="2C" xlink:href="#MJX-3341-TEX-N-2C"></use></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(6223.3,0)"><g data-mml-node="mn"><use data-c="33" xlink:href="#MJX-3341-TEX-N-33"></use><use data-c="35" xlink:href="#MJX-3341-TEX-N-35" transform="translate(500,0)"></use></g></g><g data-mml-node="mo" transform="translate(7223.3,0)"><use data-c="2C" xlink:href="#MJX-3341-TEX-N-2C"></use></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(7668,0)"><g data-mml-node="mn"><use data-c="34" xlink:href="#MJX-3341-TEX-N-34"></use><use data-c="33" xlink:href="#MJX-3341-TEX-N-33" transform="translate(500,0)"></use></g></g><g data-mml-node="mo" transform="translate(8668,0)"><use data-c="2C" xlink:href="#MJX-3341-TEX-N-2C"></use></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(9112.7,0)"><g data-mml-node="mn"><use data-c="35" xlink:href="#MJX-3341-TEX-N-35"></use><use data-c="34" xlink:href="#MJX-3341-TEX-N-34" transform="translate(500,0)"></use></g></g></g><g data-mml-node="mo" transform="translate(10390.7,0)"><use data-c="5D" xlink:href="#MJX-3341-TEX-N-5D"></use></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">[</mo><mrow data-mjx-texclass="ORD"><mn>4</mn><mo>,</mo><mn>9</mn><mo>,</mo><mrow data-mjx-texclass="ORD"><mn>16</mn></mrow><mo>,</mo><mrow data-mjx-texclass="ORD"><mn>17</mn></mrow><mo>,</mo><mrow data-mjx-texclass="ORD"><mn>34</mn></mrow><mo>,</mo><mrow data-mjx-texclass="ORD"><mn>35</mn></mrow><mo>,</mo><mrow data-mjx-texclass="ORD"><mn>43</mn></mrow><mo>,</mo><mrow data-mjx-texclass="ORD"><mn>54</mn></mrow></mrow><mo data-mjx-texclass="CLOSE">]</mo></mrow></math></mjx-assistive-mml></mjx-container><script type="math/tex">\left\lbrack  {4,9,{16},{17},{34},{35},{43},{54}}\right\rbrack</script><span> .</span>
<span>基于基础模型的 GUI 代理。近年来，大型语言模型和多模态大语言模型的进展显著提升了其语言理解与认知处理能力，使其能够有效理解人类指令、进行详细规划并执行复杂任务 [44]。早期方法将 LLM 与领域知识结合，以实现智能手机自动化 [40, 51]，随后的方法通过视觉感知和多模态推理引入了对移动应用的更 refined 控制机制 [47, 50, 51]。也有视觉为核心的方法被提出，直接从视觉输入识别和定位 UI 元素，而不依赖 XML 元数据或系统辅助树 </span><mjx-container class="MathJax" jax="SVG" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="24.137ex" height="2.262ex" role="img" focusable="false" viewBox="0 -750 10668.7 1000" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -0.566ex;"><defs><path id="MJX-3341-TEX-N-5B" d="M118 -250V750H255V710H158V-210H255V-250H118Z"></path><path id="MJX-3341-TEX-N-34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path><path id="MJX-3341-TEX-N-2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path><path id="MJX-3341-TEX-N-39" d="M352 287Q304 211 232 211Q154 211 104 270T44 396Q42 412 42 436V444Q42 537 111 606Q171 666 243 666Q245 666 249 666T257 665H261Q273 665 286 663T323 651T370 619T413 560Q456 472 456 334Q456 194 396 97Q361 41 312 10T208 -22Q147 -22 108 7T68 93T121 149Q143 149 158 135T173 96Q173 78 164 65T148 49T135 44L131 43Q131 41 138 37T164 27T206 22H212Q272 22 313 86Q352 142 352 280V287ZM244 248Q292 248 321 297T351 430Q351 508 343 542Q341 552 337 562T323 588T293 615T246 625Q208 625 181 598Q160 576 154 546T147 441Q147 358 152 329T172 282Q197 248 244 248Z"></path><path id="MJX-3341-TEX-N-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path id="MJX-3341-TEX-N-36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z"></path><path id="MJX-3341-TEX-N-37" d="M55 458Q56 460 72 567L88 674Q88 676 108 676H128V672Q128 662 143 655T195 646T364 644H485V605L417 512Q408 500 387 472T360 435T339 403T319 367T305 330T292 284T284 230T278 162T275 80Q275 66 275 52T274 28V19Q270 2 255 -10T221 -22Q210 -22 200 -19T179 0T168 40Q168 198 265 368Q285 400 349 489L395 552H302Q128 552 119 546Q113 543 108 522T98 479L95 458V455H55V458Z"></path><path id="MJX-3341-TEX-N-33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path id="MJX-3341-TEX-N-35" d="M164 157Q164 133 148 117T109 101H102Q148 22 224 22Q294 22 326 82Q345 115 345 210Q345 313 318 349Q292 382 260 382H254Q176 382 136 314Q132 307 129 306T114 304Q97 304 95 310Q93 314 93 485V614Q93 664 98 664Q100 666 102 666Q103 666 123 658T178 642T253 634Q324 634 389 662Q397 666 402 666Q410 666 410 648V635Q328 538 205 538Q174 538 149 544L139 546V374Q158 388 169 396T205 412T256 420Q337 420 393 355T449 201Q449 109 385 44T229 -22Q148 -22 99 32T50 154Q50 178 61 192T84 210T107 214Q132 214 148 197T164 157Z"></path><path id="MJX-3341-TEX-N-5D" d="M22 710V750H159V-250H22V-210H119V710H22Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mrow"><g data-mml-node="mo"><use data-c="5B" xlink:href="#MJX-3341-TEX-N-5B"></use></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(278,0)"><g data-mml-node="mn"><use data-c="34" xlink:href="#MJX-3341-TEX-N-34"></use></g><g data-mml-node="mo" transform="translate(500,0)"><use data-c="2C" xlink:href="#MJX-3341-TEX-N-2C"></use></g><g data-mml-node="mn" transform="translate(944.7,0)"><use data-c="39" xlink:href="#MJX-3341-TEX-N-39"></use></g><g data-mml-node="mo" transform="translate(1444.7,0)"><use data-c="2C" xlink:href="#MJX-3341-TEX-N-2C"></use></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(1889.3,0)"><g data-mml-node="mn"><use data-c="31" xlink:href="#MJX-3341-TEX-N-31"></use><use data-c="36" xlink:href="#MJX-3341-TEX-N-36" transform="translate(500,0)"></use></g></g><g data-mml-node="mo" transform="translate(2889.3,0)"><use data-c="2C" xlink:href="#MJX-3341-TEX-N-2C"></use></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(3334,0)"><g data-mml-node="mn"><use data-c="31" xlink:href="#MJX-3341-TEX-N-31"></use><use data-c="37" xlink:href="#MJX-3341-TEX-N-37" transform="translate(500,0)"></use></g></g><g data-mml-node="mo" transform="translate(4334,0)"><use data-c="2C" xlink:href="#MJX-3341-TEX-N-2C"></use></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(4778.7,0)"><g data-mml-node="mn"><use data-c="33" xlink:href="#MJX-3341-TEX-N-33"></use><use data-c="34" xlink:href="#MJX-3341-TEX-N-34" transform="translate(500,0)"></use></g></g><g data-mml-node="mo" transform="translate(5778.7,0)"><use data-c="2C" xlink:href="#MJX-3341-TEX-N-2C"></use></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(6223.3,0)"><g data-mml-node="mn"><use data-c="33" xlink:href="#MJX-3341-TEX-N-33"></use><use data-c="35" xlink:href="#MJX-3341-TEX-N-35" transform="translate(500,0)"></use></g></g><g data-mml-node="mo" transform="translate(7223.3,0)"><use data-c="2C" xlink:href="#MJX-3341-TEX-N-2C"></use></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(7668,0)"><g data-mml-node="mn"><use data-c="34" xlink:href="#MJX-3341-TEX-N-34"></use><use data-c="33" xlink:href="#MJX-3341-TEX-N-33" transform="translate(500,0)"></use></g></g><g data-mml-node="mo" transform="translate(8668,0)"><use data-c="2C" xlink:href="#MJX-3341-TEX-N-2C"></use></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(9112.7,0)"><g data-mml-node="mn"><use data-c="35" xlink:href="#MJX-3341-TEX-N-35"></use><use data-c="34" xlink:href="#MJX-3341-TEX-N-34" transform="translate(500,0)"></use></g></g></g><g data-mml-node="mo" transform="translate(10390.7,0)"><use data-c="5D" xlink:href="#MJX-3341-TEX-N-5D"></use></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">[</mo><mrow data-mjx-texclass="ORD"><mn>4</mn><mo>,</mo><mn>9</mn><mo>,</mo><mrow data-mjx-texclass="ORD"><mn>16</mn></mrow><mo>,</mo><mrow data-mjx-texclass="ORD"><mn>17</mn></mrow><mo>,</mo><mrow data-mjx-texclass="ORD"><mn>34</mn></mrow><mo>,</mo><mrow data-mjx-texclass="ORD"><mn>35</mn></mrow><mo>,</mo><mrow data-mjx-texclass="ORD"><mn>43</mn></mrow><mo>,</mo><mrow data-mjx-texclass="ORD"><mn>54</mn></mrow></mrow><mo data-mjx-texclass="CLOSE">]</mo></mrow></math></mjx-assistive-mml></mjx-container><script type="math/tex">\left\lbrack  {4,9,{16},{17},{34},{35},{43},{54}}\right\rbrack</script><span>。</span></p><p><span>Context Management for GUI Agents. Managing interaction history is crucial for GUI agents to maintain task progress within token budget constraints. Existing approaches include sliding window methods that retain only the most recent </span><mjx-container class="MathJax" jax="SVG" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="2.009ex" height="1.545ex" role="img" focusable="false" viewBox="0 -683 888 683" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: 0px;"><defs><path id="MJX-1594-TEX-I-1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D441" xlink:href="#MJX-1594-TEX-I-1D441"></use></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>N</mi></math></mjx-assistive-mml></mjx-container><script type="math/tex"> N </script><span> observations [26],summarization methods that condense each step into minimal tokens [6, 27, 33], and hierarchical planning methods that decompose tasks into subtask sequences </span><mjx-container class="MathJax" jax="SVG" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="15.463ex" height="2.262ex" role="img" focusable="false" viewBox="0 -750 6834.7 1000" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -0.566ex;"><defs><path id="MJX-3343-TEX-N-5B" d="M118 -250V750H255V710H158V-210H255V-250H118Z"></path><path id="MJX-3343-TEX-N-37" d="M55 458Q56 460 72 567L88 674Q88 676 108 676H128V672Q128 662 143 655T195 646T364 644H485V605L417 512Q408 500 387 472T360 435T339 403T319 367T305 330T292 284T284 230T278 162T275 80Q275 66 275 52T274 28V19Q270 2 255 -10T221 -22Q210 -22 200 -19T179 0T168 40Q168 198 265 368Q285 400 349 489L395 552H302Q128 552 119 546Q113 543 108 522T98 479L95 458V455H55V458Z"></path><path id="MJX-3343-TEX-N-2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path><path id="MJX-3343-TEX-N-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path id="MJX-3343-TEX-N-32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path><path id="MJX-3343-TEX-N-34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path><path id="MJX-3343-TEX-N-39" d="M352 287Q304 211 232 211Q154 211 104 270T44 396Q42 412 42 436V444Q42 537 111 606Q171 666 243 666Q245 666 249 666T257 665H261Q273 665 286 663T323 651T370 619T413 560Q456 472 456 334Q456 194 396 97Q361 41 312 10T208 -22Q147 -22 108 7T68 93T121 149Q143 149 158 135T173 96Q173 78 164 65T148 49T135 44L131 43Q131 41 138 37T164 27T206 22H212Q272 22 313 86Q352 142 352 280V287ZM244 248Q292 248 321 297T351 430Q351 508 343 542Q341 552 337 562T323 588T293 615T246 625Q208 625 181 598Q160 576 154 546T147 441Q147 358 152 329T172 282Q197 248 244 248Z"></path><path id="MJX-3343-TEX-N-35" d="M164 157Q164 133 148 117T109 101H102Q148 22 224 22Q294 22 326 82Q345 115 345 210Q345 313 318 349Q292 382 260 382H254Q176 382 136 314Q132 307 129 306T114 304Q97 304 95 310Q93 314 93 485V614Q93 664 98 664Q100 666 102 666Q103 666 123 658T178 642T253 634Q324 634 389 662Q397 666 402 666Q410 666 410 648V635Q328 538 205 538Q174 538 149 544L139 546V374Q158 388 169 396T205 412T256 420Q337 420 393 355T449 201Q449 109 385 44T229 -22Q148 -22 99 32T50 154Q50 178 61 192T84 210T107 214Q132 214 148 197T164 157Z"></path><path id="MJX-3343-TEX-N-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path><path id="MJX-3343-TEX-N-5D" d="M22 710V750H159V-250H22V-210H119V710H22Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mrow"><g data-mml-node="mo"><use data-c="5B" xlink:href="#MJX-3343-TEX-N-5B"></use></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(278,0)"><g data-mml-node="mn"><use data-c="37" xlink:href="#MJX-3343-TEX-N-37"></use></g><g data-mml-node="mo" transform="translate(500,0)"><use data-c="2C" xlink:href="#MJX-3343-TEX-N-2C"></use></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(944.7,0)"><g data-mml-node="mn"><use data-c="31" xlink:href="#MJX-3343-TEX-N-31"></use><use data-c="37" xlink:href="#MJX-3343-TEX-N-37" transform="translate(500,0)"></use></g></g><g data-mml-node="mo" transform="translate(1944.7,0)"><use data-c="2C" xlink:href="#MJX-3343-TEX-N-2C"></use></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(2389.3,0)"><g data-mml-node="mn"><use data-c="32" xlink:href="#MJX-3343-TEX-N-32"></use><use data-c="34" xlink:href="#MJX-3343-TEX-N-34" transform="translate(500,0)"></use></g></g><g data-mml-node="mo" transform="translate(3389.3,0)"><use data-c="2C" xlink:href="#MJX-3343-TEX-N-2C"></use></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(3834,0)"><g data-mml-node="mn"><use data-c="34" xlink:href="#MJX-3343-TEX-N-34"></use><use data-c="39" xlink:href="#MJX-3343-TEX-N-39" transform="translate(500,0)"></use></g></g><g data-mml-node="mo" transform="translate(4834,0)"><use data-c="2C" xlink:href="#MJX-3343-TEX-N-2C"></use></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(5278.7,0)"><g data-mml-node="mn"><use data-c="35" xlink:href="#MJX-3343-TEX-N-35"></use><use data-c="30" xlink:href="#MJX-3343-TEX-N-30" transform="translate(500,0)"></use></g></g></g><g data-mml-node="mo" transform="translate(6556.7,0)"><use data-c="5D" xlink:href="#MJX-3343-TEX-N-5D"></use></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">[</mo><mrow data-mjx-texclass="ORD"><mn>7</mn><mo>,</mo><mrow data-mjx-texclass="ORD"><mn>17</mn></mrow><mo>,</mo><mrow data-mjx-texclass="ORD"><mn>24</mn></mrow><mo>,</mo><mrow data-mjx-texclass="ORD"><mn>49</mn></mrow><mo>,</mo><mrow data-mjx-texclass="ORD"><mn>50</mn></mrow></mrow><mo data-mjx-texclass="CLOSE">]</mo></mrow></math></mjx-assistive-mml></mjx-container><script type="math/tex">\left\lbrack  {7,{17},{24},{49},{50}}\right\rbrack</script><span> . However,these methods face limitations: sliding window incurs increasing context, summarization lacks explicit planning for complex tasks and may lose critical early information, and hierarchical planning introduces overhead requiring multiple replanning rounds and also faces with the challenge of forgetting important information.</span>
<span>GUI 代理的上下文管理。管理交互历史对于 GUI 代理在令牌预算约束内维持任务进度至关重要。现有方法包括保留最近 </span><mjx-container class="MathJax" jax="SVG" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="2.009ex" height="1.545ex" role="img" focusable="false" viewBox="0 -683 888 683" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: 0px;"><defs><path id="MJX-1594-TEX-I-1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D441" xlink:href="#MJX-1594-TEX-I-1D441"></use></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>N</mi></math></mjx-assistive-mml></mjx-container><script type="math/tex"> N </script><span> 条观测的滑动窗口方法 [26]、将每一步浓缩为最少令牌的摘要方法 [6, 27, 33]，以及将任务分解为子任务序列的分层规划方法 </span><mjx-container class="MathJax" jax="SVG" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="15.463ex" height="2.262ex" role="img" focusable="false" viewBox="0 -750 6834.7 1000" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -0.566ex;"><defs><path id="MJX-3343-TEX-N-5B" d="M118 -250V750H255V710H158V-210H255V-250H118Z"></path><path id="MJX-3343-TEX-N-37" d="M55 458Q56 460 72 567L88 674Q88 676 108 676H128V672Q128 662 143 655T195 646T364 644H485V605L417 512Q408 500 387 472T360 435T339 403T319 367T305 330T292 284T284 230T278 162T275 80Q275 66 275 52T274 28V19Q270 2 255 -10T221 -22Q210 -22 200 -19T179 0T168 40Q168 198 265 368Q285 400 349 489L395 552H302Q128 552 119 546Q113 543 108 522T98 479L95 458V455H55V458Z"></path><path id="MJX-3343-TEX-N-2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path><path id="MJX-3343-TEX-N-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path id="MJX-3343-TEX-N-32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path><path id="MJX-3343-TEX-N-34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path><path id="MJX-3343-TEX-N-39" d="M352 287Q304 211 232 211Q154 211 104 270T44 396Q42 412 42 436V444Q42 537 111 606Q171 666 243 666Q245 666 249 666T257 665H261Q273 665 286 663T323 651T370 619T413 560Q456 472 456 334Q456 194 396 97Q361 41 312 10T208 -22Q147 -22 108 7T68 93T121 149Q143 149 158 135T173 96Q173 78 164 65T148 49T135 44L131 43Q131 41 138 37T164 27T206 22H212Q272 22 313 86Q352 142 352 280V287ZM244 248Q292 248 321 297T351 430Q351 508 343 542Q341 552 337 562T323 588T293 615T246 625Q208 625 181 598Q160 576 154 546T147 441Q147 358 152 329T172 282Q197 248 244 248Z"></path><path id="MJX-3343-TEX-N-35" d="M164 157Q164 133 148 117T109 101H102Q148 22 224 22Q294 22 326 82Q345 115 345 210Q345 313 318 349Q292 382 260 382H254Q176 382 136 314Q132 307 129 306T114 304Q97 304 95 310Q93 314 93 485V614Q93 664 98 664Q100 666 102 666Q103 666 123 658T178 642T253 634Q324 634 389 662Q397 666 402 666Q410 666 410 648V635Q328 538 205 538Q174 538 149 544L139 546V374Q158 388 169 396T205 412T256 420Q337 420 393 355T449 201Q449 109 385 44T229 -22Q148 -22 99 32T50 154Q50 178 61 192T84 210T107 214Q132 214 148 197T164 157Z"></path><path id="MJX-3343-TEX-N-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path><path id="MJX-3343-TEX-N-5D" d="M22 710V750H159V-250H22V-210H119V710H22Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mrow"><g data-mml-node="mo"><use data-c="5B" xlink:href="#MJX-3343-TEX-N-5B"></use></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(278,0)"><g data-mml-node="mn"><use data-c="37" xlink:href="#MJX-3343-TEX-N-37"></use></g><g data-mml-node="mo" transform="translate(500,0)"><use data-c="2C" xlink:href="#MJX-3343-TEX-N-2C"></use></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(944.7,0)"><g data-mml-node="mn"><use data-c="31" xlink:href="#MJX-3343-TEX-N-31"></use><use data-c="37" xlink:href="#MJX-3343-TEX-N-37" transform="translate(500,0)"></use></g></g><g data-mml-node="mo" transform="translate(1944.7,0)"><use data-c="2C" xlink:href="#MJX-3343-TEX-N-2C"></use></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(2389.3,0)"><g data-mml-node="mn"><use data-c="32" xlink:href="#MJX-3343-TEX-N-32"></use><use data-c="34" xlink:href="#MJX-3343-TEX-N-34" transform="translate(500,0)"></use></g></g><g data-mml-node="mo" transform="translate(3389.3,0)"><use data-c="2C" xlink:href="#MJX-3343-TEX-N-2C"></use></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(3834,0)"><g data-mml-node="mn"><use data-c="34" xlink:href="#MJX-3343-TEX-N-34"></use><use data-c="39" xlink:href="#MJX-3343-TEX-N-39" transform="translate(500,0)"></use></g></g><g data-mml-node="mo" transform="translate(4834,0)"><use data-c="2C" xlink:href="#MJX-3343-TEX-N-2C"></use></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(5278.7,0)"><g data-mml-node="mn"><use data-c="35" xlink:href="#MJX-3343-TEX-N-35"></use><use data-c="30" xlink:href="#MJX-3343-TEX-N-30" transform="translate(500,0)"></use></g></g></g><g data-mml-node="mo" transform="translate(6556.7,0)"><use data-c="5D" xlink:href="#MJX-3343-TEX-N-5D"></use></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow data-mjx-texclass="INNER"><mo data-mjx-texclass="OPEN">[</mo><mrow data-mjx-texclass="ORD"><mn>7</mn><mo>,</mo><mrow data-mjx-texclass="ORD"><mn>17</mn></mrow><mo>,</mo><mrow data-mjx-texclass="ORD"><mn>24</mn></mrow><mo>,</mo><mrow data-mjx-texclass="ORD"><mn>49</mn></mrow><mo>,</mo><mrow data-mjx-texclass="ORD"><mn>50</mn></mrow></mrow><mo data-mjx-texclass="CLOSE">]</mo></mrow></math></mjx-assistive-mml></mjx-container><script type="math/tex">\left\lbrack  {7,{17},{24},{49},{50}}\right\rbrack</script><span> 。然而，这些方法存在局限性：滑动窗口会带来持续增加的上下文负担，摘要缺乏对复杂任务的显式规划，可能丢失早期关键信息，分层规划则需要额外开销并需多轮重新规划，同时也面临遗忘重要信息的挑战。</span></p><p><span>Program-Based GUI Agents. While standard GUI agents utilize a fixed set of programmatic APIs (e.g., click, type, scroll) as their action space, they typically treat these low-level APIs merely as atomic tool invocations. Recently, A distinct paradigm of LLM agents shift has emerged from using rigid, discrete tool calls to employing executable code as the unified action space for agents [15, 20, 29, 37]. To bridge the gap between low-level actions and high-level code generation, recent GUI agents have empowered agents to proac-tively construct high-level functions, encapsulating primitive operations into meaningful skills [38, 42]. Other approaches establish a persistent program context or terminal environment, enabling the agent to engage in continuous interaction through script synthesizing [11, 31, 41]. However, current task script generation methods [41] typically require precise API calls and strict syntax adherence, relying heavily on extensive exploration of mobile apps to build application documentation. Consequently, these scripts are prone to failure when encountering unseen applications or when dealing with out-of-distribution scenarios where documentation is unavailable.</span>
<span>基于程序的 GUI 代理。尽管标准 GUI 代理使用固定的一组编程 API（如点击、输入、滚动）作为行动空间，但它们通常仅将这些低层 API 视为原子工具调用。最近，一种从使用僵硬、离散工具调用转向将可执行代码作为代理统一行动空间的新范式已出现 [15, 20, 29, 37]。为弥合低层行动与高层代码生成之间的差距，最近的 GUI 代理已使代理能够主动构建高层函数，将原始操作封装为有意义的技能 [38, 42]。其他方法建立持久的程序上下文或终端环境，使代理能够通过脚本合成进行持续交互 [11, 31, 41]。然而，当前的任务脚本生成方法 [41] 通常需要精确的 API 调用和严格的语法遵循， heavily 依赖于对移动应用程序的广泛探索以构建应用文档。因此，这些脚本在遇到未见应用或处于分布外场景且文档不可用时容易失败。</span></p><h3 id='23-motivation-and-challenges'><span>2.3 Motivation and Challenges</span></h3><h3 id='23-动机与挑战'><span>2.3 动机与挑战</span></h3><p><span>Despite the progress in GUI agents, existing methods face fundamental limitations when handling long-horizon tasks, which require dozens or hundreds of sequential steps to complete. To better understand these challenges, we construct AW-Extend, an extended task suite based on Android-World [27] that specifically tests agent performance on compositional and iterative tasks. Our extended suite comprises 19 tasks that are possibly common in realistic scenarios across two categories: Compositional Tasks that combine sub-tasks into a compositional task requiring critical information maintenance across applications, and Iterative Tasks that scale sub-task counts to </span><mjx-container class="MathJax" jax="SVG" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="6.637ex" height="1.692ex" role="img" focusable="false" viewBox="0 -666 2933.6 748" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -0.186ex;"><defs><path id="MJX-3352-TEX-I-1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path><path id="MJX-3352-TEX-N-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path><path id="MJX-3352-TEX-N-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path id="MJX-3352-TEX-N-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D45B" xlink:href="#MJX-3352-TEX-I-1D45B"></use></g><g data-mml-node="mo" transform="translate(877.8,0)"><use data-c="3D" xlink:href="#MJX-3352-TEX-N-3D"></use></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(1933.6,0)"><g data-mml-node="mn"><use data-c="31" xlink:href="#MJX-3352-TEX-N-31"></use><use data-c="30" xlink:href="#MJX-3352-TEX-N-30" transform="translate(500,0)"></use></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>n</mi><mo>=</mo><mrow data-mjx-texclass="ORD"><mn>10</mn></mrow></math></mjx-assistive-mml></mjx-container><script type="math/tex">n = {10}</script><span> or </span><mjx-container class="MathJax" jax="SVG" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="6.637ex" height="1.692ex" role="img" focusable="false" viewBox="0 -666 2933.6 748" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -0.186ex;"><defs><path id="MJX-3353-TEX-I-1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path><path id="MJX-3353-TEX-N-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path><path id="MJX-3353-TEX-N-32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path><path id="MJX-3353-TEX-N-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D45B" xlink:href="#MJX-3353-TEX-I-1D45B"></use></g><g data-mml-node="mo" transform="translate(877.8,0)"><use data-c="3D" xlink:href="#MJX-3353-TEX-N-3D"></use></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(1933.6,0)"><g data-mml-node="mn"><use data-c="32" xlink:href="#MJX-3353-TEX-N-32"></use><use data-c="30" xlink:href="#MJX-3353-TEX-N-30" transform="translate(500,0)"></use></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>n</mi><mo>=</mo><mrow data-mjx-texclass="ORD"><mn>20</mn></mrow></math></mjx-assistive-mml></mjx-container><script type="math/tex">n = {20}</script><span> to test robustness and memory filtering capabilities. The detail of this task suite is illustrated in Section 4.</span>
<span>尽管在 GUI 代理方面取得了进展，现有方法在处理需要几十甚至上百步才能完成的长程任务时仍面临根本性限制。为了更好地理解这些挑战，我们构建 AW-Extend，一个基于 Android-World [27] 的扩展任务集，专门测试代理在组成性与迭代性任务上的表现。我们的扩展集包含 19 个任务，可能在现实场景中常见，分为两类：组成性任务，将子任务组合成一个需要跨应用维护关键信息的综合任务；迭代性任务，将子任务数量扩展到 </span><mjx-container class="MathJax" jax="SVG" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="6.637ex" height="1.692ex" role="img" focusable="false" viewBox="0 -666 2933.6 748" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -0.186ex;"><defs><path id="MJX-3352-TEX-I-1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path><path id="MJX-3352-TEX-N-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path><path id="MJX-3352-TEX-N-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path id="MJX-3352-TEX-N-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D45B" xlink:href="#MJX-3352-TEX-I-1D45B"></use></g><g data-mml-node="mo" transform="translate(877.8,0)"><use data-c="3D" xlink:href="#MJX-3352-TEX-N-3D"></use></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(1933.6,0)"><g data-mml-node="mn"><use data-c="31" xlink:href="#MJX-3352-TEX-N-31"></use><use data-c="30" xlink:href="#MJX-3352-TEX-N-30" transform="translate(500,0)"></use></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>n</mi><mo>=</mo><mrow data-mjx-texclass="ORD"><mn>10</mn></mrow></math></mjx-assistive-mml></mjx-container><script type="math/tex">n = {10}</script><span> 或 </span><mjx-container class="MathJax" jax="SVG" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="6.637ex" height="1.692ex" role="img" focusable="false" viewBox="0 -666 2933.6 748" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -0.186ex;"><defs><path id="MJX-3353-TEX-I-1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path><path id="MJX-3353-TEX-N-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path><path id="MJX-3353-TEX-N-32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path><path id="MJX-3353-TEX-N-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D45B" xlink:href="#MJX-3353-TEX-I-1D45B"></use></g><g data-mml-node="mo" transform="translate(877.8,0)"><use data-c="3D" xlink:href="#MJX-3353-TEX-N-3D"></use></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(1933.6,0)"><g data-mml-node="mn"><use data-c="32" xlink:href="#MJX-3353-TEX-N-32"></use><use data-c="30" xlink:href="#MJX-3353-TEX-N-30" transform="translate(500,0)"></use></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>n</mi><mo>=</mo><mrow data-mjx-texclass="ORD"><mn>20</mn></mrow></math></mjx-assistive-mml></mjx-container><script type="math/tex">n = {20}</script><span> 以测试鲁棒性与记忆筛选能力。该任务集的细节将在第 4 章中说明。</span></p><p><img src="https://raw.githubusercontent.com/Tsuki-Gor/Pic_Bed_Ob/main/Mixed/M2026/02/2026_02_18__20_17_08_7527cc.jpg"/></p><p>&nbsp;</p><p><span>Figure 1: Performance Comparison on AndroidWorld vs. AW-Extend. a11y refers to the Accessibility Tree observation space; SoM denotes Set-of-Mark; Mobile-Ag-v3 denotes Mobile-Agent-v3.</span>
<span>图 1：AndroidWorld 与 AW-Extend 的性能对比。a11y 指可访问性树观测空间；SoM 表示 Set-of-Mark；Mobile-Ag-v3 表示 Mobile-Agent-v3。</span></p><p><img src="https://raw.githubusercontent.com/Tsuki-Gor/Pic_Bed_Ob/main/Mixed/M2026/02/2026_02_18__20_17_08_901843.jpg"/></p><p>&nbsp;</p><p><span>Figure 2: Failure mode in existing methods (Mobile-Agent-v3 [49], UI-TARS [26], M3A [27]) on AW-Extend.</span>
<span>图 2：现有方法（Mobile-Agent-v3 [49]、UI-TARS [26]、M3A [27]）在 AW-Extend 上的失败模式。</span></p><p><span>Our preliminary analysis reveals critical failure reasons in existing methods, as illustrated in Figure 1:</span>
<span>我们的初步分析揭示了现有方法中的关键失败原因，如图 1 所示：</span></p><p><span>Lack of Overall Planning. In the &quot;MarkorTodoList&quot; task, Mobile-Agent-v3 prematurely terminates after completing only the first two sub-tasks, mistakenly believing all three items from the note have been addressed, as shown in Figure 2. This indicates a fundamental deficiency in holistic task planning and progress tracking.</span>
<span>缺乏整体规划。在“MarkorTodoList”任务中，Mobile-Agent-v3 在完成前两个子任务后提前终止，错误地认为笔记中的三个条目都已处理，如图 2 所示。这表明在整体任务规划与进度跟踪方面存在根本性缺陷。</span></p><p><span>Failure to Remember Critical Information. Despite employing context management schemes, existing agents fail to preserve task-relevant information at critical moments. In our tests, agents consistently pass incorrect parameters during sub-task execution because they do not retain all task items when initially opening the note, as shown in Figure 2. Their context management mechanisms lack sensitivity to task-critical information.</span>
<span>未能记住关键信息。尽管采用了上下文管理方案，现有代理在关键时刻仍未能保留与任务相关的信息。在我们的测试中，代理在子任务执行时始终传递错误的参数，因为在最初打开笔记时并未保留所有任务条目，如图 2 所示。它们的上下文管理机制对任务关键性信息缺乏敏感性。</span></p><p><span>Poor Understanding of Dynamic Environments. Our iterative tasks involving 10-20 sub-tasks expose fragility in handling unexpected situations-accidental app closures, dialog popups, or wrong operations. Moreover, due to the partial observability of GUI environments, changes in phone data are sometimes implicit, such as system settings, date and time, and in-app data. Existing methods struggle with such environmental variations, resulting in poor robustness during extended task execution. In our tests, the agent was tasked with deleting all events on this Saturday, but failed to correctly understand the date in the phone environment. Consequently, it deleted all Saturday events across different weeks, leading to task failure.</span>
<span>对动态环境理解不足。我们涉及 10-20 个子任务的迭代任务暴露了对突发情况的脆弱性——应用意外关闭、对话弹窗或错误操作等。此外，由于 GUI 环境的部分可观测性，手机数据的变化有时是隐含的，例如系统设置、日期时间及应用内数据。现有方法难以应对这类环境变化，导致在长时间执行任务时鲁棒性差。在我们的测试中，代理的任务是删除本周六的所有事件，但未能正确理解手机环境中的日期，因此它跨不同周删除了所有周六的事件，导致任务失败。</span></p><h2 id='3-our-approach-agentprog'><span>3 Our Approach: AgentProg</span></h2><h2 id='3-我们的方法agentprog'><span>3 我们的方法：AgentProg</span></h2><p><span>We present AgentProg, a program-guided framework for long-horizon task execution, as shown in Figure 3. It addresses three fundamental challenges in agent-environment interaction. First, to tackle the challenge of planning and decomposing complex long-horizon tasks, we introduce Semantic Task Program (STP), a domain-specific language that extends natural language instructions with structured control flow (loops, branches, functions) and explicit variable operations. Second, to provide agents with appropriate context without redundancy, we develop a program-guided context management approach that operates along control flow-based pruning and data flow management. Third, to maintain accurate environment understanding despite partial observability and outdated beliefs, we propose a Global Belief State mechanism that continuously validates and updates the agent&#39;s hypotheses about environment mechanisms and hidden variables throughout execution.</span>
<span>我们提出 AgentProg，一个用于长时程任务执行的程序引导框架，如图 3所示。它解决了代理与环境交互中的三个基本挑战。第一，为应对规划与分解复杂长时程任务的挑战，我们引入语义任务程序（STP），这是一种领域特定语言，在自然语言指令的基础上扩展了结构化控制流（循环、分支、函数）和显式变量操作。第二，为向代理提供恰当的上下文且不过度冗余，我们开发了一种沿控制流剪枝与数据流管理的程序引导上下文管理方法。第三，为在部分可观测性和陈旧信念的环境理解下仍能保持准确，我们提出全局信念状态机制，在执行全过程中持续验证并更新代理对环境机制与隐藏变量的假设。</span></p><p><span>Together, these components form a two-stage framework: Semantic Task Program Generation, where the agent performs global planning to create a structured program with identified critical variables, followed by Semantic Task Program Execution, where the agent incrementally interprets the program while maintaining belief state consistency and managing context efficiently. This design enables stable, efficient execution of long-horizon tasks without the context overflow and information loss problems that plague conventional approaches.</span>
<span>这些组件共同构成一个两阶段框架：语义任务程序生成阶段，代理进行全局规划以创建具有关键变量的结构化程序；以及语义任务程序执行阶段，代理在维持信念状态一致性并高效管理上下文的同时，增量地解释程序。这一设计实现了对长时程任务的稳定、高效执行，避免了常规方法常见的上下文溢出和信息丢失问题。</span></p><h3 id='31-semantic-task-program-a-dsl-for-long-horizon-task-planning'><span>3.1 Semantic Task Program: A DSL for Long-Horizon Task Planning</span></h3><h3 id='31-语义任务程序用于长时程任务规划的dsl'><span>3.1 语义任务程序：用于长时程任务规划的DSL</span></h3><p><span>We design Semantic Task Program (STP), a domain-specific language (DSL) that represents long-horizon tasks. Unlike rigid programming languages, STP balances expressiveness with semantic tolerance. It enables agents to plan and execute complex tasks effectively. More details and examples of STP are listed in Section A.</span>
<span>我们设计了语义任务程序（STP），一种表示长时程任务的领域特定语言（DSL）。与僵硬的编程语言不同，STP 在表达能力与语义容错之间取得平衡，使代理能够高效地规划与执行复杂任务。STP 的更多细节与示例请见第 A 节。</span></p><p><span>Design Principles. STP is built on three core principles: (1) Natural Language Foundation: Each program step is primarily expressed in natural language instructions, ensuring readability and maintaining generality across different environments; (2) Structured Control Flow: The language incorporates essential programming constructs including loops, conditionals, and functions to express iterative and recursive task patterns concisely; (3) Explicit Data Flow: Variables are used to explicitly pass information between steps, allowing the agent to identify and preserve critical information throughout task execution.</span>
<span>设计原则。STP 基于三大核心原则：（1）自然语言基础：每个程序步骤主要以自然语言指令表达，确保可读性并在不同环境中保持通用性；（2）结构化控制流：语言包含循环、条件分支和函数等基本编程构件，以简洁地表达迭代和递归任务模式；（3）显式数据流：变量用于在步骤之间显式传递信息，帮助代理在任务执行过程中识别并保留关键信息。</span></p><p><span>Syntax and Constructs. An STP consists of a sequence of steps, where each step can be: (1) Action Step: A natural language instruction describing what should be accomplished, such as &quot;Open the note &#39;todo_list.md&#39; in the Markor application&quot;; (2) Variable Declaration and Assignment: Explicit recording of critical information using variables enclosed in braces, e.g., &quot;record them as </span><span>{</span><span>task_list</span><span>}</span><span>&quot;; (3) Control Flow Statements: Loop constructs, conditional branches, and function definitions that organize execution flow, e.g., &quot;Iterate over </span><span>{</span><span>task_list</span><span>}</span><span>&quot;; (4) Variable References: Using declared variables in subsequent steps, e.g., &quot;for each </span><span>{</span><span>task_item</span><span>}</span><span>, ...&quot;.</span>
<span>语法与构造。STP 由一系列步骤组成，每个步骤可以是：（1）动作步骤：描述应完成的自然语言指令，例如“在 Markor 应用中打开笔记 ‘todo_list.md’”；（2）变量声明与赋值：使用大括号括起的变量显式记录关键信息，例如“将它们记为 {task_list}”；（3）控制流语句：循环、条件分支和函数定义，用以组织执行流程，例如“遍历 {task_list}”；（4）变量引用：在后续步骤中使用已声明的变量，例如“对每个 {task_item}，……”。</span></p><p><span>Semantic Tolerance. A key distinguishing feature of STP is its semantic tolerance. Current task script generation methods [41] require precise API calls and strict syntax. Consequently, they are highly sensitive to environment dynamics and software updates. Semantic Task Program allows for variations in execution details. The natural language instructions provide high-level guidance without being tightly coupled to specific environment implementations. This tolerance enables the agent to adapt to different environments and handle unexpected situations during execution, while the structured control flow ensures the overall task logic remains intact.</span>
<span>语义容错。STP 的一个关键区别特征是其语义容错性。目前的任务脚本生成方法 [41] 需要精确的 API 调用和严格的语法，因此对环境动态和软件更新高度敏感。语义任务程序允许在执行细节上有所变动。自然语言指令提供了高层次的引导，而不与具体环境实现紧密耦合。这种容错性使代理能够适应不同环境并在执行过程中处理意外情况，同时结构化控制流确保整体任务逻辑保持完整。</span></p><h3 id='32-stp-generation-and-execution'><span>3.2 STP Generation and Execution</span></h3><h3 id='32-stp-生成与执行'><span>3.2 STP 生成与执行</span></h3><p><span>AgentProg aims to enhance agent performance in long-horizon tasks through a two-stage framework for memory management as Figure 3 shows: 1) Semantic Task Program Generation: The agent generates a globally planned Semantic Task Program based on task requirements, where the program extends natural language with support for control flow constructs (e.g., branching, loops) and variable operations (declaration, assignment); 2) Semantic Task Program Execution: The agent incrementally interprets and executes the Semantic Task Program, taking environment state and current program state as input, and producing actions while updating the program state.</span>
<span>AgentProg 旨在通过如图 3 所示的两阶段内存管理框架提升长时程任务中的代理性能：1) 语义任务程序生成阶段：代理基于任务要求生成全局规划的语义任务程序，程序在自然语言基础上扩展对控制流构造（如分支、循环）和变量操作（声明、赋值）的支持；2) 语义任务程序执行阶段：代理在输入环境状态与当前程序状态的前提下，增量解释并执行语义任务程序，同时更新程序状态并输出行动。</span></p><p><span>Generation Phase. The agent plans a feasible program according to specifications. It uses control flow to orchestrate execution and identifies critical variables for preservation. The natural language components ensure the program remains general and robust.</span>
<span>生成阶段。代理根据规格规划可行程序。它使用控制流来编排执行，并识别需要保留的关键变量。自然语言组件确保程序保持通用性与鲁棒性。</span></p><h2 id='execution-phase'><span>Execution Phase.</span></h2><h2 id='执行阶段'><span>执行阶段。</span></h2><p><span>Instead of rigidly executing pre-defined scripts, Agent-Prog adopts a dynamic instruction grounding paradigm. The Semantic Task Program serves as a high-level guide, where AgentProg acts as a runtime interpreter that translates the current high-level program instruction into executable low-level actions based on the real-time environment state. This mechanism decouples the task logic from specific execution details, preventing context overflow while maintaining flexibility.</span>
<span>Agent-Prog 不再局限于执行预定义脚本，而是采用动态指令落地范式。语义任务程序作为高级指引，AgentProg 充当运行时解释器，将当前高级程序指令依据实时环境状态转化为可执行的低级动作。这一机制将任务逻辑与具体执行细节解耦，防止上下文溢出，同时保持灵活性。</span></p><p><span>Specifically, AgentProg operates in two alternating modes:</span>
<span>具体来说，AgentProg 以两种交替模式运行：</span></p><ol start='' ><li><p><span>Action Generation. In this mode, the agent focuses on instantiating the high-level intent of the current program step into concrete execution logic. Based on the instruction pointed to by the Program Counter (PC) and the current GUI observation, the agent generates a snippet of low-level Python code to interact with the environment. AgentProg utilizes LLM to ground abstract natural language instructions into a sequence of atomic Python APIs (e.g., start_app(</span><app><span>, click(</span><element><span>), input(</span><text><span>), swipe_down()). Crucially, this allows the agent to dynamically adapt the low-level operations (e.g., handling pop-ups or layout changes) while adhering to the high-level plan. The agent records these executed Python scripts to track data flow, while repetitive execution histories (e.g. , inside loops) are folded to save context.</span></p></li><li><p><span>动作生成。该模式下，智能体侧重将当前程序步骤的高层意图落实为具体执行逻辑。根据程序计数器（PC）指向的指令以及当前 GUI 观察，生成可与环境交互的低级 Python 代码片段。AgentProg 使用大语言模型将抽象自然语言指令落地为原子 Python API 序列（如 start_app(</span><app><span>, click(</span><element><span>), input(</span><text><span>), swipe_down())）。关键在于，这使智能体在遵循高层计划的同时，能够动态适配低级操作（如处理弹窗或布局变化）。智能体会记录这些已执行的 Python 脚本以追踪数据流，而重复的执行历史（例如在循环内）会被折叠以节省上下文。</span></p></li></ol><ol start='2' ><li><p><span>Program Counter Update. After the generated Python code is executed and the environment updates, the agent switches to this mode to manage the control flow. It decides how to move the Program Counter-whether to advance to the next step, iterate a loop, or jump to a branch-based on the execution result of the previous step.</span></p></li><li><p><span>程序计数器更新。生成的 Python 代码执行并更新环境后，智能体切换到此模式以管理控制流。它决定如何移动 PC—是推进到下一步、循环迭代，还是基于上一步执行结果跳转到分支。</span></p></li></ol><p><img src="https://raw.githubusercontent.com/Tsuki-Gor/Pic_Bed_Ob/main/Mixed/M2026/02/2026_02_18__20_17_08_cbd957.jpg"/></p><p>&nbsp;</p><p><span>Figure 3: The workflow of AgentProg.</span>
<span>图3：AgentProg 的工作流程。</span></p><p><span>These two modes alternate strictly: AgentProg translates the current instruction into Python code (Action Generation), executes it, and then decides where to go next in the program (PC Update). Throughout this process, AgentProg maintains a structured context containing the static program plan and the dynamic variables and low-level history, ensuring all decisions are globally consistent yet locally adaptive.</span>
<span>这两种模式严格交替：AgentProg 将当前指令翻译为 Python 代码（动作生成），执行后再决定程序接下来去哪里（PC 更新）。在整个过程中，AgentProg 维持一个结构化上下文，包含静态程序计划与动态变量及低级历史，确保所有决策在全局上保持一致而在局部上具备自适应性。</span></p><h3 id='33-program-guided-context-management'><span>3.3 Program-Guided Context Management</span></h3><h3 id='33-程序引导的上下文管理'><span>3.3 程序引导的上下文管理</span></h3><p><span>During the Semantic Task Program Execution phase, Agent-Prog adopts a program-guided approach to manage the context input for the agent. This mechanism addresses the tradeoff between information retention and context length. By leveraging the explicit structure of the STP, AgentProg acts as a filter: it retains execution-critical information while systematically discarding redundant history. This management operates along two dimensions: control flow pruning and data flow persistence.</span>
<span>在语义任务程序执行阶段，Agent-Prog 采取以程序为导向的上下文输入管理方法。该机制在信息保留与上下文长度之间权衡。利用 STP 的显式结构，AgentProg 充当过滤器：保留对执行关键的信息，同时系统性地舍弃冗余历史。该管理在两个维度上运作：控制流裁剪与数据流持久化。</span></p><p><span>3.3.1 Execution Tree-Guided Context Pruning. To manage the control flow context, we organize the STP execution history into a dynamic tree structure. As illustrated in Figure 4, each executed step expands a corresponding node in this tree.</span>
<span>3.3.1 基于执行树的上下文裁剪。为管理控制流上下文，我们将 STP 的执行历史组织成一个动态树结构。如图4所示，每执行一步都会扩展树中的一个相应节点。</span></p><p><span>Tree Construction Rules. The node expansion logic is strictly bound to the program structure. We categorize nodes into three types:</span>
<span>树构建规则。节点扩展逻辑严格绑定于程序结构。我们将节点分为三类：</span></p><ul><li><p><span>Sequential Nodes: If a step follows a linear sequence, it becomes a direct child of the previously executed node.</span></p></li><li><p><span>顺序节点：若一步跟随线性序列，则成为前一步所执行节点的直接子节点。</span></p></li></ul><ul><li><p><span>Conditional Nodes: For branching statements (e.g., if-else), only the node corresponding to the actually executed branch becomes a child of the condition node. Unexecuted branches are never added.</span></p></li><li><p><span>条件节点：对于分支语句（如 if-else），只有实际执行分支对应的节点成为条件节点的子节点。未执行的分支不会被添加。</span></p></li></ul><ul><li><p><span>Loop Nodes: For loop structures, each iteration expands a new loop statement node. These are added as children of the loop entry point, preserving the iteration history hierarchically.</span></p></li><li><p><span>循环节点：对于循环结构，每次迭代扩展一个新的循环语句节点。它们作为循环入口点的子节点添加，按层级保留迭代历史。</span></p></li></ul><p><span>Path-Based Pruning. During inference, the agent does not see the entire raw history. Instead, we compute the active path from the root node to the currently executing node. Only the step information and observations along this active path are retained in the context; all other branches and completed loop iterations that are no longer relevant to the current state are discarded.</span>
<span>基于路径的裁剪。在推理过程中，智能体并不能看到整个原始历史。相反，我们从根节点到当前执行节点计算活动路径。仅在该活动路径上的步骤信息与观测被保留在上下文中；所有其他分支和已完成但与当前状态不再相关的循环迭代将被丢弃。</span></p><p><span>This approach significantly reduces context overhead, especially in tasks involving complex logic. It prevents the agent from being confused by redundant information (e.g., stale states from a previous loop iteration or irrelevant actions from a non-taken branch), allowing it to focus solely on the current logical path.</span>
<span>这种方法显著降低了上下文开销，尤其适用于包含复杂逻辑的任务。它防止智能体被冗余信息（例如来自上一次循环迭代的陈旧状态或来自未被选取的分支的无关动作）所困扰，使其只关注当前的逻辑路径。</span></p><p><span>3.3.2 Program-based Historical Step Retrieval. While pruning removes irrelevant context, AgentProg also employs a retrieval mechanism to enhance stability for iterative tasks.</span>
<span>3.3.2 基于程序的历史步骤检索。尽管裁剪移除了不相关的上下文，AgentProg 也采用检索机制以提升对迭代性任务的稳定性。</span></p><p><img src="https://raw.githubusercontent.com/Tsuki-Gor/Pic_Bed_Ob/main/Mixed/M2026/02/2026_02_18__20_17_08_1d4bdd.jpg"/></p><p>&nbsp;</p><p><span>Figure 4: Program-guided context management with context pruning, history retrival and variable management.</span>
<span>图4：带有上下文裁剪、历史检索与变量管理的程序引导上下文管理。</span></p><p><span>When the execution revisits a specific program step-a common scenario in loops or recursive segments-AgentProg activates a retrieval mechanism. Unlike generic similarity search, this mechanism uses the unique program step ID to precisely identify preceding executions of the exact same step. The operational outcomes of these past iterations-including actions taken and resulting state changes-are selectively injected into the current context as references. This allows the agent to &quot;remember&quot; its own recent success or failure patterns. By providing this structured historical awareness, AgentProg significantly improves consistency in long-horizon repetitive tasks, mitigating the risks of oscillation or repeated errors that often plague agents lacking step-specific memory.</span>
<span>当执行回访特定程序步骤——这是循环或递归段中的常见场景时，AgentProg 会激活检索机制。与通用相似性搜索不同，这一机制利用唯一的程序步骤 ID 精确识别此前恰好相同步骤的执行。过去迭代的操作结果与状态变化会被选择性地以引用形式注入当前上下文中。这使智能体能够“记住”自身最近的成功或失败模式。通过提供这种结构化的历史意识，AgentProg 在长期的重复任务中显著提升一致性，降低因缺乏步骤特定记忆而导致的振荡或重复错误的风险。</span></p><p><span>3.3.3 Data Flow and Variable Management. Beyond control flow, AgentProg ensures the persistence of critical information through explicit variable management. This addresses the challenge where purely context-based agents often lose track of key data (e.g., a phone number retrieved 50 steps ago). During the Semantic Task Program Generation phase, the agent explicitly identifies and declares essential variables. These variables-such as extracted todo items, reservation times, or user preferences-act as &quot;anchors&quot;. They are mandated to persist throughout the execution, ensuring that task-critical data is never inadvertently discarded by the pruning mechanism.</span>
<span>3.3.3 数据流与变量管理。超越控制流，AgentProg 通过显式变量管理确保关键信息的持久性。这解决了纯基于上下文的代理常常丢失关键数据的问题（例如，在50步前获取的电话号码）。在语义任务程序生成阶段，代理明确识别并声明关键变量。这些变量——如提取的待办事项、预订时间或用户偏好——充当“锚点”。它们被要求在执行过程中持续存在，确保任务关键数据不会被剪枝机制误删。</span></p><p><span>During the Execution phase, the agent retains the flexibility to define auxiliary variables via Python code. This programmatic manipulation compensates for the limitations of raw LLM reasoning. For instance, an agent can extract multiple items into a list variable, iterate through them systematically, and use counters to track progress. This combination of declarative planning and imperative execution ensures robust information flow: critical data remains accessible, while the internal state adapts dynamically to evolving task requirements.</span>
<span>在执行阶段，代理保留通过 Python 代码定义辅助变量的灵活性。这种编程化操作弥补了原始大模型推理的局限性。例如，代理可以将多项内容提取到一个列表变量中，系统性地遍历它们，并使用计数器跟踪进度。这种陈述性规划与命令式执行的结合，确保信息流的鲁棒性：关键数据保持可访问，内部状态能够动态适应不断变化的任务需求。</span></p><p><span>3.3.4 Advantages of program-guided context management. AgentProg binds context directly to the program&#39;s execution structure, effectively addressing these limitations. From a control flow perspective, the STP captures repetition and branching patterns upfront. This allows the agent to systematically prune irrelevant branches and loop iterations without the need for error-prone replanning cycles. From a data flow perspective, explicit variable declaration serves as an information anchor, ensuring that critical data (e.g., user preferences or extracted items) persists throughout execution regardless of context length. This dual mechanism enables AgentProg to maintain a compact, noise-free context while guaranteeing the persistence of task-critical information.</span>
<span>3.3.4 程序引导的上下文管理优势。AgentProg 将上下文直接绑定到程序的执行结构，有效解决这些局限性。从控制流角度看，STP 事先捕捉重复与分支模式。这使代理能够系统性地剪除无关分支和循环迭代，而无需易出错的重新规划循环。从数据流角度看，显式变量声明作为信息锚点，确保关键数据（如用户偏好或提取项）在执行过程中保持持久，无论上下文长度如何变化。这一双重机制使 AgentProg 能维持紧凑、无噪声的上下文，同时保证任务关键性信息的持续存在。</span></p><p><img src="https://raw.githubusercontent.com/Tsuki-Gor/Pic_Bed_Ob/main/Mixed/M2026/02/2026_02_18__20_17_08_b84f11.jpg"/></p><p>&nbsp;</p><p><span>Figure 5: Dynamic global belief state management in partially observable environments.</span>
<span>图5：部分可观测环境中的全局信念状态动态管理。</span></p><h3 id='34-global-belief-state'><span>3.4 Global Belief State</span></h3><h3 id='34-全局信念状态'><span>3.4 全局信念状态</span></h3><p><span>While the Action Generation phase produces executable Python scripts, ensuring their faithful execution requires active monitoring. The Global Belief State integrates directly into this low-level execution loop, acting as a runtime verifier that checks if the assumptions made during code generation remain valid as each atomic command executes. This validation is critical because mobile GUI environments are inherently partially observable. Critical system states-such as clipboard content, navigation back-stack, or off-screen selected items, etc.-are often invisible in the current screenshot but decisive for future actions.</span>
<span>虽然行动生成阶段会生成可执行的 Python 脚本，但要确保其忠实执行需要主动监控。全局信念状态直接集成到这个低级执行循环中，充当运行时验证器，在每个原子命令执行时检查代码生成时的假设是否仍然有效。这种验证至关重要，因为移动 GUI 环境本质上是部分可观测的。关键系统状态——如剪贴板内容、导航返回栈或屏幕外的选中项等——在当前截图中往往不可见，但对将来操作具有决定性作用。</span></p><p><span>Inspired by the Belief MDP framework [13], we introduce a Global Belief State mechanism to bridge this gap. It operates as a runtime monitor through a continuous Predict-Verify-Align cycle: 1) Maintain Hypothesis (Predict): Unlike passive memory, the agent maintains an active set of hypotheses about the current environment status, including the UI context and data validity. 2) Runtime Verification (Verify): During the execution of low-level Python codes, AgentProg continuously compares the real-time visual observation against its belief state. 3) Anomaly Correction (Align): If the observation contradicts the belief, AgentProg identifies a Belief-Reality Gap. It immediately marks the previous state as invalid (e.g., &quot;Context Lost&quot;), and switches from execution mode to a recovery routine (e.g., navigating back to the target app) to realign its belief with reality.</span>
<span>受 Belief MDP 框架[13]的启发，我们引入一个全局信念状态机制，以弥合这一差距。它以持续的“预测-验证-对齐”循环作为运行时监控：1) 维持假设（预测）：与被动记忆不同，智能体维护一组关于当前环境状态的主动假设集，包括 UI 情境和数据有效性。2) 运行时验证（验证）：在低级 Python 代码执行期间，AgentProg 不断将实时视觉观测与其信念状态进行比较。3) 异常校正（对齐）：若观测与信念相矛盾，AgentProg 识别信念-现实差距。它立即将前一状态标记为无效（如“上下文丢失”），并从执行模式切换到恢复例程（如返回目标应用）以使信念与现实重新对齐。</span></p><p><span>Case Study. Consider a scenario where an agent is filling out a contact form. Initial Belief: &quot;Editing contact &#39;John Doe&#39;; Name and Email fields are filled.&quot; Event: Due to an accidental touch or crash, the app exits to the home screen. Without Belief State: A traditional agent might hallucinate that the step succeeded and attempt to click a &quot;Save&quot; button that no longer exists, leading to a cascade of errors. With Belief State: AgentProg detects the conflict: the visual observation (Home Screen) refutes the belief hypothesis (Editing View). It immediately invalidates the &quot;Name/Email filled&quot; status, updates the belief to &quot;Form Context Lost,&quot; and generates a corrective plan to restart the app and re-fill the information. This mechanism ensures that the agent never proceeds on false premises.</span>
<span>案例研究。设想一个智能体正在填写联系表单的场景。初始信念：“正在编辑联系人 ‘John Doe’；姓名和邮箱字段已填好。” 事件：由于意外触摸或崩溃，应用返回到主屏幕。若没有信念状态：传统智能体可能会错觉地认为步骤已成功并尝试点击不再存在的“保存”按钮，导致一系列错误。若有信念状态：AgentProg 检测到冲突：视觉观测（主屏幕）推翻了信念假设（正在编辑视图）。它立即使“姓名/邮箱已填”状态失效，更新信念为“表单上下文丢失”，并生成纠错计划以重启应用并重新填写信息。此机制确保智能体在错误前提下绝不推进。</span></p><h2 id='4-aw-extend-benchmark'><span>4 AW-Extend Benchmark</span></h2><h2 id='4-aw-extend-基准测试'><span>4 AW-Extend 基准测试</span></h2><p><span>To systematically evaluate agent performance on the long-horizon challenges identified above, we constructed AW-Extend, an extended task suite that builds upon the original AndroidWorld benchmark. By adapting the existing Android-World evaluation and verification system, we ensure our extended tasks maintain the same rigorous automated assessment standards while specifically targeting long-horizon scenarios.</span>
<span>为系统地评估智能体在上述长期任务中的表现，我们构建了 AW-Extend，一套扩展任务集，基于原始 AndroidWorld 基准进行扩展。通过改编现有的 AndroidWorld 评估与验证系统，确保扩展任务维持相同严格的自动化评估标准，同时专门面向长期情景。</span></p><p><span>Existing mobile GUI operation benchmarks [27, 36, 46] primarily focus on evaluating isolated functionalities within individual applications. They lack adequate coverage of realistic complex scenarios that involve coordinating multiple applications, integrating diverse functionalities across apps, or executing extended sequences of operations within a single application. However, such long-horizon tasks are common in real-world usage, necessitating a dedicated benchmark to assess agent capabilities in these dimensions. Our extended suite comprises 19 tasks covering two categories:</span>
<span>现有的移动 GUI 操作基准测试 [27, 36, 46] 主要关注对单一应用中独立功能的评估。它们对涉及协调多应用、跨应用整合多种功能，或在单一应用内执行较长操作序列等现实复杂场景的覆盖不足。然而，在现实使用中，这些长期任务很常见，因此需要专门的基准来评估智能体在这些维度上的能力。我们的扩展套件包含 19 个任务，覆盖两大类：</span></p><p><span>Compositional Tasks combine multiple atomic operations into realistic workflows that require maintaining task context across different applications. These tasks are characterized by strong dependencies between subtasks, demanding that agents retain and effectively utilize critical information throughout the execution process. Representative examples include: processing a To-Do List from notes by completing each item sequentially (creating calendar events, adding contacts, managing expenses); batch operations such as creating multiple contacts and messaging each one; and cross-application interactions like querying note content via text message and replying accordingly.</span>
<span>组合任务（Compositional Tasks）将多个原子操作组合成需要跨应用维持任务上下文的现实工作流。这些任务的子任务之间存在强依赖，要求智能体在执行过程中保持并有效利用关键信息。典型示例包括：从笔记中处理待办列表，逐项完成（创建日历事件、添加联系人、管理开支）；批量操作，如创建多位联系人并逐一发送信息；以及跨应用交互，如通过短信查询笔记内容并据此回复等。</span></p><p><span>Iterative Tasks systematically scale the sub-task count from the standard </span><mjx-container class="MathJax" jax="SVG" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="5.506ex" height="1.69ex" role="img" focusable="false" viewBox="0 -665 2433.6 747" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -0.186ex;"><defs><path id="MJX-3351-TEX-I-1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path><path id="MJX-3351-TEX-N-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path><path id="MJX-3351-TEX-N-33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D45B" xlink:href="#MJX-3351-TEX-I-1D45B"></use></g><g data-mml-node="mo" transform="translate(877.8,0)"><use data-c="3D" xlink:href="#MJX-3351-TEX-N-3D"></use></g><g data-mml-node="mn" transform="translate(1933.6,0)"><use data-c="33" xlink:href="#MJX-3351-TEX-N-33"></use></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>n</mi><mo>=</mo><mn>3</mn></math></mjx-assistive-mml></mjx-container><script type="math/tex">n = 3</script><span> in AndroidWorld to </span><mjx-container class="MathJax" jax="SVG" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="6.637ex" height="1.692ex" role="img" focusable="false" viewBox="0 -666 2933.6 748" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -0.186ex;"><defs><path id="MJX-3352-TEX-I-1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path><path id="MJX-3352-TEX-N-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path><path id="MJX-3352-TEX-N-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path id="MJX-3352-TEX-N-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D45B" xlink:href="#MJX-3352-TEX-I-1D45B"></use></g><g data-mml-node="mo" transform="translate(877.8,0)"><use data-c="3D" xlink:href="#MJX-3352-TEX-N-3D"></use></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(1933.6,0)"><g data-mml-node="mn"><use data-c="31" xlink:href="#MJX-3352-TEX-N-31"></use><use data-c="30" xlink:href="#MJX-3352-TEX-N-30" transform="translate(500,0)"></use></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>n</mi><mo>=</mo><mrow data-mjx-texclass="ORD"><mn>10</mn></mrow></math></mjx-assistive-mml></mjx-container><script type="math/tex">n = {10}</script><span> and </span><mjx-container class="MathJax" jax="SVG" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="6.637ex" height="1.692ex" role="img" focusable="false" viewBox="0 -666 2933.6 748" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -0.186ex;"><defs><path id="MJX-3353-TEX-I-1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path><path id="MJX-3353-TEX-N-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path><path id="MJX-3353-TEX-N-32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path><path id="MJX-3353-TEX-N-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D45B" xlink:href="#MJX-3353-TEX-I-1D45B"></use></g><g data-mml-node="mo" transform="translate(877.8,0)"><use data-c="3D" xlink:href="#MJX-3353-TEX-N-3D"></use></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(1933.6,0)"><g data-mml-node="mn"><use data-c="32" xlink:href="#MJX-3353-TEX-N-32"></use><use data-c="30" xlink:href="#MJX-3353-TEX-N-30" transform="translate(500,0)"></use></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>n</mi><mo>=</mo><mrow data-mjx-texclass="ORD"><mn>20</mn></mrow></math></mjx-assistive-mml></mjx-container><script type="math/tex">n = {20}</script><span> ,testing both agent robustness and the ability to filter irrelevant information from context. Unlike compositional tasks where subtasks are interdependent, iterative tasks involve weakly-correlated operations, making them particularly effective for evaluating an agent&#39;s capacity to suppress interference from irrelevant historical context while maintaining consistent task execution. These tasks encompass managing expense records, calendar events, menu items, and note operations.</span>
<span>迭代任务（Iterative Tasks）将子任务数量从 AndroidWorld 的标准 </span><mjx-container class="MathJax" jax="SVG" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="5.506ex" height="1.69ex" role="img" focusable="false" viewBox="0 -665 2433.6 747" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -0.186ex;"><defs><path id="MJX-3351-TEX-I-1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path><path id="MJX-3351-TEX-N-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path><path id="MJX-3351-TEX-N-33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D45B" xlink:href="#MJX-3351-TEX-I-1D45B"></use></g><g data-mml-node="mo" transform="translate(877.8,0)"><use data-c="3D" xlink:href="#MJX-3351-TEX-N-3D"></use></g><g data-mml-node="mn" transform="translate(1933.6,0)"><use data-c="33" xlink:href="#MJX-3351-TEX-N-33"></use></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>n</mi><mo>=</mo><mn>3</mn></math></mjx-assistive-mml></mjx-container><script type="math/tex">n = 3</script><span> 逐步扩展到 </span><mjx-container class="MathJax" jax="SVG" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="6.637ex" height="1.692ex" role="img" focusable="false" viewBox="0 -666 2933.6 748" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -0.186ex;"><defs><path id="MJX-3352-TEX-I-1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path><path id="MJX-3352-TEX-N-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path><path id="MJX-3352-TEX-N-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path id="MJX-3352-TEX-N-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D45B" xlink:href="#MJX-3352-TEX-I-1D45B"></use></g><g data-mml-node="mo" transform="translate(877.8,0)"><use data-c="3D" xlink:href="#MJX-3352-TEX-N-3D"></use></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(1933.6,0)"><g data-mml-node="mn"><use data-c="31" xlink:href="#MJX-3352-TEX-N-31"></use><use data-c="30" xlink:href="#MJX-3352-TEX-N-30" transform="translate(500,0)"></use></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>n</mi><mo>=</mo><mrow data-mjx-texclass="ORD"><mn>10</mn></mrow></math></mjx-assistive-mml></mjx-container><script type="math/tex">n = {10}</script><span> 和 </span><mjx-container class="MathJax" jax="SVG" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="6.637ex" height="1.692ex" role="img" focusable="false" viewBox="0 -666 2933.6 748" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -0.186ex;"><defs><path id="MJX-3353-TEX-I-1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path><path id="MJX-3353-TEX-N-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path><path id="MJX-3353-TEX-N-32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path><path id="MJX-3353-TEX-N-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D45B" xlink:href="#MJX-3353-TEX-I-1D45B"></use></g><g data-mml-node="mo" transform="translate(877.8,0)"><use data-c="3D" xlink:href="#MJX-3353-TEX-N-3D"></use></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(1933.6,0)"><g data-mml-node="mn"><use data-c="32" xlink:href="#MJX-3353-TEX-N-32"></use><use data-c="30" xlink:href="#MJX-3353-TEX-N-30" transform="translate(500,0)"></use></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>n</mi><mo>=</mo><mrow data-mjx-texclass="ORD"><mn>20</mn></mrow></math></mjx-assistive-mml></mjx-container><script type="math/tex">n = {20}</script><span>，测试智能体的鲁棒性以及从上下文中过滤不相关信息的能力。不同于子任务相互依赖的组合任务，迭代任务涉及弱相关的操作，使其在评估智能体在抑制无关历史上下文干扰，同时保持任务执行的一致性方面尤为有效。这些任务包括管理费用记录、日历事件、菜单项和笔记操作。</span></p><p><span>We adapted AndroidWorld&#39;s environment configuration and evaluation code to create these tasks, enabling assessment through AndroidWorld&#39;s standard interface, including environment setup, automated evaluation based on emulator state, and trajectory recording.</span>
<span>我们对 AndroidWorld 的环境配置与评估代码进行了改造，以创建这些任务，能够通过 AndroidWorld 的标准界面进行评估，包括环境搭建、基于模拟器状态的自动评估以及轨迹记录。</span></p><h2 id='5-experiments'><span>5 Experiments</span></h2><h2 id='5-实验'><span>5 实验</span></h2><h3 id='51-experimental-settings'><span>5.1 Experimental Settings</span></h3><h3 id='51-实验设置'><span>5.1 实验设置</span></h3><p><span>Benchmarks. We conduct experiments on AndroidWorld [27] and AW-Extend (AW-Extend). AndroidWorld is a comprehensive and widely used benchmark for evaluating Android GUI agents across diverse real-world mobile applications with 116 tasks. AW-Extend is an extension we construct with 19 additional long horizon tasks described in Section 4.</span>
<span>基准测试。我们在 AndroidWorld [27] 与 AW-Extend（AW-Extend）上进行实验。AndroidWorld 是一个全面且广泛使用的基准，用于在多样化真实世界移动应用中评估 Android GUI 智能体，包含 116 个任务。AW-Extend 是我们在第 4 节描述的新增 19 个长期任务的扩展集合。</span></p><p><span>Baselines. We compare our method with several state-of-the-art approaches on two benchmarks. On Android-World benchmark, as shown in Table 1, we include a wide range of methods from related work. We re-evaluated M3A method [27], for both its a11y tree and SoM variants, using Gemini-2.5-Pro, as the original work reported results based on GPT-4-turbo. All other baseline scores on AndroidWorld are cited from their respective original publications. On AW-Extend benchmark, we select a focused set of baselines, each employing a distinct context management strategy to handle long-horizon tasks. As detailed in Table 2, these include:</span>
<span>基线。我们在两个基准上将我们的方法与若干最先进的方法进行比较。在 Android-World 基准上，如表 1 所示，我们包含了来自相关工作的广泛方法。我们用 Gemini-2.5-Pro 重新评估 M3A 方法 [27]，针对其 a11y tree 与 SoM 变体，因为原工作基于 GPT-4-turbo 汇报了结果。AndroidWorld 的所有其他基线分数均来自各自的原始出版物。在 AW-Extend 基准上，我们选择了一组聚焦的基线，每个基线采用不同的上下文管理策略来处理长时间任务。如下表 2 所述，这些包括：</span></p><ul><li><p><span>M3A [27], which generates a textual summary after each step to manage its context.</span></p></li><li><p><span>M3A [27]，每一步后生成文本摘要以管理上下文。</span></p></li></ul><ul><li><p><span>UI-TARS [26], which uses a sliding window approach, discarding the oldest screenshots in a first-in-first-out (FIFO) manner when the context exceeds a limit. We follow its official setting, retaining a maximum of five screenshots.</span></p></li><li><p><span>UI-TARS [26]，采用滑动窗口方法，在上下文超过限制时按照先进先出（FIFO）方式丢弃最旧的截图。我们遵循其官方设置，最多保留五张截图。</span></p></li></ul><ul><li><p><span>Mobile-Agent-v3 [49], which employs hierarchical planning method. A planner first decomposes the main task into a list of sub-tasks, and an executor then completes them sequentially. The planner maintains the list of sub-tasks continuously during the task execution.</span></p></li><li><p><span>Mobile-Agent-v3 [49]，采用分层规划方法。规划者先将主要任务分解为若干子任务清单，执行者再按顺序完成它们。规划者在任务执行过程中持续维护子任务清单。</span></p></li></ul><p><span>For baselines on AW-Extend benchmark, we use Gemini- 2.5-Pro [8] as the backbone model for M3A [27], UI-TARS- 1.5-API for UI-TARS [26], and both GUI-Owl-32B and GUI-Owl-7B for Mobile-Agent-v3 [49].</span>
<span>在 AW-Extend 基准上的基线，我们将 Gemini-2.5-Pro [8] 作为 M3A [27] 的骨干模型，UI-TARS-1.5-API 作为 UI-TARS [26]，以及 GUI-Owl-32B 与 GUI-Owl-7B 作为 Mobile-Agent-v3 [49] 的两种模型。</span></p><p><span>Metrics. We adapt the official AndroidWorld evaluation metric (Success Rate) to measure task completion performance. For AW-Extend, we adapt AndroidWorld&#39;s evaluation codebase to support assessment of our custom task set.</span>
<span>评估指标。我们采用官方的 AndroidWorld 评估指标（成功率）来衡量任务完成表现。对于 AW-Extend，我们改编 AndroidWorld 的评测代码库以支持对我们自定义任务集的评估。</span></p><p><span>Implementation Details. We implement AgentProg using Gemini-2.5-Pro [8] as the backbone planning model, and leverage UI-TARS-1.5-API [26] to locate the UI elements.</span>
<span>实现细节。我们使用 Gemini-2.5-Pro [8] 作为骨干规划模型实现 AgentProg，并借助 UI-TARS-1.5-API [26] 来定位 UI 元素。</span></p><h3 id='52-analysis-of-success-rate'><span>5.2 Analysis of Success Rate</span></h3><h3 id='52-成功率分析'><span>5.2 成功率分析</span></h3><p><span>Table 1: Success Rate (%) on AndroidWorld.</span>
<span>表 1：AndroidWorld 上的成功率 (%)。</span></p><table><tr><td>Method</td><td>AndroidWorld (%)</td></tr><tr><td>MobileGPT [14]</td><td>23.0</td></tr><tr><td>AutoDroid-V2 [41]</td><td>26.0</td></tr><tr><td>M3A (a11y, GPT-4-Turbo) [27]</td><td>30.6</td></tr><tr><td>M3A (a11y, Gemini-2.5-Pro) [27]</td><td>31.0</td></tr><tr><td>M3A (SoM, GPT-4-Turbo) [27]</td><td>25.4</td></tr><tr><td>M3A (SoM, Gemini-2.5-Pro) [27]</td><td>39.7</td></tr><tr><td>GLM-4.1V-9B-Thinking [12]</td><td>41.7</td></tr><tr><td>UI-TARS (UI-TARS-7B) [26]</td><td>33.0</td></tr><tr><td>UI-TARS (UI-TARS-1.5-API) [26]</td><td>64.2</td></tr><tr><td>V-Droid [5]</td><td>59.5</td></tr><tr><td>MobileUse [17]</td><td>62.9</td></tr><tr><td>UI-Venus [10]</td><td>65.9</td></tr><tr><td>Agent S3 [7]</td><td>68.1</td></tr><tr><td>Mobile-Agent-v3 (GUI-Owl-7B) [49]</td><td>66.4</td></tr><tr><td>Mobile-Agent-v3 (GUI-Owl-32B) [49]</td><td>73.3</td></tr><tr><td>AgentProg</td><td>78.0</td></tr></table>
<table><tbody><tr><td>方法</td><td>AndroidWorld (%)</td></tr><tr><td>MobileGPT [14]</td><td>23.0</td></tr><tr><td>AutoDroid-V2 [41]</td><td>26.0</td></tr><tr><td>M3A (无障碍, GPT-4-Turbo) [27]</td><td>30.6</td></tr><tr><td>M3A (无障碍, Gemini-2.5-Pro) [27]</td><td>31.0</td></tr><tr><td>M3A (SoM, GPT-4-Turbo) [27]</td><td>25.4</td></tr><tr><td>M3A (SoM, Gemini-2.5-Pro) [27]</td><td>39.7</td></tr><tr><td>GLM-4.1V-9B-思考型 [12]</td><td>41.7</td></tr><tr><td>UI-TARS (UI-TARS-7B) [26]</td><td>33.0</td></tr><tr><td>UI-TARS (UI-TARS-1.5-API) [26]</td><td>64.2</td></tr><tr><td>V-Droid [5]</td><td>59.5</td></tr><tr><td>MobileUse [17]</td><td>62.9</td></tr><tr><td>UI-Venus [10]</td><td>65.9</td></tr><tr><td>Agent S3 [7]</td><td>68.1</td></tr><tr><td>Mobile-Agent-v3 (GUI-Owl-7B) [49]</td><td>66.4</td></tr><tr><td>Mobile-Agent-v3 (GUI-Owl-32B) [49]</td><td>73.3</td></tr><tr><td>AgentProg</td><td>78.0</td></tr></tbody></table><p><span>Table 2: Success Rate (%) on AW-Extend.</span>
<span>Table 2: 成功率 (%) 在 AW-Extend 上。</span></p><table><tr><td>Method</td><td>AW-Extend (%)</td></tr><tr><td>M3A (a11y)</td><td>23.7</td></tr><tr><td>M3A (SoM)</td><td>28.9</td></tr><tr><td>Mobile-Agent-v3 (GUI-Owl-7B)</td><td>26.3</td></tr><tr><td>Mobile-Agent-v3 (GUI-Owl-32B)</td><td>28.9</td></tr><tr><td>UI-TARS (UI-TARS-1.5-API)</td><td>36.8</td></tr><tr><td>AgentProg</td><td>68.4</td></tr></table>
<table><tbody><tr><td>方法</td><td>AW-扩展 (%)</td></tr><tr><td>M3A (无障碍)</td><td>23.7</td></tr><tr><td>M3A (SoM)</td><td>28.9</td></tr><tr><td>Mobile-Agent-v3 (GUI-Owl-7B)</td><td>26.3</td></tr><tr><td>Mobile-Agent-v3 (GUI-Owl-32B)</td><td>28.9</td></tr><tr><td>UI-TARS (UI-TARS-1.5-API)</td><td>36.8</td></tr><tr><td>AgentProg</td><td>68.4</td></tr></tbody></table><p><span>Overall Results. As shown in Table 1, our method achieves a success rate of 78.0% on the AndroidWorld benchmark, surpassing the previous state-of-the-art Mobile-Agent-v3 by 4.7%. This demonstrates significant advantages in general mobile automation tasks. On AW-Extend benchmark shown in Table 2, we compare our program-guided context management approach against three representative baseline context management strategies: Summarization (M3A), sliding window (UI-TARS), and hierarchical planning (Mobile-Agent-v3). Our method achieves a success rate of 68.4%, substantially outperforming all baseline approaches. These results demonstrate that our program-guided context management framework offers substantial advantages over existing methods, particularly for long-horizon tasks that require maintaining context effectively over extended interaction sequences.</span>
<span>总体结果。如表1所示，我们的方法在 AndroidWorld 基准测试上实现78.0% 的成功率，比上一代最先进的 Mobile-Agent-v3 高出4.7%，这在一般移动自动化任务中显示出显著优势。在 AW-Extend 基准测试如表2所示，我们将我们基于程序引导的上下文管理方法与三种代表性的基线上下文管理策略进行比较：摘要（M3A）、滑动窗口（UI-TARS）以及分层规划（Mobile-Agent-v3）。我们的方法达到68.4%的成功率，显著超越所有基线方法。这些结果表明，我们的基于程序的上下文管理框架相对于现有方法具有实质性优势，尤其适用于需要在较长交互序列中有效维持上下文的长时任务。</span></p><p><span>Performance Across Task Difficulty Levels. Figure 6 presents the success rates of different methods stratified by task difficulty levels on AndroidWorld. In Figure 6, M3A uses SoM as input and Gemini-2.5-Pro as backbone model. Mo-bileUse results are reported from the original paper, while M3A and AgentProg results are from our evaluation. Other existing methods have not reported performance across different difficulty levels on AndroidWorld. We observe that success rates decline progressively as task difficulty increases across all methods. Notably, AgentProg consistently outperforms baselines at every difficulty level. Besides, the magnitude of improvement is most pronounced for medium tasks (25.0% over MobileUse), followed by hard tasks (13.1% improvement), with the smallest gain on easy tasks (9.8% improvement). This pattern suggests that existing methods can handle simple tasks reasonably well, but face substantial challenges with medium and hard tasks. AgentProg effectively addresses this gap, particularly excelling where current methods struggle most. This demonstrates that the program-driven framework with belief state tracking in AgentProg is particularly effective for complex tasks that demand advanced planning capabilities, robust memory of critical information, and sophisticated environment understanding. The widening performance gap at higher difficulty levels validates that these capabilities become increasingly critical as task complexity grows.</span>
<span>按任务难度等级的性能。图6 展示了在 AndroidWorld 上按任务难度分层的不同方法的成功率。在图6中，M3A 以 SoM 作为输入，Gemini-2.5-Pro 作为骨干模型。Mo-bileUse 的结果来自原论文，而 M3A 与 AgentProg 的结果来自我们的评估。其他现有方法尚未在 AndroidWorld 的不同难度等级上给出性能报告。我们观察到随着任务难度的增加，所有方法的成功率逐步下降。值得注意的是，AgentProg 在每个难度等级上始终优于基线。此外，提升幅度在中等难度任务（比 MobileUse 提升 25.0%）最为显著，其次是困难任务（提升 13.1%），在简单任务上的提升最小（提升 9.8%）。这一模式表明，现有方法在处理简单任务时相对较好，但在中等和困难任务上面临实质性挑战。AgentProg 有效弥补了这一差距，尤其是在当前方法最难以应付的领域表现突出。这表明 AgentProg 的基于程序驱动、带有信念状态跟踪的框架对于需要高级规划能力、对关键信息的稳健记忆以及对复杂环境的理解的任务尤为有效。随着任务难度的提升，性能差距的扩大证实了这些能力在任务复杂性增长时变得日益关键。</span></p><p><img src="https://raw.githubusercontent.com/Tsuki-Gor/Pic_Bed_Ob/main/Mixed/M2026/02/2026_02_18__20_17_08_8102ad.jpg"/></p><p>&nbsp;</p><p><span>Figure 6: Success Rate (%) across difficulty levels on AndroidWorld.</span>
<span>图6：在 AndroidWorld 上不同难度水平的成功率（%）。</span></p><p><span>Performance Across Different Task Types. AW-Extend benchmark comprises two distinct task categories: iterative tasks and compositional tasks. We analyze the performance of different methods across these categories, as illustrated in Figure 7. Compositional tasks combine multiple related subtasks, requiring agents to retain information from one subtask while executing another, thereby testing their ability to preserve critical memory. In contrast, iterative tasks involve executing similar operations multiple times with weak intertask dependencies, primarily challenging capability of agents to filter out irrelevant memory interference while maintaining robust task completion. Among only baseline methods, UI-TARS achieves the best overall performance, primarily due to its strong results on compositional tasks. This advantage stems from its sliding window approach, which avoids summarizing historical information, allowing the model to access information from previous subtasks when executing the current one. However, both UI-TARS and Mobile-Agent-v3 underperform M3A on iterative tasks. For UI-TARS, this may be attributed to the sliding window accumulating substantial irrelevant memory in the context, which interferes with model performance. The more complex architecture of Mobile-Agent-v3 compared to M3A introduces greater instability in context management during task execution, reducing robustness for iterative operations. M3A outperforms other baselines on iterative tasks, likely because its summary-based context management offers a simpler, more stable architecture that maintains lower failure rates when executing similar operations repeatedly. AgentProg surpasses all baseline methods, demonstrating significant advantages on both iterative and compositional tasks. The program-guided context management approach enables robust completion of both task types: it effectively preserves important information through program variables while eliminating redundant and irrelevant memory by parsing program structure. This dual capability allows AgentProg to excel where existing methods face trade-offs between memory retention and interference reduction.</span>
<span>跨不同任务类型的性能。AW-Extend 基准测试包含两类不同的任务：迭代任务与组合法任务。我们如图7所示分析不同方法在这两类任务上的性能。组合法任务结合了多个相关子任务，要求代理在执行一个子任务时保留来自另一个子任务的信息，从而测试其保持关键记忆的能力。相对而言，迭代任务涉及多次执行相似操作，任务间依赖较弱，主要挑战是代理在保持稳健完成任务的同时过滤掉无关记忆干扰。在仅有的基线方法中，UI-TARS 在整体性能上表现最好，主要得益于其在组合法任务上的强势表现。这一优势源于其滑动窗口方法，避免对历史信息进行摘要，允许模型在执行当前任务时访问先前子任务的信息。然而，UI-TARS 和 Mobile-Agent-v3 在迭代任务上的表现均不及 M3A。对于 UI-TARS，这可能归因于滑动窗口在上下文中积累了大量无关记忆，干扰模型性能。相比之下，Mobile-Agent-v3 的更复杂架构在任务执行期间带来更大的上下文管理不稳定性，降低了对迭代操作的鲁棒性。M3A 在迭代任务上优于其他基线，可能是因为其基于摘要的上下文管理提供了更简单、更加稳定的体系结构，在重复执行相似操作时保持较低的失败率。AgentProg 超越所有基线方法，在迭代和组合法任务上都展现出显著优势。基于程序的上下文管理方法能够在两类任务中实现稳健完成：通过程序变量有效保留关键信息，同时在解析程序结构时消除冗余和无关记忆。这种双重能力使 AgentProg 能在现有方法在记忆保留与干扰降低之间取舍时脱颖而出。</span></p><p><img src="https://raw.githubusercontent.com/Tsuki-Gor/Pic_Bed_Ob/main/Mixed/M2026/02/2026_02_18__20_17_08_9e4daa.jpg"/></p><p>&nbsp;</p><p><span>Figure 7: Success Rate (%) across difficulty task types on AW-Extend.</span>
<span>图7：AW-Extend 上不同难度任务类型的成功率（%）。</span></p><p><span>Impact of Global Belief State. We further investigate the contribution of the global belief state component by comparing AgentProg with a variant that removes this module. The results reveal substantial performance improvements achieved by incorporating belief state tracking: the success rate improves from 53.9% to 78.0% on AndroidWorld (increased by 24.1%), and from 35.1% to 68.4% on AW-Extend (increased by 33.3%). These significant gains underscore the critical role of global belief state in long-horizon tasks. The global belief state mechanism enhances the agent&#39;s understanding of environmental states, enabling it to detect and recover from unexpected situations immediately. This capability is particularly valuable for maintaining execution stability, which becomes increasingly crucial as task horizons extend. The more pronounced performance improvement on AW-Extend further validates that belief state tracking becomes even more essential for complex, multi-step tasks. By maintaining a structured representation of the current environment state, the global belief state allows AgentProg to make more informed decisions, reduce cascading errors, and ultimately achieve more robust task completion across diverse scenarios.</span>
<span>全球信念状态的影响。我们通过将 AgentProg 与移除此模块的变体进行对比，进一步研究全球信念状态组件的贡献。结果显示，纳入信念状态跟踪可带来显著的性能提升：在 AndroidWorld 上成功率从 53.9% 提升至 78.0%（提升 24.1%），在 AW-Extend 上从 35.1% 提升至 68.4%（提升 33.3%）。这些显著的提升强调了全球信念状态在长时程任务中的关键作用。全球信念状态机制提升了智能体对环境状态的理解，使其能够立即检测并从意外情境中恢复。这一能力对维持执行稳定性尤为重要，随着任务时程的延展变得愈发关键。AW-Extend 上更为显著的性能提升进一步验证了信念状态跟踪在复杂的多步骤任务中变得更加必要。通过维护对当前环境状态的结构化表示，全球信念状态使 AgentProg 能做出更明智的决策，减少级联错误，并最终在各种情境中实现更稳健的任务完成。</span></p><h3 id='53-analysis-of-latency-and-cost'><span>5.3 Analysis of Latency and Cost</span></h3><h3 id='53-延迟与成本分析'><span>5.3 延迟与成本分析</span></h3><p><span>Token Consumption and Latency. As shown in Table 3, we compare the token consumption and latency per task across AgentProg and two baseline methods: Mobile-Agent-v3 and UI-TARS, which outperform other baselines in An-droidWorld and AW-Extend respectively. First, We analyze token consumption by distinguishing between static prefix and dynamic prompt tokens since AgentProg is based on prompt engineering with substantial system prompts, a large portion of the prefix can be cached to reduce cost and improve efficiency. This distinction provides meaningful insights into the true efficiency of different approaches. Second, we compare only tasks where all three methods succeeded, as failed tasks exhibit inconsistent token patterns-some fail due to premature termination, leading to low token counts, while others fail after excessive iterative trial-and-error operations, leading to high token counts. Including failed tasks would obscure the true efficiency characteristics of each method.</span>
<span>令牌消耗与延迟。正如表 3 所示，我们比较 AgentProg 与两种基线方法：Mobile-Agent-v3 与 UI-TARS，在 AndroidWorld 与 AW-Extend 的表现分别优于其他基线。首先，我们通过区分静态前缀与动态提示令牌来分析令牌消耗，因为 AgentProg 基于大量系统提示的提示工程，前缀的很大一部分可以缓存以降低成本并提高效率。此区分为不同方法的真实效率提供了有意义的洞察。其次，我们仅比较三种方法都成功的任务，因为失败的任务会呈现不一致的令牌模式——有些因提前终止导致令牌数量偏低，而有些在大量迭代试错后失败导致令牌数量偏高。包含失败任务会掩盖各方法的真实效率特征。</span></p><p><span>Table 3 shows that UI-TARS demonstrates the lowest latency and minimal token consumption because its backbone model trained on extensive data with short static prompts and performs no additional context processing (e.g., summarization), resulting in minimal output tokens and the fastest execution speed. In contrast, Mobile-Agent-v3, while also using a trained model with relatively short static prefix (53 tokens per call), requires more tokens than UI-TARS due to its summarization and reflection process. Since AgentProg is implemented through prompt engineering, it contains a substantial static prompt prefix (12.5k tokens per call), resulting in a much higher proportion of cached tokens in the input, which reduces the cost of input tokens. Notably, AgentProg achieves significantly lower dynamic token counts compared to Mobile-Agent-v3, with performance comparable to UI-TARS. This demonstrates the effectiveness of AgentProg&#39;s context management approach over hierarchical planning method in maintaining compact context. However, Agent-Prog generates significantly more output tokens compared to both baselines, as it produces extensive intermediate content for context management including belief state, and many operations involve program counter update and variable manipulations. In terms of latency, AgentProg exhibits longer execution time than Mobile-Agent-v3, primarily attributable to the increased output token generation. All three methods exhibit consistent trends across task categories: iterative tasks involve numerous repeated subtasks and thus require higher token consumption, while compositional tasks contain fewer combined subtasks and consequently demand fewer tokens.</span>
<span>表 3 显示 UI-TARS 展现出最低的延迟和最小的令牌消耗，因为其骨干模型在大量数据上训练，静态提示简短且不进行额外上下文处理（如摘要），因此输出令牌最少且执行速度最快。相较之下，Mobile-Agent-v3 虽然同样使用经过训练的模型且静态前缀相对较短（每次调用 53 个令牌），但由于其摘要与反思过程需要更多令牌。由于 AgentProg 通过提示工程实现，包含大量静态提示前缀（每次调用 12.5k 令牌），导致输入中缓存令牌比例更高，降低了输入令牌的成本。值得注意的是，AgentProg 的动态令牌数量显著低于 Mobile-Agent-v3，与 UI-TARS 的性能相当。这充分证明了 AgentProg 的上下文管理方法在维持紧凑上下文方面优于分层规划方法。然而，与两基线相比，AgentProg 产生的输出令牌显著更多，因为它为上下文管理包括信念状态在内的中间内容，以及许多操作涉及程序计数器更新与变量操作。在延迟方面，AgentProg 的执行时间长于 Mobile-Agent-v3，主要归因于输出令牌生成增加。三种方法在各任务类别中都呈现出一致的趋势：迭代任务包含大量重复子任务，因此需要更高的令牌消耗；而组合任务包含的子任务较少，因此需要的令牌也更少。</span></p><p><img src="https://raw.githubusercontent.com/Tsuki-Gor/Pic_Bed_Ob/main/Mixed/M2026/02/2026_02_18__20_17_08_29a638.jpg"/></p><p>&nbsp;</p><p><span>Figure 8: Dynamic context tokens in 50 steps.</span>
<span>图 8：50 步的动态上下文令牌。</span></p><p><span>Context Tokens Over Steps. As shown in Figure 8, we analyze the dynamic context growth patterns of different methods over extended task execution in 50 steps. We compute the average dynamic tokens at each step across all agent trajectories on the AW-Extend benchmark. UI-TARS performs minimal processing of historical information, only discarding excess screenshots when necessary. Consequently, a notable drawback of this approach is the continuous growth of context length over time. UI-TARS exhibits rapid dynamic context growth in the first 5 steps, primarily because each step adds a new screenshot to the context. From step 6 onwards, the growth rate slows as UI-TARS begins discarding the oldest screenshot while adding a new one, with context expansion mainly driven by the textual portion of historical information.</span>
<span>按步的上下文令牌。正如图 8 所示，我们分析在 50 步的扩展任务执行中，不同方法的动态上下文增长模式。我们计算 AW-Extend 基准上所有智能体轨迹在每一步的平均动态令牌。UI-TARS 对历史信息处理最少，只在必要时丢弃多余的截图。因此，该方法的一个显著缺点是在时间推移中上下文长度持续增长。UI-TARS 在前 5 步呈现出快速的动态上下文增长，主要是因为每一步都向上下文中添加一个新的截图。从第 6 步起，增长速度放缓，因为 UI-TARS 开始丢弃最旧的截图并添加新截图，上下文扩展主要由历史信息的文本部分驱动。</span></p><p><span>Mobile-Agent-v3 also achieves relatively slow dynamic token growth thanks to its hierarchical planning mechanism, which decomposes complex tasks into subtasks and progressively removes information during execution. However, Mobile-Agent-v3 maintains dynamic tokens at a consistently high level (approximately 17k tokens) throughout task execution. In contrast, AgentProg consistently maintains dynamic tokens at a lower level (approximately </span><mjx-container class="MathJax" jax="SVG" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="2.326ex" height="1.62ex" role="img" focusable="false" viewBox="0 -694 1028 716" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -0.05ex;"><defs><path id="MJX-3355-TEX-N-39" d="M352 287Q304 211 232 211Q154 211 104 270T44 396Q42 412 42 436V444Q42 537 111 606Q171 666 243 666Q245 666 249 666T257 665H261Q273 665 286 663T323 651T370 619T413 560Q456 472 456 334Q456 194 396 97Q361 41 312 10T208 -22Q147 -22 108 7T68 93T121 149Q143 149 158 135T173 96Q173 78 164 65T148 49T135 44L131 43Q131 41 138 37T164 27T206 22H212Q272 22 313 86Q352 142 352 280V287ZM244 248Q292 248 321 297T351 430Q351 508 343 542Q341 552 337 562T323 588T293 615T246 625Q208 625 181 598Q160 576 154 546T147 441Q147 358 152 329T172 282Q197 248 244 248Z"></path><path id="MJX-3355-TEX-N-6B" d="M36 46H50Q89 46 97 60V68Q97 77 97 91T97 124T98 167T98 217T98 272T98 329Q98 366 98 407T98 482T98 542T97 586T97 603Q94 622 83 628T38 637H20V660Q20 683 22 683L32 684Q42 685 61 686T98 688Q115 689 135 690T165 693T176 694H179V463L180 233L240 287Q300 341 304 347Q310 356 310 364Q310 383 289 385H284V431H293Q308 428 412 428Q475 428 484 431H489V385H476Q407 380 360 341Q286 278 286 274Q286 273 349 181T420 79Q434 60 451 53T500 46H511V0H505Q496 3 418 3Q322 3 307 0H299V46H306Q330 48 330 65Q330 72 326 79Q323 84 276 153T228 222L176 176V120V84Q176 65 178 59T189 49Q210 46 238 46H254V0H246Q231 3 137 3T28 0H20V46H36Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="39" xlink:href="#MJX-3355-TEX-N-39"></use></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(500,0)"><g data-mml-node="mi"><use data-c="6B" xlink:href="#MJX-3355-TEX-N-6B"></use></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>9</mn><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">k</mi></mrow></math></mjx-assistive-mml></mjx-container><script type="math/tex">9\mathrm{k}</script><span> tokens),demonstrating advantages over both baselines. During 50 steps, the dynamic context token count in AgentProg remains nearly constant, indicating the effectiveness of our program-guided management in maintaining a compact representation of context. This stability is achieved through our approach&#39;s ability to represent critical information in program variables and global belief state, while systematically pruning redundant and irrelevant historical details by parsing program structure. AgentProg scales efficiently to long-horizon tasks, ensuring consistent performance even as task complexity and duration increase, while requiring much fewer dynamic tokens than existing methods.</span>
<span>Mobile-Agent-v3 也通过分层规划机制实现相对缓慢的动态令牌增长，将复杂任务分解为子任务并在执行过程中逐步去除信息。然而，Mobile-Agent-v3 在任务执行过程中始终维持较高水平的动态令牌（约 17k 令牌）。相比之下，AgentProg 始终将动态令牌维持在较低水平（约 </span><mjx-container class="MathJax" jax="SVG" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="2.326ex" height="1.62ex" role="img" focusable="false" viewBox="0 -694 1028 716" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -0.05ex;"><defs><path id="MJX-3355-TEX-N-39" d="M352 287Q304 211 232 211Q154 211 104 270T44 396Q42 412 42 436V444Q42 537 111 606Q171 666 243 666Q245 666 249 666T257 665H261Q273 665 286 663T323 651T370 619T413 560Q456 472 456 334Q456 194 396 97Q361 41 312 10T208 -22Q147 -22 108 7T68 93T121 149Q143 149 158 135T173 96Q173 78 164 65T148 49T135 44L131 43Q131 41 138 37T164 27T206 22H212Q272 22 313 86Q352 142 352 280V287ZM244 248Q292 248 321 297T351 430Q351 508 343 542Q341 552 337 562T323 588T293 615T246 625Q208 625 181 598Q160 576 154 546T147 441Q147 358 152 329T172 282Q197 248 244 248Z"></path><path id="MJX-3355-TEX-N-6B" d="M36 46H50Q89 46 97 60V68Q97 77 97 91T97 124T98 167T98 217T98 272T98 329Q98 366 98 407T98 482T98 542T97 586T97 603Q94 622 83 628T38 637H20V660Q20 683 22 683L32 684Q42 685 61 686T98 688Q115 689 135 690T165 693T176 694H179V463L180 233L240 287Q300 341 304 347Q310 356 310 364Q310 383 289 385H284V431H293Q308 428 412 428Q475 428 484 431H489V385H476Q407 380 360 341Q286 278 286 274Q286 273 349 181T420 79Q434 60 451 53T500 46H511V0H505Q496 3 418 3Q322 3 307 0H299V46H306Q330 48 330 65Q330 72 326 79Q323 84 276 153T228 222L176 176V120V84Q176 65 178 59T189 49Q210 46 238 46H254V0H246Q231 3 137 3T28 0H20V46H36Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><use data-c="39" xlink:href="#MJX-3355-TEX-N-39"></use></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(500,0)"><g data-mml-node="mi"><use data-c="6B" xlink:href="#MJX-3355-TEX-N-6B"></use></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>9</mn><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">k</mi></mrow></math></mjx-assistive-mml></mjx-container><script type="math/tex">9\mathrm{k}</script><span> 令牌），显示出相对于两个基线的优势。在 50 步中，AgentProg 的动态上下文令牌数量几乎保持不变，表明我们通过程序引导管理来维持紧凑的上下文表示的有效性。这一稳定性通过我们的方法将关键信息表示在程序变量和全局信念状态中实现，并通过解析程序结构系统性地裁剪冗余和不相关的历史细节来实现。AgentProg 能高效扩展到长时程任务，即使任务复杂性和时长增加也能保持稳定性能，同时需要比现有方法少得多的动态令牌。</span></p><p><span>Table 3: Per-Task Token Consumption and Latency for Successful Attempts on AW-Extend. &quot;Static Prefix&quot; represents the static prefix prompt tokens that remain constant across invocations, &quot;Dynamic&quot; represents the prompt tokens that continuously change during task execution, and &quot;Output&quot; represents the total number of tokens generated during task execution.</span>
<span>表 3：AW-Extend 成功尝试的每任务令牌消耗与延迟。“静态前缀”表示在调用之间保持不变的静态前缀提示令牌，“动态”表示在任务执行期间持续变化的提示令牌，“输出”表示任务执行中生成的总令牌数。</span></p><table><tr><td>Agent</td><td>Task Set</td><td>Static Prefix (k)</td><td>Dynamic (k)</td><td>Output (k)</td><td>Latency (s)</td></tr><tr><td rowspan="3">UI-TARS</td><td>Overall</td><td>8.1</td><td>315.5</td><td>3.2</td><td>312</td></tr><tr><td>Iterative</td><td>8.5</td><td>329.6</td><td>3.3</td><td>344</td></tr><tr><td>Compositional</td><td>7.6</td><td>294.3</td><td>3.0</td><td>263</td></tr><tr><td rowspan="3">Mobile-Agent-v3</td><td>Overall</td><td>7.9</td><td>809.4</td><td>22.1</td><td>1604</td></tr><tr><td>Iterative</td><td>8.9</td><td>917.6</td><td>26.1</td><td>2033</td></tr><tr><td>Compositional</td><td>5.8</td><td>592.9</td><td>14.2</td><td>746</td></tr><tr><td rowspan="3">AgentProg</td><td>Overall</td><td>1026.4</td><td>301.3</td><td>179.7</td><td>2662</td></tr><tr><td>Iterative</td><td>1275.3</td><td>370.3</td><td>225.1</td><td>2910</td></tr><tr><td>Compositional</td><td>777.4</td><td>232.4</td><td>134.3</td><td>2164</td></tr></table>
<table><tbody><tr><td>代理</td><td>任务集</td><td>静态前缀 (k)</td><td>动态 (k)</td><td>输出 (k)</td><td>延迟 (s)</td></tr><tr><td rowspan="3">UI-TARS</td><td>总体</td><td>8.1</td><td>315.5</td><td>3.2</td><td>312</td></tr><tr><td>迭代的</td><td>8.5</td><td>329.6</td><td>3.3</td><td>344</td></tr><tr><td>组成的</td><td>7.6</td><td>294.3</td><td>3.0</td><td>263</td></tr><tr><td rowspan="3">Mobile-Agent-v3</td><td>总体</td><td>7.9</td><td>809.4</td><td>22.1</td><td>1604</td></tr><tr><td>迭代的</td><td>8.9</td><td>917.6</td><td>26.1</td><td>2033</td></tr><tr><td>组成的</td><td>5.8</td><td>592.9</td><td>14.2</td><td>746</td></tr><tr><td rowspan="3">AgentProg</td><td>总体</td><td>1026.4</td><td>301.3</td><td>179.7</td><td>2662</td></tr><tr><td>迭代的</td><td>1275.3</td><td>370.3</td><td>225.1</td><td>2910</td></tr><tr><td>组成的</td><td>777.4</td><td>232.4</td><td>134.3</td><td>2164</td></tr></tbody></table><p><span>Table 4: Per-Task Average Steps on AW-Extend.</span>
<span>Table 4: AW-Extend 上的每任务平均步数。</span></p><table><tr><td>Task Set</td><td>AgentProg</td><td>Mobile-Agent-v3</td><td>UI-TARS</td></tr><tr><td colspan="4">All Attempts</td></tr><tr><td>Overall</td><td>129.6</td><td>134.0</td><td>225.5</td></tr><tr><td>Iterative</td><td>138.5</td><td>169.1</td><td>224.9</td></tr><tr><td>Compositional</td><td>104.6</td><td>34.0</td><td>227.0</td></tr><tr><td colspan="4">Successful Attempts Only</td></tr><tr><td>Overall</td><td>37.7</td><td>51.2</td><td>43.6</td></tr><tr><td>Iterative</td><td>36.8</td><td>57.8</td><td>50.0</td></tr><tr><td>Compositional</td><td>39.5</td><td>38.0</td><td>34.0</td></tr></table>
<table><tbody><tr><td>任务集</td><td>代理程序</td><td>移动代理-v3</td><td>用户界面-TARS</td></tr><tr><td colspan="4">所有尝试</td></tr><tr><td>总体</td><td>129.6</td><td>134.0</td><td>225.5</td></tr><tr><td>迭代</td><td>138.5</td><td>169.1</td><td>224.9</td></tr><tr><td>组合式</td><td>104.6</td><td>34.0</td><td>227.0</td></tr><tr><td colspan="4">仅成功尝试</td></tr><tr><td>总体</td><td>37.7</td><td>51.2</td><td>43.6</td></tr><tr><td>迭代</td><td>36.8</td><td>57.8</td><td>50.0</td></tr><tr><td>组合式</td><td>39.5</td><td>38.0</td><td>34.0</td></tr></tbody></table><p><span>Average Steps per Task. Table 4 presents the average number of steps required per task for AgentProg and baselines on the AW-Extend dataset. Step counts should be interpreted with caution, as different methods require varying numbers of model queries per step: Mobile-Agent-v3 queries the language model three times per step and UI-TARS queries once per step while AgentProg uses two queries per step.</span>
<span>每步任务的平均步骤数。表4给出AW-Extend数据集上 AgentProg 与基线在每个任务上所需的平均步骤数。应谨慎解读步骤计数，因为不同方法每步所需的模型查询次数不同：Mobile-Agent-v3 每步查询语言模型三次，UI-TARS 每步查询一次，而 AgentProg 每步使用两次查询。</span></p><p><span>The trends in step counts largely match those observed in token consumption as shown in Table 3. When considering all attempts, the compositional task results show an anomalous pattern where Mobile-Agent-v3 uses very few steps, attributable to premature task termination due to forgotten subtasks. When examining only successful attempts, AgentProg requires fewer steps than baselines across the overall tasks and iterative tasks, with comparable performance on composition tasks. This demonstrates that AgentProg achieves better performance while maintaining step efficiency. The higher step counts in &quot;All Attempts&quot; group compared to &quot;Successful Attempts Only&quot; group can be attributed to two factors: first, tasks requiring fewer steps are inherently easier to complete successfully; second, failed attempts in &quot;All Attempts&quot; involve substantial iterative trial-and-error operations that inflate the step count.</span>
<span>步骤计数的趋势在很大程度上与表3所示的代币消耗趋势一致。考虑所有尝试时，组合任务的结果显示出异常模式：Mobile-Agent-v3 使用的步骤极少，原因在于子任务被遗忘导致的任务提前终止。仅在成功尝试的情况下，AgentProg 在整体任务与迭代任务中所需的步骤更少，与组合任务的性能相当。这表明 AgentProg 在保持步骤效率的同时实现了更好的性能。与“仅成功尝试”组相比，“所有尝试”组的较高步骤数可归因于两点：一是需要较少步骤的任务本身更易于成功完成；二是“All Attempts”中的失败尝试包含大量迭代性试错操作，从而抬高了步骤计数。</span></p><h2 id='6-conclusion'><span>6 Conclusion</span></h2><h2 id='6-结论'><span>6 结论</span></h2><p><span>In this work, we introduce AgentProg to address the context bottleneck in long-horizon tasks. By reframing interaction history into a structured Semantic Task Program, Agent-Prog enables principled context pruning and critical variable retention. Additionally, our Global Belief State mechanism maintains an active mental model to handle partial observability and environmental dynamics. Experiments on An-droidWorld and our AW-Extend benchmark demonstrate that AgentProg significantly outperforms state-of-the-art baselines. Ultimately, our work establishes a scalable foundation for robust agent deployment in complex real-world scenarios.</span>
<span>本文提出 AgentProg，旨在解决长时间任务中的上下文瓶颈。通过将交互历史重构为结构化的语义任务程序，AgentProg 实现了原理性的上下文裁剪和关键变量保留。此外，我们的全局信念状态机制维持一个活跃的心理模型，以处理部分可观测性和环境动态。在 AndroidWorld 和 AW-Extend 基准测试中的实验表明，AgentProg 显著优于现有最先进的基线。最终，我们的工作为在复杂现实场景中实现鲁棒代理部署提供了可扩展的基础。</span></p><h2 id='references'><span>References</span></h2><h2 id='参考文献'><span>参考文献</span></h2><p><span>[1] Saaket Agashe, Kyle Wong, Vincent Tu, Jiachen Yang, Ang Li, and Xin Eric Wang. 2025. Agent S2: A Compositional Generalist-Specialist Framework for Computer Use Agents. arXiv:2504.00906 [cs.AI] https: //arxiv.org/abs/2504.00906</span>
<span>[1] Saaket Agashe, Kyle Wong, Vincent Tu, Jiachen Yang, Ang Li, and Xin Eric Wang. 2025. Agent S2: A Compositional Generalist-Specialist Framework for Computer Use Agents. arXiv:2504.00906 [cs.AI] https: //arxiv.org/abs/2504.00906</span></p><p><span>[2] Chenxin An, Jun Zhang, Ming Zhong, Lei Li, Shansan Gong, Yao Luo, Jingjing Xu, and Lingpeng Kong. 2024. Why does the effective context length of LLMs fall short? arXiv preprint arXiv:2410.18745 (2024).</span>
<span>[2] Chenxin An, Jun Zhang, Ming Zhong, Lei Li, Shansan Gong, Yao Luo, Jingjing Xu, and Lingpeng Kong. 2024. Why does the effective context length of LLMs fall short? arXiv preprint arXiv:2410.18745 (2024).</span></p><p><span>[3] Tanzirul Azim, Oriana Riva, and Suman Nath. 2016. ULink: Enabling User-Defined Deep Linking to App Content. In Proceedings of the 14th Annual International Conference on Mobile Systems, Applications, and Services (Singapore, Singapore) (MobiSys &#39;16). Association for Computing Machinery, New York, NY, USA, 305-318. doi:10.1145/2906388.2906416</span>
<span>[3] Tanzirul Azim, Oriana Riva, and Suman Nath. 2016. ULink: Enabling User-Defined Deep Linking to App Content. In Proceedings of the 14th Annual International Conference on Mobile Systems, Applications, and Services (Singapore, Singapore) (MobiSys &#39;16). Association for Computing Machinery, New York, NY, USA, 305-318. doi:10.1145/2906388.2906416</span></p><p><span>[4] Kanzhi Cheng, Qiushi Sun, Yougang Chu, Fangzhi Xu, Yantao Li, Jian-bing Zhang, and Zhiyong Wu. 2024. SeeClick: Harnessing GUI Grounding for Advanced Visual GUI Agents. arXiv:2401.10935 [cs.HC]</span>
<span>[4] Kanzhi Cheng, Qiushi Sun, Yougang Chu, Fangzhi Xu, Yantao Li, Jian-bing Zhang, and Zhiyong Wu. 2024. SeeClick: Harnessing GUI Grounding for Advanced Visual GUI Agents. arXiv:2401.10935 [cs.HC]</span></p><p><span>[5] Gaole Dai, Shiqi Jiang, Ting Cao, Yuanchun Li, Yuqing Yang, Rui Tan, Mo Li, and Lili Qiu. 2025. Advancing mobile gui agents: A verifier-driven approach to practical deployment. arXiv preprint arXiv:2503.15937 (2025).</span>
<span>[5] Gaole Dai, Shiqi Jiang, Ting Cao, Yuanchun Li, Yuqing Yang, Rui Tan, Mo Li, and Lili Qiu. 2025. Advancing mobile gui agents: A verifier-driven approach to practical deployment. arXiv preprint arXiv:2503.15937 (2025).</span></p><p><span>[6] Xinzge Gao, Chuanrui Hu, Bin Chen, and Teng Li. 2025. Chain-of-Memory: Enhancing GUI Agents for Cross-Application Navigation. arXiv:2506.18158 [cs.AI] </span><a href='https://arxiv.org/abs/2506.18158' target='_blank' class='url'>https://arxiv.org/abs/2506.18158</a>
<span>[6] Xinzge Gao, Chuanrui Hu, Bin Chen, and Teng Li. 2025. Chain-of-Memory: Enhancing GUI Agents for Cross-Application Navigation. arXiv:2506.18158 [cs.AI] </span><a href='https://arxiv.org/abs/2506.18158' target='_blank' class='url'>https://arxiv.org/abs/2506.18158</a></p><p><span>[7] Gonzalo Gonzalez-Pumariega, Vincent Tu, Chih-Lun Lee, Jiachen Yang, Ang Li, and Xin Eric Wang. 2025. The Unreasonable Effectiveness of Scaling Agents for Computer Use. arXiv:2510.02250 [cs.AI] https: //arxiv.org/abs/2510.02250</span>
<span>[7] Gonzalo Gonzalez-Pumariega, Vincent Tu, Chih-Lun Lee, Jiachen Yang, Ang Li, and Xin Eric Wang. 2025. The Unreasonable Effectiveness of Scaling Agents for Computer Use. arXiv:2510.02250 [cs.AI] https: //arxiv.org/abs/2510.02250</span></p><p><span>[8] Google. 2025. Gemini 2.5 Pro - Google DeepMind. </span><a href='https://deepmind.google/models/gemini/pro/' target='_blank' class='url'>https://deepmind.google/models/gemini/pro/</a><span>.</span>
<span>[8] Google. 2025. Gemini 2.5 Pro - Google DeepMind. </span><a href='https://deepmind.google/models/gemini/pro/' target='_blank' class='url'>https://deepmind.google/models/gemini/pro/</a><span>.</span></p><p><span>[9] Boyu Gou, Ruohan Wang, Boyuan Zheng, Yanan Xie, Cheng Chang, Yiheng Shu, Huan Sun, and Yu Su. 2025. Navigating the Digital World as Humans Do: Universal Visual Grounding for GUI Agents. In The Thirteenth International Conference on Learning Representations. https: //openreview.net/forum?id=kxnoqaisCT</span>
<span>[9] Boyu Gou, Ruohan Wang, Boyuan Zheng, Yanan Xie, Cheng Chang, Yiheng Shu, Huan Sun, and Yu Su. 2025. Navigating the Digital World as Humans Do: Universal Visual Grounding for GUI Agents. In The Thirteenth International Conference on Learning Representations. https: //openreview.net/forum?id=kxnoqaisCT</span></p><p><span>[10] Zhangxuan Gu, Zhengwen Zeng, Zhenyu Xu, Xingran Zhou, Shuheng Shen, Yunfei Liu, Beitong Zhou, Changhua Meng, Tianyu Xia, Weizhi Chen, et al. 2025. Ui-venus technical report: Building high-performance ui agents with rft. arXiv preprint arXiv:2508.10833 (2025).</span>
<span>[10] 张煊顾, 曾正闻, 徐振宇, 周星然, 沈书恒, 刘云飞, 周北同, 孟长华, 夏天羽, 陈伟志, 等. 2025. Ui-venus 技术报告：构建具有高性能 UI 代理的 rft。arXiv 预印本 arXiv:2508.10833 (2025).</span></p><p><span>[11] Izzeddin Gur, Hiroki Furuta, Austin V Huang, Mustafa Safdari, Yutaka Matsuo, Douglas Eck, and Aleksandra Faust. 2024. A Real-World We-bAgent with Planning, Long Context Understanding, and Program Synthesis. In The Twelfth International Conference on Learning Representations. </span><a href='https://openreview.net/forum?id=9JQtrumvg8' target='_blank' class='url'>https://openreview.net/forum?id=9JQtrumvg8</a>
<span>[11] Izzeddin Gur, Hiroki Furuta, Austin V Huang, Mustafa Safdari, Yutaka Matsuo, Douglas Eck, 和 Aleksandra Faust. 2024. 一个带计划、长上下文理解与程序合成的真实世界 WebAgent。收录于 第十二届学习表征国际会议。</span><a href='https://openreview.net/forum?id=9JQtrumvg8' target='_blank' class='url'>https://openreview.net/forum?id=9JQtrumvg8</a></p><p><span>[12] Wenyi Hong, Wenmeng Yu, Xiaotao Gu, Guo Wang, Guobing Gan, Haomiao Tang, Jiale Cheng, Ji Qi, Junhui Ji, Lihang Pan, et al. 2025. GLM-4.1 V-Thinking: Towards Versatile Multimodal Reasoning with Scalable Reinforcement Learning. arXiv preprint arXiv:2507.01006 (2025).</span>
<span>[12] 温毅宏, 温猛瑜, 小涛 固, 郭 王, 郭炳 干, 浩苗 唐, 嘉乐 程, Ji Qi, Junhui Ji, 李航 潘, 等. 2025. GLM-4.1 V-Thinking：面向可扩展强化学习的多模态推理的多样化能力。arXiv 预印本 arXiv:2507.01006 (2025).</span></p><p><span>[13] Leslie Pack Kaelbling, Michael L. Littman, and Anthony R. Cassandra. 1998. Planning and acting in partially observable stochastic domains. Artif. Intell. 101, 1-2 (May 1998), 99-134.</span>
<span>[13] Leslie Pack Kaelbling, Michael L. Littman, and Anthony R. Cassandra. 1998. 在部分可观测的随机域中的规划与行动。人工智能 101(1-2)，1998年5月，99-134。</span></p><p><span>[14] Sunjae Lee, Junyoung Choi, Jungjae Lee, Munim Hasan Wasi, Ho-jun Choi, Steve Ko, Sangeun Oh, and Insik Shin. 2024. MobileGPT: Augmenting LLM with Human-like App Memory for Mobile Task Automation. In Proceedings of the 30th Annual International Conference on Mobile Computing and Networking (Washington D.C., DC, USA) (ACM MobiCom &#39;24). Association for Computing Machinery, New York, NY, USA, 1119-1133. doi:10.1145/3636534.3690682</span>
<span>[14] Sunjae Lee, Junyoung Choi, Jungjae Lee, Munim Hasan Wasi, Ho-jun Choi, Steve Ko, Sangeun Oh, and Insik Shin. 2024. MobileGPT：用类似人类的应用记忆来增强 LLM 的移动任务自动化。收录于 第三十届国际移动计算与网络大会（华盛顿特区，美国）（ACM MobiCom &#39;24）。计算机协会，纽约，纽约，美国，1119-1133。doi:10.1145/3636534.3690682</span></p><p><span>[15] Kuan Li, Zhongwang Zhang, Huifeng Yin, Rui Ye, Yida Zhao, Li-wen Zhang, Litu Ou, Dingchu Zhang, Xixi Wu, Jialong Wu, et al. 2025. Websailor-v2: Bridging the chasm to proprietary agents via synthetic data and scalable reinforcement learning. arXiv preprint arXiv:2509.13305 (2025).</span>
<span>[15] Kuan Li, Zhongwang Zhang, Huifeng Yin, Rui Ye, Yida Zhao, Li-wen Zhang, Litu Ou, Dingchu Zhang, Xixi Wu, Jialong Wu, 等. 2025. Websailor-v2：通过合成数据与可扩展强化学习弥合专有代理的鸿沟。arXiv 预印本 arXiv:2509.13305 (2025).</span></p><p><span>[16] Ning Li, Qiqiang Lin, Zheng Wu, Xiaoyun Mo, Weiming Zhang, Yin Zhao, Xiangmou Qu, Jiamu Zhou, Jun Wang, Congmin Zheng, et al. 2025. ColorAgent: Building A Robust, Personalized, and Interactive OS Agent. arXiv preprint arXiv:2510.19386 (2025).</span>
<span>[16] Ning Li, Qiqiang Lin, Zheng Wu, Xiaoyun Mo, Weiming Zhang, Yin Zhao, Xiangmou Qu, Jiamu Zhou, Jun Wang, Congmin Zheng, 等. 2025. ColorAgent：构建一个稳健、个性化、可交互的操作系统代理。arXiv 预印本 arXiv:2510.19386 (2025).</span></p><p><span>[17] Ning Li, Xiangmou Qu, Jiamu Zhou, Jun Wang, Muning Wen, Kou-nianhua Du, Xingyu Lou, Qiuying Peng, and Weinan Zhang. 2025. MobileUse: A GUI Agent with Hierarchical Reflection for Autonomous Mobile Operation. arXiv preprint arXiv:2507.16853 (2025).</span>
<span>[17] Ning Li, Xiangmou Qu, Jiamu Zhou, Jun Wang, Muning Wen, Kou-nianhua Du, Xingyu Lou, Qiuying Peng, and Weinan Zhang. 2025. MobileUse：具层次反思的 GUI 代理，用于自主移动操作。arXiv 预印本 arXiv:2507.16853 (2025).</span></p><p><span>[18] Toby Jia-Jun Li and Oriana Riva. 2018. Kite: Building Conversational Bots from Mobile Apps. In Proceedings of the 16th Annual International Conference on Mobile Systems, Applications, and Services (Munich, Germany) (MobiSys &#39;18). Association for Computing Machinery, New York, NY, USA, 96-109. doi:10.1145/3210240.3210339</span>
<span>[18] Toby Jia-Jun Li and Oriana Riva. 2018. Kite：从移动应用构建对话机器人。收录于 第十六届国际移动系统、应用与服务会议（慕尼黑，德国）（MobiSys &#39;18）。 ACM，纽约，美国，96-109。doi:10.1145/3210240.3210339</span></p><p><span>[19] Yang Li, Jiacong He, Xin Zhou, Yuan Zhang, and Jason Baldridge. 2020. Mapping Natural Language Instructions to Mobile UI Action Sequences. In Annual Conference of the Association for Computational Linguistics (ACL 2020). </span><a href='https://www.aclweb.org/anthology/2020.acl-main.729.pdf' target='_blank' class='url'>https://www.aclweb.org/anthology/2020.acl-main.729.pdf</a>
<span>[19] Yang Li, Jiacong He, Xin Zhou, Yuan Zhang, and Jason Baldridge. 2020. 将自然语言指令映射到移动 UI 动作序列。计算语言学协会年会（ACL 2020）。</span><a href='https://www.aclweb.org/anthology/2020.acl-main.729.pdf' target='_blank' class='url'>https://www.aclweb.org/anthology/2020.acl-main.729.pdf</a></p><p><span>[20] Jacky Liang, Wenlong Huang, Fei Xia, Peng Xu, Karol Hausman, Brian Ichter, Pete Florence, and Andy Zeng. 2023. Code as Policies: Language Model Programs for Embodied Control. In 2023 IEEE International Conference on Robotics and Automation (ICRA). 9493-9500. doi:10. 1109/ICRA48891.2023.10160591</span>
<span>[20] Jacky Liang, Wenlong Huang, Fei Xia, Peng Xu, Karol Hausman, Brian Ichter, Pete Florence, and Andy Zeng. 2023. 代码即策略：用于具身控制的语言模型程序。2023 IEEE 国际机器人与自动化会议（ICRA）。9493-9500。doi:10. 1109/ICRA48891.2023.10160591</span></p><p><span>[21] Evan Zheran Liu, Kelvin Guu, Panupong Pasupat, Tianlin Shi, and Percy Liang. 2018. Reinforcement Learning on Web Interfaces using Workflow-Guided Exploration. In International Conference on Learning Representations (ICLR). </span><a href='https://arxiv.org/abs/1802.08802' target='_blank' class='url'>https://arxiv.org/abs/1802.08802</a>
<span>[21] Evan Zheran Liu, Kelvin Guu, Panupong Pasupat, Tianlin Shi, and Percy Liang. 2018. 使用工作流引导探索的网页界面强化学习。In International Conference on Learning Representations (ICLR). </span><a href='https://arxiv.org/abs/1802.08802' target='_blank' class='url'>https://arxiv.org/abs/1802.08802</a></p><p><span>[22] Nelson F. Liu, Kevin Lin, John Hewitt, Ashwin Paranjape, Michele Bevilacqua, Fabio Petroni, and Percy Liang. 2024. Lost in the Middle: How Language Models Use Long Contexts. Transactions of the Association for Computational Linguistics 12 (2024), 157-173. doi:10.1162/ tacl_a_00638</span>
<span>[22] Nelson F. Liu, Kevin Lin, John Hewitt, Ashwin Paranjape, Michele Bevilacqua, Fabio Petroni, and Percy Liang. 2024. Lost in the Middle: How Language Models Use Long Contexts. Transactions of the Association for Computational Linguistics 12 (2024), 157-173. doi:10.1162/ tacl_a_00638</span></p><p><span>[23] Shunyu Liu, Minghao Liu, Huichi Zhou, Zhenyu Cui, Yang Zhou, Yuhao Zhou, Wendong Fan, Ge Zhang, Jiajun Shi, Weihao Xuan, et al. 2025. Verigui: Verifiable long-chain gui dataset. arXiv preprint arXiv:2508.04026 (2025).</span>
<span>[23] Shunyu Liu, Minghao Liu, Huichi Zhou, Zhenyu Cui, Yang Zhou, Yuhao Zhou, Wendong Fan, Ge Zhang, Jiajun Shi, Weihao Xuan, et al. 2025. Verigui: Verifiable long-chain gui dataset. arXiv preprint arXiv:2508.04026 (2025).</span></p><p><span>[24] Hussein Mozannar, Gagan Bansal, Cheng Tan, Adam Fourney, Victor Dibia, Jingya Chen, Jack Gerrits, Tyler Payne, Matheus Kunzler Maldaner, Madeleine Grunde-McLaughlin, et al. 2025. Magentic-UI: Towards Human-in-the-loop Agentic Systems. arXiv preprint arXiv:2507.22358 (2025).</span>
<span>[24] Hussein Mozannar, Gagan Bansal, Cheng Tan, Adam Fourney, Victor Dibia, Jingya Chen, Jack Gerrits, Tyler Payne, Matheus Kunzler Maldaner, Madeleine Grunde-McLaughlin, et al. 2025. Magentic-UI: Towards Human-in-the-loop Agentic Systems. arXiv preprint arXiv:2507.22358 (2025).</span></p><p><span>[25] Dang Nguyen, Jian Chen, Yu Wang, Gang Wu, Namyong Park, Zheng-mian Hu, Hanjia Lyu, Junda Wu, Ryan Aponte, Yu Xia, Xintong Li, Jing Shi, Hongjie Chen, Viet Dac Lai, Zhouhang Xie, Sungchul Kim, Ruiyi Zhang, Tong Yu, Mehrab Tanjim, Nesreen K. Ahmed, Puneet Mathur, Seunghyun Yoon, Lina Yao, Branislav Kveton, Jihyung Kil, Thien Huu Nguyen, Trung Bui, Tianyi Zhou, Ryan A. Rossi, and Franck Dernoncourt. 2025. GUI Agents: A Survey. arXiv:2412.13501 [cs.AI] </span><a href='https://arxiv.org/abs/2412.13501' target='_blank' class='url'>https://arxiv.org/abs/2412.13501</a>
<span>[25] Dang Nguyen, Jian Chen, Yu Wang, Gang Wu, Namyong Park, Zheng-mian Hu, Hanjia Lyu, Junda Wu, Ryan Aponte, Yu Xia, Xintong Li, Jing Shi, Hongjie Chen, Viet Dac Lai, Zhouhang Xie, Sungchul Kim, Ruiyi Zhang, Tong Yu, Mehrab Tanjim, Nesreen K. Ahmed, Puneet Mathur, Seunghyun Yoon, Lina Yao, Branislav Kveton, Jihyung Kil, Thien Huu Nguyen, Trung Bui, Tianyi Zhou, Ryan A. Rossi, and Franck Dernoncourt. 2025. GUI Agents: A Survey. arXiv:2412.13501 [cs.AI] </span><a href='https://arxiv.org/abs/2412.13501' target='_blank' class='url'>https://arxiv.org/abs/2412.13501</a></p><p><span>[26] Yujia Qin, Yining Ye, Junjie Fang, Haoming Wang, Shihao Liang, Shizuo Tian, Junda Zhang, Jiahao Li, Yunxin Li, Shijue Huang, et al. 2025. Ui-tars: Pioneering automated gui interaction with native agents. arXiv preprint arXiv:2501.12326 (2025).</span>
<span>[26] Yujia Qin, Yining Ye, Junjie Fang, Haoming Wang, Shihao Liang, Shizuo Tian, Junda Zhang, Jiahao Li, Yunxin Li, Shijue Huang, et al. 2025. Ui-tars: Pioneering automated gui interaction with native agents. arXiv preprint arXiv:2501.12326 (2025).</span></p><p><span>[27] Christopher Rawles, Sarah Clinckemaillie, Yifan Chang, Jonathan Waltz, Gabrielle Lau, Marybeth Fair, Alice Li, William Bishop, Wei Li, Folawiyo Campbell-Ajala, Daniel Toyama, Robert Berry, Divya Tyama-gundlu, Timothy Lillicrap, and Oriana Riva. 2024. AndroidWorld: A Dynamic Benchmarking Environment for Autonomous Agents. arXiv:2405.14573 [cs.AI] </span><a href='https://arxiv.org/abs/2405.14573' target='_blank' class='url'>https://arxiv.org/abs/2405.14573</a>
<span>[27] Christopher Rawles, Sarah Clinckemaillie, Yifan Chang, Jonathan Waltz, Gabrielle Lau, Marybeth Fair, Alice Li, William Bishop, Wei Li, Folawiyo Campbell-Ajala, Daniel Toyama, Robert Berry, Divya Tyama-gundlu, Timothy Lillicrap, and Oriana Riva. 2024. AndroidWorld: A Dynamic Benchmarking Environment for Autonomous Agents. arXiv:2405.14573 [cs.AI] </span><a href='https://arxiv.org/abs/2405.14573' target='_blank' class='url'>https://arxiv.org/abs/2405.14573</a></p><p><span>[28] Philip Schroeder, Nathaniel W Morgan, Hongyin Luo, and James Glass. 2025. Thread: Thinking deeper with recursive spawning. In Proceedings of the 2025 Conference of the Nations of the Americas Chapter of the Association for Computational Linguistics: Human Language Technologies (Volume 1: Long Papers). 8418-8442.</span>
<span>[28] Philip Schroeder, Nathaniel W Morgan, Hongyin Luo, and James Glass. 2025. Thread: Thinking deeper with recursive spawning. In Proceedings of the 2025 Conference of the Nations of the Americas Chapter of the Association for Computational Linguistics: Human Language Technologies (Volume 1: Long Papers). 8418-8442.</span></p><p><span>[29] Leming Shen, Qiang Yang, Yuanqing Zheng, and Mo Li. 2025. Au-toIOT: LLM-Driven Automated Natural Language Programming for AIoT Applications. In Proceedings of the 31st Annual International Conference on Mobile Computing and Networking (Kerry Hotel, Hong Kong, Hong Kong, China) (ACM MOBICOM &#39;25). Association for Computing Machinery, New York, NY, USA, 468-482. doi:10.1145/3680207.3723486</span>
<span>[29] Leming Shen, Qiang Yang, Yuanqing Zheng, and Mo Li. 2025. Au-toIOT: LLM-Driven Automated Natural Language Programming for AIoT Applications. In Proceedings of the 31st Annual International Conference on Mobile Computing and Networking (Kerry Hotel, Hong Kong, Hong Kong, China) (ACM MOBICOM &#39;25). Association for Computing Machinery, New York, NY, USA, 468-482. doi:10.1145/3680207.3723486</span></p><p><span>[30] Edward J. Sondik. 1978. The Optimal Control of Partially Observable Markov Processes Over the Infinite Horizon: Discounted Costs. Operations Research 26, 2 (1978), 282-304. </span><a href='https://doi.org/10.1287/opre.26.2.282' target='_blank' class='url'>https://doi.org/10.1287/opre.26.2.282</a>
<span>[30] Edward J. Sondik. 1978. The Optimal Control of Partially Observable Markov Processes Over the Infinite Horizon: Discounted Costs. Operations Research 26, 2 (1978), 282-304. </span><a href='https://doi.org/10.1287/opre.26.2.282' target='_blank' class='url'>https://doi.org/10.1287/opre.26.2.282</a></p><p><span>[31] Linxin Song, Yutong Dai, Viraj Prabhu, Jieyu Zhang, Taiwei Shi, Li Li, Junnan Li, Silvio Savarese, Zeyuan Chen, Jieyu Zhao, et al. 2025. Coact-1: Computer-using agents with coding as actions. arXiv preprint arXiv:2508.03923 (2025).</span>
<span>[31] Linxin Song, Yutong Dai, Viraj Prabhu, Jieyu Zhang, Taiwei Shi, Li Li, Junnan Li, Silvio Savarese, Zeyuan Chen, Jieyu Zhao, et al. 2025. Coact-1: 使用计算机的代理将编码作为行动。 arXiv 预印本 arXiv:2508.03923 (2025).</span></p><p><span>[32] Liangtai Sun, Xingyu Chen, Lu Chen, Tianle Dai, Zichen Zhu, and Kai Yu. 2022. META-GUI: Towards Multi-modal Conversational Agents on Mobile GUI. arXiv preprint arXiv:2205.11029 (2022).</span>
<span>[32] Liangtai Sun, Xingyu Chen, Lu Chen, Tianle Dai, Zichen Zhu, and Kai Yu. 2022. META-GUI: 面向移动 GUI 的多模态对话代理。 arXiv 预印本 arXiv:2205.11029 (2022).</span></p><p><span>[33] Weihao Tan, Wentao Zhang, Xinrun Xu, Haochong Xia, Ziluo Ding, Boyu Li, Bohan Zhou, Junpeng Yue, Jiechuan Jiang, Yewen Li, Ruyi An, Molei Qin, Chuqiao Zong, Longtao Zheng, Yujie Wu, Xiaoqiang Chai, Yifei Bi, Tianbao Xie, Pengjie Gu, Xiyun Li, Ceyao Zhang, Long Tian, Chaojie Wang, Xinrun Wang, Börje F. Karlsson, Bo An, Shuicheng Yan, and Zongqing Lu. 2024. Cradle: Empowering Foundation Agents Towards General Computer Control. arXiv:2403.03186 [cs.AI] https: //arxiv.org/abs/2403.03186</span>
<span>[33] Weihao Tan, Wentao Zhang, Xinrun Xu, Haochong Xia, Ziluo Ding, Boyu Li, Bohan Zhou, Junpeng Yue, Jiechuan Jiang, Yewen Li, Ruyi An, Molei Qin, Chuqiao Zong, Longtao Zheng, Yujie Wu, Xiaoqiang Chai, Yifei Bi, Tianbao Xie, Pengjie Gu, Xiyun Li, Ceyao Zhang, Long Tian, Chaojie Wang, Xinrun Wang, Börje F. Karlsson, Bo An, Shuicheng Yan, and Zongqing Lu. 2024. Cradle: 赋能基础代理实现通用计算机控制。 arXiv:2403.03186 [cs.AI] https: //arxiv.org/abs/2403.03186</span></p><p><span>[34] Haoming Wang, Haoyang Zou, Huatong Song, Jiazhan Feng, Junjie Fang, Junting Lu, Longxiang Liu, Qinyu Luo, Shihao Liang, Shijue Huang, Wanjun Zhong, Yining Ye, Yujia Qin, Yuwen Xiong, Yuxin Song, Zhiyong Wu, Aoyan Li, Bo Li, Chen Dun, Chong Liu, Daoguang Zan, Fuxing Leng, Hanbin Wang, Hao Yu, Haobin Chen, Hongyi Guo, Jing Su, Jingjia Huang, Kai Shen, Kaiyu Shi, Lin Yan, Peiyao Zhao, Pengfei Liu, Qinghao Ye, Renjie Zheng, Shulin Xin, Wayne Xin Zhao, Wen Heng, Wenhao Huang, Wenqian Wang, Xiaobo Qin, Yi Lin, Youbin Wu, Zehui Chen, Zihao Wang, Baoquan Zhong, Xinchun Zhang, Xujing Li, Yuanfan Li, Zhongkai Zhao, Chengquan Jiang, Faming Wu, Haotian Zhou, Jinlin Pang, Li Han, Qi Liu, Qianli Ma, Siyao Liu, Songhua Cai, Wenqi Fu, Xin Liu, Yaohui Wang, Zhi Zhang, Bo Zhou, Guoliang Li, Jiajun Shi, Jiale Yang, Jie Tang, Li Li, Qihua Han, Taoran Lu, Woyu Lin, Xiaokang Tong, Xinyao Li, Yichi Zhang, Yu Miao, Zhengxuan Jiang, Zili Li, Ziyuan Zhao, Chenxin Li, Dehua Ma, Feng Lin, Ge Zhang, Haihua Yang, Hangyu Guo, Hongda Zhu, Jiaheng Liu, Junda Du, Kai Cai, Kuanye Li, Lichen Yuan, Meilan Han, Minchao Wang, Shuyue Guo, Tianhao Cheng, Xiaobo Ma, Xiaojun Xiao, Xiaolong Huang, Xin-jie Chen, Yidi Du, Yilin Chen, Yiwen Wang, Zhaojian Li, Zhenzhu Yang, Zhiyuan Zeng, Chaolin Jin, Chen Li, Hao Chen, Haoli Chen, Jian Chen, Qinghao Zhao, and Guang Shi. 2025. UI-TARS-2 Technical Report: Advancing GUI Agent with Multi-Turn Reinforcement Learning. arXiv:2509.02544 [cs.AI] </span><a href='https://arxiv.org/abs/2509.02544' target='_blank' class='url'>https://arxiv.org/abs/2509.02544</a>
<span>[34] Haoming Wang, Haoyang Zou, Huatong Song, Jiazhan Feng, Junjie Fang, Junting Lu, Longxiang Liu, Qinyu Luo, Shihao Liang, Shijue Huang, Wanjun Zhong, Yining Ye, Yujia Qin, Yuwen Xiong, Yuxin Song, Zhiyong Wu, Aoyan Li, Bo Li, Chen Dun, Chong Liu, Daoguang Zan, Fuxing Leng, Hanbin Wang, Hao Yu, Haobin Chen, Hongyi Guo, Jing Su, Jingjia Huang, Kai Shen, Kaiyu Shi, Lin Yan, Peiyao Zhao, Pengfei Liu, Qinghao Ye, Renjie Zheng, Shulin Xin, Wayne Xin Zhao, Wen Heng, Wenhao Huang, Wenqian Wang, Xiaobo Qin, Yi Lin, Youbin Wu, Zehui Chen, Zihao Wang, Baoquan Zhong, Xinchun Zhang, Xujing Li, Yuanfan Li, Zhongkai Zhao, Chengquan Jiang, Faming Wu, Haotian Zhou, Jinlin Pang, Li Han, Qi Liu, Qianli Ma, Siyao Liu, Songhua Cai, Wenqi Fu, Xin Liu, Yaohui Wang, Zhi Zhang, Bo Zhou, Guoliang Li, Jiajun Shi, Jiale Yang, Jie Tang, Li Li, Qihua Han, Taoran Lu, Woyu Lin, Xiaokang Tong, Xinyao Li, Yichi Zhang, Yu Miao, Zhengxuan Jiang, Zili Li, Ziyuan Zhao, Chenxin Li, Dehua Ma, Feng Lin, Ge Zhang, Haihua Yang, Hangyu Guo, Hongda Zhu, Jiaheng Liu, Junda Du, Kai Cai, Kuanye Li, Lichen Yuan, Meilan Han, Minchao Wang, Shuyue Guo, Tianhao Cheng, Xiaobo Ma, Xiaojun Xiao, Xiaolong Huang, Xin-jie Chen, Yidi Du, Yilin Chen, Yiwen Wang, Zhaojian Li, Zhenzhu Yang, Zhiyuan Zeng, Chaolin Jin, Chen Li, Hao Chen, Haoli Chen, Jian Chen, Qinghao Zhao, and Guang Shi. 2025. UI-TARS-2 技术报告：通过多轮强化学习推进 GUI 代理。 arXiv:2509.02544 [cs.AI] </span><a href='https://arxiv.org/abs/2509.02544' target='_blank' class='url'>https://arxiv.org/abs/2509.02544</a></p><p><span>[35] Junyang Wang, Haiyang Xu, Jiabo Ye, Ming Yan, Weizhou Shen, Ji Zhang, Fei Huang, and Jitao Sang. 2024. Mobile-agent: Autonomous multi-modal mobile device agent with visual perception. arXiv preprint arXiv:2401.16158 (2024).</span>
<span>[35] Junyang Wang, Haiyang Xu, Jiabo Ye, Ming Yan, Weizhou Shen, Ji Zhang, Fei Huang, and Jitao Sang. 2024. Mobile-agent: 具备视觉感知的自主多模态移动设备代理。 arXiv 预印本 arXiv:2401.16158 (2024).</span></p><p><span>[36] Luyuan Wang, Yongyu Deng, Yiwei Zha, Guodong Mao, Qinmin Wang, Tianchen Min, Wei Chen, and Shoufa Chen. 2024. MobileAgentBench: An Efficient and User-Friendly Benchmark for Mobile LLM Agents. arXiv preprint arXiv:2406.08184 (2024).</span>
<span>[36] 王路源、邓永瑜、查逸炜、毛国栋、王勤敏、闵天辰、陈伟、陈守发。2024。MobileAgentBench：一个高效且易用的移动端LLM代理基准。arXiv 预印本 arXiv:2406.08184 (2024)。</span></p><p><span>[37] Xingyao Wang, Yangyi Chen, Lifan Yuan, Yizhe Zhang, Yunzhu Li, Hao Peng, and Heng Ji. 2024. Executable Code Actions Elicit Better LLM Agents. In ICML. arXiv:2402.01030</span>
<span>[37] Wang Xingyao, Chen Yangyi, Yuan Lifan, Zhang Yizhe, Li Yunzhu, Peng Hao, and Ji Heng. 2024. 可执行代码动作能更好地引导大语言模型代理。In ICML. arXiv:2402.01030</span></p><p><span>[38] Zora Zhiruo Wang, Apurva Gandhi, Graham Neubig, and Daniel Fried. 2025. Inducing Programmatic Skills for Agentic Tasks. In Second Conference on Language Modeling. </span><a href='https://openreview.net/forum?id=' target='_blank' class='url'>https://openreview.net/forum?id=</a><span> IsAY6fWsog</span>
<span>[38] Zora Zhiruo Wang, Apurva Gandhi, Graham Neubig, and Daniel Fried. 2025. 诱导面向任务的程序化技能。发表于“第二届语言模型大会”。</span><a href='https://openreview.net/forum?id=' target='_blank' class='url'>https://openreview.net/forum?id=</a><span> IsAY6fWsog</span></p><p><span>[39] Jason Wei, Xuezhi Wang, Dale Schuurmans, Maarten Bosma, brian ichter, Fei Xia, Ed Chi, Quoc V Le, and Denny Zhou. 2022. Chain-of-Thought Prompting Elicits Reasoning in Large Language Models. In Advances in Neural Information Processing Systems, S. Koyejo, S. Mohamed, A. Agarwal, D. Belgrave, K. Cho, and A. Oh (Eds.), Vol. 35. Curran Associates, Inc., 24824- 24837. </span><a href='https://proceedings.neurips.cc/paper_files/paper/2022/file/' target='_blank' class='url'>https://proceedings.neurips.cc/paper_files/paper/2022/file/</a><span> 9d5609613524ecf4f15af0f7b31abca4-Paper-Conference.pdf</span>
<span>[39] Jason Wei、Xuezhi Wang、Dale Schuurmans、Maarten Bosma、brian ichter、Fei Xia、Ed Chi、Quoc V Le 与 Denny Zhou。2022。Chain-of-Thought Prompting 诱发大型语言模型的推理能力。收录于神经信息处理系统进展，S. Koyejo、S. Mohamed、A. Agarwal、D. Belgrave、K. Cho、A. Oh（编），第 35 卷。Curran Associates, Inc.，24824-24837。</span><a href='https://proceedings.neurips.cc/paper_files/paper/2022/file/9d5609613524ecf4f15af0f7b31abca4-Paper-Conference.pdf' target='_blank' class='url'>https://proceedings.neurips.cc/paper_files/paper/2022/file/9d5609613524ecf4f15af0f7b31abca4-Paper-Conference.pdf</a></p><p><span>[40] Hao Wen, Yuanchun Li, Guohong Liu, Shanhui Zhao, Tao Yu, Toby Jia-Jun Li, Shiqi Jiang, Yunhao Liu, Yaqin Zhang, and Yunxin Liu. 2024. AutoDroid: LLM-powered Task Automation in Android. In Proceedings of the 30th Annual International Conference on Mobile Computing and Networking (Washington D.C., DC, USA) (ACM MobiCom &#39;24). Association for Computing Machinery, New York, NY, USA, 543-557. doi:10.1145/3636534.3649379</span>
<span>[40] Hao Wen, Yuanchun Li, Guohong Liu, Shanhui Zhao, Tao Yu, Toby Jia-Jun Li, Shiqi Jiang, Yunhao Liu, Yaqin Zhang, and Yunxin Liu. 2024. AutoDroid: LLM-powered Task Automation in Android. In Proceedings of the 30th Annual International Conference on Mobile Computing and Networking (Washington D.C., DC, USA) (ACM MobiCom &#39;24). Association for Computing Machinery, New York, NY, USA, 543-557. doi:10.1145/3636534.3649379</span></p><p><span>[41] Hao Wen, Shizuo Tian, Borislav Pavlov, Wenjie Du, Yixuan Li, Ge Chang, Shanhui Zhao, Jiacheng Liu, Yunxin Liu, Ya-Qin Zhang, and Yuanchun Li. 2025. AutoDroid-V2: Boosting SLM-based GUI Agents via Code Generation. Association for Computing Machinery, New York, NY, USA, 223-235. </span><a href='https://doi.org/10.1145/3711875.3729134' target='_blank' class='url'>https://doi.org/10.1145/3711875.3729134</a>
<span>[41] Hao Wen、Shizuo Tian、Borislav Pavlov、Wenjie Du、Yixuan Li、Ge Chang、Shanhui Zhao、Jiacheng Liu、Yunxin Liu、Ya-Qin Zhang、Yuanchun Li。2025。AutoDroid-V2：通过代码生成提升基于SLM的GUI代理。计算机协会，纽约，美国，223-235。</span><a href='https://doi.org/10.1145/3711875.3729134' target='_blank' class='url'>https://doi.org/10.1145/3711875.3729134</a></p><p><span>[42] Zhiyong Wu, Chengcheng Han, Zichen Ding, Zhenmin Weng, Zhoumi-anze Liu, Shunyu Yao, Tao Yu, and Lingpeng Kong. 2024. Os-copilot: Towards generalist computer agents with self-improvement. arXiv preprint arXiv:2402.07456 (2024).</span>
<span>[42] Zhiyong Wu, Chengcheng Han, Zichen Ding, Zhenmin Weng, Zhoumi-anze Liu, Shunyu Yao, Tao Yu, and Lingpeng Kong. 2024. Os-copilot: Towards generalist computer agents with self-improvement. arXiv preprint arXiv:2402.07456 (2024).</span></p><p><span>[43] Zhiyong Wu, Zhenyu Wu, Fangzhi Xu, Yian Wang, Qiushi Sun, Chengyou Jia, Kanzhi Cheng, Zichen Ding, Liheng Chen, Paul Pu Liang, et al. 2024. OS-ATLAS: A Foundation Action Model for Generalist GUI Agents. arXiv preprint arXiv:2410.23218 (2024).</span>
<span>[43] Zhiyong Wu, Zhenyu Wu, Fangzhi Xu, Yian Wang, Qiushi Sun, Chengyou Jia, Kanzhi Cheng, Zichen Ding, Liheng Chen, Paul Pu Liang, 等。 2024。OS-ATLAS：面向通用GUI代理的基础行动模型。 arXiv 预印本 arXiv:2410.23218 (2024)。</span></p><p><span>[44] Jiajun Xu, Zhiyuan Li, Wei Chen, Qun Wang, Xin Gao, Qi Cai, and Ziyuan Ling. 2024. On-device language models: A comprehensive review. arXiv preprint arXiv:2409.00088 (2024).</span>
<span>[44] Jiajun Xu, Zhiyuan Li, Wei Chen, Qun Wang, Xin Gao, Qi Cai, and Ziyuan Ling. 2024. On-device language models: A comprehensive review. arXiv preprint arXiv:2409.00088 (2024).</span></p><p><span>[45] Yifan Xu, Xiao Liu, Xinghan Liu, Jiaqi Fu, Hanchen Zhang, Bohao Jing, Shudan Zhang, Yuting Wang, Wenyi Zhao, and Yuxiao Dong. 2025. MobileRL: Online Agentic Reinforcement Learning for Mobile GUI Agents. arXiv preprint arXiv:2509.18119 (2025).</span>
<span>[45] Yifan Xu, Xiao Liu, Xinghan Liu, Jiaqi Fu, Hanchen Zhang, Bohao Jing, Shudan Zhang, Yuting Wang, Wenyi Zhao, and Yuxiao Dong. 2025. MobileRL: Online Agentic Reinforcement Learning for Mobile GUI Agents. arXiv preprint arXiv:2509.18119 (2025).</span></p><p><span>[46] Yifan Xu, Xiao Liu, Xueqiao Sun, Siyi Cheng, Hao Yu, Hanyu Lai, Shudan Zhang, Dan Zhang, Jie Tang, and Yuxiao Dong. 2024. Android-Lab: Training and Systematic Benchmarking of Android Autonomous Agents. arXiv:2410.24024 [cs.AI] </span><a href='https://arxiv.org/abs/2410.24024' target='_blank' class='url'>https://arxiv.org/abs/2410.24024</a>
<span>[46] Yifan Xu, Xiao Liu, Xueqiao Sun, Siyi Cheng, Hao Yu, Hanyu Lai, Shudan Zhang, Dan Zhang, Jie Tang, and Yuxiao Dong. 2024. Android-Lab: Training and Systematic Benchmarking of Android Autonomous Agents. arXiv:2410.24024 [cs.AI] </span><a href='https://arxiv.org/abs/2410.24024' target='_blank' class='url'>https://arxiv.org/abs/2410.24024</a></p><p><span>[47] An Yan, Zhengyuan Yang, Wanrong Zhu, Kevin Lin, Linjie Li, Jianfeng Wang, Jianwei Yang, Yiwu Zhong, Julian McAuley, Jianfeng Gao, et al. 2023. GPT-4V in Wonderland: Large Multimodal Models for Zero-Shot Smartphone GUI Navigation. arXiv preprint arXiv:2311.07562 (2023).</span>
<span>[47] An Yan, Zhengyuan Yang, Wanrong Zhu, Kevin Lin, Linjie Li, Jianfeng Wang, Jianwei Yang, Yiwu Zhong, Julian McAuley, Jianfeng Gao, 等. 2023. GPT-4V in Wonderland: Large Multimodal Models for Zero-Shot Smartphone GUI Navigation. arXiv 预印本 arXiv:2311.07562 (2023).</span></p><p><span>[48] Shunyu Yao, Dian Yu, Jeffrey Zhao, Izhak Shafran, Thomas L. Griffiths, Yuan Cao, and Karthik Narasimhan. 2023. Tree of Thoughts: Deliberate Problem Solving with Large Language Models. arXiv:2305.10601 [cs.CL]</span>
<span>[48] Shunyu Yao, Dian Yu, Jeffrey Zhao, Izhak Shafran, Thomas L. Griffiths, Yuan Cao, and Karthik Narasimhan. 2023. Tree of Thoughts: Deliberate Problem Solving with Large Language Models. arXiv:2305.10601 [cs.CL]</span></p><p><span>[49] Jiabo Ye, Xi Zhang, Haiyang Xu, Haowei Liu, Junyang Wang, Zhao-qing Zhu, Ziwei Zheng, Feiyu Gao, Junjie Cao, Zhengxi Lu, et al. 2025. Mobile-agent-v3: Fundamental agents for gui automation. arXiv preprint arXiv:2508.15144 (2025).</span>
<span>[49] Jiabo Ye, Xi Zhang, Haiyang Xu, Haowei Liu, Junyang Wang, Zhao-qing Zhu, Ziwei Zheng, Feiyu Gao, Junjie Cao, Zhengxi Lu, et al. 2025. Mobile-agent-v3: Fundamental agents for gui automation. arXiv 预印本 arXiv:2508.15144 (2025).</span></p><p><span>[50] Chaoyun Zhang, Liqun Li, Shilin He, Xu Zhang, Bo Qiao, Si Qin, Minghua Ma, Yu Kang, Qingwei Lin, Saravan Rajmohan, Dongmei Zhang, and Qi Zhang. 2024. UFO: A UI-Focused Agent for Windows OS Interaction. arXiv preprint arXiv:2402.07939 (2024).</span>
<span>[50] Chaoyun Zhang, Liqun Li, Shilin He, Xu Zhang, Bo Qiao, Si Qin, Minghua Ma, Yu Kang, Qingwei Lin, Saravan Rajmohan, Dongmei Zhang, and Qi Zhang. 2024. UFO: A UI-Focused Agent for Windows OS Interaction. arXiv 预印本 arXiv:2402.07939 (2024).</span></p><p><span>[51] Chi Zhang, Zhao Yang, Jiaxuan Liu, Yucheng Han, Xin Chen, Zebiao Huang, Bin Fu, and Gang Yu. 2023. AppAgent: Multimodal Agents as Smartphone Users. arXiv:2312.13771 [cs.CV]</span>
<span>[51] Chi Zhang, Zhao Yang, Jiaxuan Liu, Yucheng Han, Xin Chen, Zebiao Huang, Bin Fu, and Gang Yu. 2023. AppAgent: Multimodal Agents as Smartphone Users. arXiv:2312.13771 [cs.CV]</span></p><p><span>[52] Zhenyu Zhang, Tianyi Chen, Weiran Xu, Alex Pentland, and Jiaxin Pei. 2025. ReCAP: Recursive Context-Aware Reasoning and Planning for Large Language Model Agents. In Conference on Neural Information Processing Systems (NeurIPS).</span>
<span>[52] Zhenyu Zhang, Tianyi Chen, Weiran Xu, Alex Pentland, and Jiaxin Pei. 2025. ReCAP: Recursive Context-Aware Reasoning and Planning for Large Language Model Agents. In Conference on Neural Information Processing Systems (NeurIPS).</span></p><p><span>[53] Zhuosheng Zhang and Aston Zhang. 2024. You Only Look at Screens: Multimodal Chain-of-Action Agents. In Findings of the Association for Computational Linguistics: ACL 2024, Lun-Wei Ku, Andre Martins, and Vivek Srikumar (Eds.). Association for Computational Linguistics, Bangkok, Thailand, 3132-3149. doi:10.18653/v1/2024.findings-acl.186</span>
<span>[53] Zhuosheng Zhang and Aston Zhang. 2024. You Only Look at Screens: Multimodal Chain-of-Action Agents. In Findings of the Association for Computational Linguistics: ACL 2024, Lun-Wei Ku, Andre Martins, and Vivek Srikumar (Eds.). Association for Computational Linguistics, Bangkok, Thailand, 3132-3149. doi:10.18653/v1/2024.findings-acl.186</span></p><p><span>[54] Boyuan Zheng, Boyu Gou, Jihyung Kil, Huan Sun, and Yu Su. 2024. GPT-4V(ision) is a Generalist Web Agent, if Grounded. In Forty-first International Conference on Machine Learning (ICML&#39;24). https:// openreview.net/forum?id=piecKJ2DlB</span>
<span>[54] Boyuan Zheng, Boyu Gou, Jihyung Kil, Huan Sun, and Yu Su. 2024. GPT-4V(ision) is a Generalist Web Agent, if Grounded. In Forty-first International Conference on Machine Learning (ICML&#39;24). https:// openreview.net/forum?id=piecKJ2DlB</span></p><p><span>[55] Zijian Zhou, Ao Qu, Zhaoxuan Wu, Sunghwan Kim, Alok Prakash, Daniela Rus, Jinhua Zhao, Bryan Kian Hsiang Low, and Paul Pu Liang. 2025. MEM1: Learning to Synergize Memory and Reasoning for Efficient Long-Horizon Agents. </span><a href='https://arxiv.org/abs/2506.15841' target='_blank' class='url'>https://arxiv.org/abs/2506.15841</a>
<span>[55] Zijian Zhou, Ao Qu, Zhaoxuan Wu, Sunghwan Kim, Alok Prakash, Daniela Rus, Jinhua Zhao, Bryan Kian Hsiang Low, and Paul Pu Liang. 2025. MEM1: Learning to Synergize Memory and Reasoning for Efficient Long-Horizon Agents. </span><a href='https://arxiv.org/abs/2506.15841' target='_blank' class='url'>https://arxiv.org/abs/2506.15841</a></p><h2 id='a-syntax-of-semantic-task-program'><span>A Syntax of Semantic Task Program</span></h2><h2 id='a-syntax-of-semantic-task-program-2'><span>A Syntax of Semantic Task Program</span></h2><p><span>The syntax of Semantic Task Program (STP) is designed to resolve the conflict between the need for structural rigor in workflows and the inherent ambiguity of agent tasks. While Semantic Task Program adopts a natural-language-style appearance to ensure expressiveness, it is fundamentally a structured language. It imposes a rigid skeleton of control flow (loops, conditionals, functions) to maintain logical consistency, while allowing the atomic instructions within that skeleton to remain &quot;soft&quot; and flexible.</span>
<span>语义任务程序（STP）的语法旨在解决工作流对结构化严格性需求与任务本质模糊性之间的冲突。尽管语义任务程序采用自然语言风格以确保表达性，但它本质上是一种结构化语言。它对控制流（循环、条件、函数）施加刚性骨架以维护逻辑一致性，同时允许骨架内的原子指令保持“柔性”和灵活。</span></p><p><span>This design philosophy differs from traditional coding, which demands precision everywhere, and prompt engineering, which lacks structural constraints. Semantic Task Program allows developers to be precise about procedure (e.g., &quot;iterate exactly 10 times&quot;) while being fuzzy about implementation (e.g. , &quot;extract the sentiment&quot;). This section outlines how Semantic Task Program implements this hybrid approach.</span>
<span>这种设计理念不同于要求处处精确的传统编程，也不同于缺乏结构约束的提示工程。语义任务程序允许开发者在过程上保持精确（例如“精确迭代 10 次”），同时在实现上保持模糊（如“提取情感”）。本节概述了语义任务程序如何实现这种混合方法。</span></p><h3 id='a1-basic-statements-and-comments'><span>A.1 Basic Statements and Comments</span></h3><h3 id='a1-基本语句与注释'><span>A.1 基本语句与注释</span></h3><p><span>Semantic Task Program adopts an intent-based programming style. Instructions are written as imperative or declarative sentences that prioritize conveying the user&#39;s goal over adhering to strict syntactic rules.</span>
<span>语义任务程序采用基于意图的编程风格。指令以祈使句或陈述句书写，优先传达用户目标，而非严格遵守句法规则。</span></p><hr /><p>&nbsp;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;<span>#This is a comment, used for human-readable annotations.</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span>#这是一个注释，用于对人类可读的标注。</span></p><p>&nbsp;&nbsp;&nbsp;&nbsp;<span>tell user &quot;Hello, world!&quot; # Inline comments are also supported.</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span>告诉用户 &quot;Hello, world!&quot; # 行内注释也受支持。</span></p><p><span>#The following statements are also valid:</span>
<span>#以下语句也是有效的：</span></p><p>&nbsp;&nbsp;&nbsp;&nbsp;<span>send &quot;Hello, world!&quot; to the user</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span>发送 &quot;Hello, world!&quot; 给用户</span></p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>notify user with message &quot;Hello, world!&quot;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>用消息 &quot;Hello, world!&quot; 通知用户</span></p><p><span>send a greeting message to user</span>
<span>向用户发送问候消息</span></p><hr /><p>&nbsp;</p><p><span>Comments are ignored by the AgentProg and serve only to document the code. Statements like tell user &quot;...&quot; are direct commands that are translated into actions. For familiarity, Semantic Task Program also permits Python-style syntax where appropriate (e.g., print(&quot;Hello, world!&quot;)), which the AgentProg processes as an equivalent intent rather than executing directly.</span>
<span>注释由 AgentProg 忽略，仅用于文档化代码。像 tell user &quot;...&quot; 这样的语句是直接命令，会被翻译为动作。为便于使用，Semantic Task Program 也在合适位置允许 Python 风格的语法（例如 print(&quot;Hello, world!&quot;)），AgentProg 将其作为等效意图处理而不是直接执行。</span></p><h3 id='a2-variables-and-data-management'><span>A.2 Variables and Data Management</span></h3><h3 id='a2-变量与数据管理'><span>A.2 变量与数据管理</span></h3><p><span>In agentic workflows, data is often unstructured (e.g., natural text, web content) and does not fit neatly into the rigid types of C++ or Java. Semantic Task Program addresses this by treating variables as named containers for information, explicitly demarcated by curly braces </span><span>{</span><span>}</span><span> (e.g., </span><span>{</span><span>userName</span><span>}</span><span>). This notation serves a dual purpose: it provides a clear anchor for the AgentProg to track state within a fuzzy instruction, and it allows the language to handle unstructured data without requiring complex schema definitions upfront.</span>
<span>在代理工作流中，数据往往是非结构化的（如自然文本、网页内容），并不适合直接套入 C++ 或 Java 的严格类型。Semantic Task Program 通过将变量视为信息的命名容器来解决此问题，变量由大括号 {} 明确定界（如 {userName}）。此记号具有双重用途：它为 AgentProg 在模糊指令中跟踪状态提供清晰锚点，并且允许该语言在不事先定义复杂模式的情况下处理非结构化数据。</span></p><p><span>Declaration and Assignment: Variables are declared implicitly upon their first assignment. Semantic Task Program supports multiple natural phrasings for assignment, treating them as synonyms.</span>
<span>声明与赋值：变量在首次赋值时隐式声明。Semantic Task Program 支持多种自然表述的赋值方式，视为同义。</span></p><hr /><p>&nbsp;</p><p><span>set variable </span><span>{</span><span>userName</span><span>}</span><span> to &quot;Alice&quot;</span>
<span>set variable {userName} to &quot;Alice&quot;</span></p><p>&nbsp;&nbsp;&nbsp;&nbsp;<span>store 100 into </span><span>{</span><span>initialScore</span><span>}</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span>store 100 into {initialScore}</span></p><p><span>set </span><span>{</span><span>userCount</span><span>}</span><span> to 0 # Python-style assignment is also valid.</span>
<span>set {userCount} to 0 # Python风格的赋值也有效。</span></p><hr /><p>&nbsp;</p><p><span>Using Variables: To reference a variable&#39;s value, simply include its braced name within a statement. The AgentProg substitutes it with its current value during execution.</span>
<span>使用变量：要引用变量的值，只需在语句中包含带大括号的变量名。在执行时，AgentProg 将其替换为当前值。</span></p><hr /><p>&nbsp;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;<span>tell user &quot;Welcome, </span><span>{</span><span>userName</span><span>}</span><span>! Your score is </span><span>{</span><span>initialScore</span><span>}</span><span>.&quot;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span>告诉用户 &quot;欢迎，{userName}！你的分数是 {initialScore}。&quot;</span></p><p><span>calculate </span><span>{</span><span>initialScore</span><span>}</span><span> + 50, record as </span><span>{</span><span>finalScore</span><span>}</span>
<span>计算 </span><span>{</span><span>initialScore</span><span>}</span><span> + 50，记录为 </span><span>{</span><span>finalScore</span><span>}</span></p><hr /><p>&nbsp;</p><p><span>Dynamic Type System: Semantic Task Program employs a dynamic type system where users are not required to declare types explicitly. The AgentProg infers and manages types-such as Text, Number, Boolean, List, and Object-based on context and value. This approach aligns with the needs of both novice programmers and LLMs, which may struggle with strict static typing. While types are inferred, users can provide hints to guide the interpreter, for instance, when interacting with an AI model.</span>
<span>动态类型系统：语义任务程序采用动态类型系统，用户无需显式声明类型。AgentProg 根据上下文和数值推断并管理文本、数字、布尔、列表与对象等类型。这种方法符合新手程序员和可能在严格静态类型下挣扎的大模型的需求。尽管类型会被推断，用户仍可提供提示以引导解释器，例如在与 AI 模型交互时。</span></p><ul><li><p><span>List: An ordered collection.</span></p></li><li><p><span>列表：有序集合。</span></p></li></ul><hr /><p>&nbsp;</p><p><span>record list &quot;apples&quot;, &quot;bananas&quot;, &quot;cherries&quot; as </span><span>{</span><span>fruitBasket</span><span>}</span>
<span>将列表 &quot;apples&quot;、&quot;bananas&quot;、&quot;cherries&quot; 记录为 </span><span>{</span><span>fruitBasket</span><span>}</span></p><hr /><p>&nbsp;</p><ul><li><p><span>Object: A key-value store, akin to a dictionary or JSON object. Properties can be accessed using dot notation (</span><span>{</span><span>product.price</span><span>}</span><span>) or possessive phrasing (</span><span>{</span><span>myCar&#39;s color</span><span>}</span><span>).</span></p></li><li><p><span>对象：键值存储，类似字典或 JSON 对象。属性可以使用点表示法 (</span><span>{</span><span>product.price</span><span>}</span><span>) 或所有格表达 (</span><span>{</span><span>myCar&#39;s color</span><span>}</span><span>) 访问。</span></p></li></ul><hr /><p>&nbsp;</p><p><span>create an object </span><span>{</span><span>product</span><span>}</span><span> with &quot;name&quot; as &quot;Laptop&quot; and &quot;price</span>
<span>创建一个对象 </span><span>{</span><span>product</span><span>}</span><span>，其 &quot;name&quot; 为 &quot;Laptop&quot; 且 &quot;price</span></p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>&quot; as 1200</span></p><p>&nbsp;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;<span>tell user &quot;</span><span>{</span><span>product.name</span><span>}</span><span> is available for </span><span>{</span><span>product.price</span><span>}</span><span>.&quot;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span>告诉用户 &quot;</span><span>{</span><span>product.name</span><span>}</span><span> 可用，价格为 </span><span>{</span><span>product.price</span><span>}</span><span>。&quot;</span></p><hr /><p>&nbsp;</p><ul><li><p><span>Table: A structured list of objects, ideal for representing tabular data.</span></p></li><li><p><span>表：一个结构化的对象列表，适合表示表格数据。</span></p></li></ul><hr /><p>&nbsp;</p><p><span>read table &quot;sales_data.csv&quot; as </span><span>{</span><span>salesReport</span><span>}</span>
<span>将表 read table &quot;sales_data.csv&quot; 为 </span><span>{</span><span>salesReport</span><span>}</span></p><hr /><p>&nbsp;</p><p><span>Crucially, the AgentProg handles potential type mismatches intelligently. Instead of crashing, it attempts a reasonable type coercion (e.g., converting the text &quot;123&quot; to a number) or reports a descriptive, human-understandable issue.</span>
<span>至关重要的是，AgentProg 会聪明地处理潜在的类型不匹配。它不会崩溃，而是尝试合理的类型强制转换（例如将文本 &quot;123&quot; 转换为数字），或给出描述性、可理解的问题报告。</span></p><h3 id='a3-control-flow'><span>A.3 Control Flow</span></h3><h3 id='a3-控制流'><span>A.3 控制流</span></h3><p><span>Control flow structures in Semantic Task Program use natural language keywords and rely on indentation to define code blocks, similar to Python. This maintains readability while avoiding complex bracketing.</span>
<span>语义任务程序中的控制流结构使用自然语言关键字并依靠缩进来定义代码块，类似于 Python。这在保持可读性的同时，避免了复杂的括号嵌套。</span></p><p><span>Conditional Statements: if, else, else if structures evaluate conditions expressed in natural language or with standard operators.</span>
<span>条件语句：if、else、else if 结构以自然语言表达或使用标准运算符评估条件。</span></p><hr /><p>&nbsp;</p><p><span>ask user &quot;Enter your age:&quot;, get response as </span><span>{</span><span>ageInput</span><span>}</span>
<span>向用户提问 &quot;Enter your age:&quot;，将响应作为 </span><span>{</span><span>ageInput</span><span>}</span><span> 获取</span></p><p><span>convert </span><span>{</span><span>ageInput</span><span>}</span><span> to number, as </span><span>{</span><span>userAge</span><span>}</span>
<span>将 </span><span>{</span><span>ageInput</span><span>}</span><span> 转换为数字，作为 </span><span>{</span><span>userAge</span><span>}</span></p><p><span>if </span><span>{</span><span>userAge</span><span>}</span><span> &lt; 18:</span>
<span>若 </span><span>{</span><span>userAge</span><span>}</span><span> &lt; 18：</span></p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>tell user &quot;You are a minor.&quot;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>tell user &quot;你是未成年人。&quot;</span></p><p><span>else, if </span><span>{</span><span>userAge</span><span>}</span><span> is between 18 and 65: # Natural language</span>
<span>否则，如果 {userAge} 在 18 到 65 之间： # 自然语言</span></p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>condition allowed</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>条件允许</span></p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>tell user &quot;You are an adult.&quot;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>tell user &quot;你是成年人。&quot;</span></p><p><span>else:</span>
<span>else:</span></p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>tell user &quot;You are a senior citizen.&quot;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>tell user &quot;你是老年人。&quot;</span></p><hr /><p>&nbsp;</p><p><span>Loops: Semantic Task Program supports various loop constructs, each initiated with flexible, descriptive phrasing.</span>
<span>Loops: 语义任务程序支持多种循环结构，每种都以灵活、描述性的措辞启动。</span></p><ul><li><p><span>Fixed Repetitions:</span></p></li><li><p><span>固定重复：</span></p></li></ul><hr /><p>&nbsp;</p><p><span>repeat 5 times:</span>
<span>repeat 5 times:</span></p><p>&nbsp;&nbsp;&nbsp;&nbsp;<span>#</span><span>{</span><span>loop.iteration</span><span>}</span><span> is a special variable (1-indexed)</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span>#{loop.iteration} 是一个特殊变量（1 代表第一轮）</span></p><p>&nbsp;&nbsp;&nbsp;&nbsp;<span>tell user &quot;This is message number </span><span>{</span><span>loop.iteration</span><span>}</span><span>&quot;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span>tell user &quot;这是第 {loop.iteration} 条消息&quot;</span></p><hr /><p>&nbsp;</p><ul><li><p><span>Iterating over Collections:</span></p></li><li><p><span>遍历集合：</span></p></li></ul><hr /><p>&nbsp;</p><p><span>iterate through each item in </span><span>{</span><span>fruitBasket</span><span>}</span><span> as </span><span>{</span><span>fruit</span><span>}</span><span>:</span>
<span>iterate through each item in {fruitBasket} as {fruit}:</span></p><p>&nbsp;&nbsp;&nbsp;&nbsp;<span>tell user &quot;Found fruit: </span><span>{</span><span>fruit</span><span>}</span><span>&quot;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span>tell user &quot;发现水果：{fruit}&quot;</span></p><hr /><p>&nbsp;</p><ul><li><p><span>Conditional Loops:</span></p></li><li><p><span>条件循环：</span></p></li></ul><hr /><p>&nbsp;</p><p><span>while </span><span>{</span><span>systemStatus</span><span>}</span><span> is &quot;active&quot;:</span>
<span>while {systemStatus} is &quot;active&quot;:</span></p><p>&nbsp;&nbsp;&nbsp;&nbsp;<span>check for new messages</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span>检查新消息</span></p><p>&nbsp;&nbsp;&nbsp;&nbsp;<span>wait 10 seconds</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span>等待 10 秒</span></p><hr /><p>&nbsp;</p><h3 id='a4-functions'><span>A.4 Functions</span></h3><h3 id='a4-函数'><span>A.4 函数</span></h3><p><span>To promote modularity and code reuse, Semantic Task Program allows users to define reusable blocks of logic as functions.</span>
<span>为促进模块性和代码重用，语义任务程序允许用户将可重用的逻辑块定义为函数。</span></p><p><span>Defining a Function: A function is defined with a name, a list of expected inputs (parameters), and a body of instructions.</span>
<span>定义一个函数：函数通过名称、期望输入列表（参数）和一组指令体来定义。</span></p><hr /><p>&nbsp;</p><p><span>define function named &quot;calculateArea&quot;:</span>
<span>定义名为 &quot;calculateArea&quot; 的函数：</span></p><p>&nbsp;&nbsp;&nbsp;&nbsp;<span>function inputs: </span><span>{</span><span>length</span><span>}</span><span> (number), </span><span>{</span><span>width</span><span>}</span><span> (number)</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span>函数输入：{length}（数字）、{width}（数字）</span></p><p>&nbsp;&nbsp;&nbsp;&nbsp;<span>calculate </span><span>{</span><span>length</span><span>}</span><span> * </span><span>{</span><span>width</span><span>}</span><span>, record as </span><span>{</span><span>area</span><span>}</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span>计算 </span><span>{</span><span>length</span><span>}</span><span> * </span><span>{</span><span>width</span><span>}</span><span>，将结果记为 </span><span>{</span><span>area</span><span>}</span></p><p>&nbsp;&nbsp;&nbsp;&nbsp;<span>function returns </span><span>{</span><span>area</span><span>}</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span>函数返回 </span><span>{</span><span>area</span><span>}</span></p><hr /><p>&nbsp;</p><p><span>Executing a Function: Functions are called by name, with arguments passed using a clear key-value format.</span>
<span>执行函数：通过名称调用函数，参数使用清晰的键值对格式传递。</span></p><hr /><p>&nbsp;</p><p><span>execute function &quot;calculateArea&quot;, with </span><span>{</span><span>length</span><span>}</span><span> as 10 and </span><span>{</span><span>width</span><span>}</span><span> as</span>
<span>执行函数 &quot;calculateArea&quot;，将 {length} 设为 10，{width} 设为</span></p><p>&nbsp;&nbsp;&nbsp;&nbsp;<span>5, save result as </span><span>{</span><span>roomArea</span><span>}</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span>5，将结果保存在 </span><span>{</span><span>roomArea</span><span>}</span></p><p><span>tell user &quot;The room area is </span><span>{</span><span>roomArea</span><span>}</span><span> square units.&quot;</span>
<span>告诉用户 &quot;房间面积是 </span><span>{</span><span>roomArea</span><span>}</span><span> 平方单位。&quot;</span></p><hr /><p>&nbsp;</p><h3 id='a5-interactions-with-external-tools'><span>A.5 Interactions with External Tools</span></h3><h3 id='a5-与外部工具的交互'><span>A.5 与外部工具的交互</span></h3><p><span>A cornerstone of Semantic Task Program is its native ability to interact with the broader digital environment, including AI models and external tools, through high-level, declarative commands.</span>
<span>语义任务程序的一个基石是其原生能力，通过高级、声明性命令与更广泛的数字环境（包括 AI 模型和外部工具）进行交互。</span></p><p><span>Tool Use (File System, Browser, Devices): Semantic Task Program provides a unified, high-level interface for common tool interactions. This design allows users to specify </span><em><span>what</span></em><span> they want to achieve, leaving the </span><em><span>how</span></em><span> to the AgentProg.</span>
<span>工具使用（文件系统、浏览器、设备）：语义任务程序提供统一的高级接口，用于常见的工具交互。这样的设计让用户明确要达到的目标，将实现方式留给 AgentProg。</span></p><hr /><p>&nbsp;</p><p><span>#File System</span>
<span>#文件系统</span></p><p><span>read text from file &quot;config.txt&quot; as </span><span>{</span><span>configContent</span><span>}</span>
<span>从配置文件 config.txt 读取文本为 </span><span>{</span><span>configContent</span><span>}</span></p><p><span>save </span><span>{</span><span>summary</span><span>}</span><span> to file &quot;summary.txt&quot;</span>
<span>将 </span><span>{</span><span>summary</span><span>}</span><span> 保存到文件 &quot;summary.txt&quot;</span></p><p><span>#Web Browser Automation</span>
<span>#网页浏览器自动化</span></p><p><span>execute on device &quot;MainBrowser&quot;:</span>
<span>在设备 &quot;MainBrowser&quot; 上执行：</span></p><p>&nbsp;&nbsp;&nbsp;&nbsp;<span>open URL &quot;</span><a href='https://en.wikipedia.org' target='_blank' class='url'>https://en.wikipedia.org</a><span>&quot;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span>打开 URL &quot;</span><a href='https://en.wikipedia.org' target='_blank' class='url'>https://en.wikipedia.org</a><span>&quot;</span></p><p>&nbsp;&nbsp;&nbsp;&nbsp;<span>search &quot;Hello World&quot;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span>搜索 &quot;Hello World&quot;</span></p><p>&nbsp;&nbsp;&nbsp;&nbsp;<span>wait for page to load</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span>等待页面加载</span></p><p>&nbsp;&nbsp;&nbsp;&nbsp;<span>get current page content as </span><span>{</span><span>wikiPageContent</span><span>}</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span>获取当前页面内容作为 </span><span>{</span><span>wikiPageContent</span><span>}</span></p><hr /><p>&nbsp;</p><p><span>The AgentProg&#39;s context-aware nature is critical here. It resolves ambiguous references like &quot;search input&quot; or &quot;Search button&quot; by analyzing the current state of the web page (its DOM structure and visual layout), making automation scripts more robust and less brittle.</span>
<span>AgentProg 的上下文感知特性在此至关重要。它通过分析当前网页的状态（其 DOM 结构和可视布局）来解析诸如 &quot;搜索输入框&quot; 或 &quot;搜索按钮&quot; 等模糊引用，从而使自动化脚本更健壮、 menos 易碎。</span></p></div></div>

<script>(function(){function e(e,n,i){document.addEventListener(e,function(e){if(!e.defaultPrevented)for(var t=e.target;t&&t!=this;t=t.parentNode)if(t.matches(n)){!1===i.call(t,e)&&(e.preventDefault(),e.stopPropagation());break}},!1)}var t=document.body.parentElement,i=[],r=null,o=document.body.classList.contains("typora-export-collapse-outline");function a(){return t.scrollTop}e("click",".outline-expander",function(e){var t=this.closest(".outline-item-wrapper").classList;return t.contains("outline-item-open")?t.remove("outline-item-open"):t.add("outline-item-open"),u(),!1}),e("click",".outline-item",function(e){var t=this.querySelector(".outline-label");location.hash="#"+t.getAttribute("href"),o&&((t=this.closest(".outline-item-wrapper").classList).contains("outline-item-open")||t.add("outline-item-open"),d(),t.add("outline-item-active"))});function s(){var e=a();r=null;for(var t=0;t<i.length&&i[t][1]-e<60;t++)r=i[t]}function n(){c=setTimeout(function(){var n;i=[],n=a(),document.querySelector("#write").querySelectorAll("h1, h2, h3, h4, h5, h6").forEach(e=>{var t=e.getAttribute("id");i.push([t,n+e.getBoundingClientRect().y])}),s(),u()},300)}var l,c,d=function(){document.querySelectorAll(".outline-item-active").forEach(e=>e.classList.remove("outline-item-active")),document.querySelectorAll(".outline-item-single.outline-item-open").forEach(e=>e.classList.remove("outline-item-open"))},u=function(){if(r&&(d(),t=document.querySelector('.outline-label[href="#'+(CSS.escape?CSS.escape(r[0]):r[0])+'"]')))if(o){var e=t.closest(".outline-item-open>ul>.outline-item-wrapper");if(e)e.classList.add("outline-item-active");else{for(var t,n=(t=t.closest(".outline-item-wrapper")).parentElement.closest(".outline-item-wrapper");n;)n=(t=n).parentElement.closest(".outline-item-wrapper");t.classList.add("outline-item-active")}}else t.closest(".outline-item-wrapper").classList.add("outline-item-active")};window.addEventListener("scroll",function(e){l&&clearTimeout(l),l=setTimeout(function(){s(),u()},300)});window.addEventListener("resize",function(e){c&&clearTimeout(c),n()}),n()})();</script><style>
/* ===== Typora Enhancer (safe-only hotkeys + tiny tools tab + light progress info + gallery non-overlap) ===== */

/* 顶部阅读进度条 */
#ty-progress {
  position: fixed; z-index: 9999; top: 0; left: 0; height: 3px; width: 100%;
  background: linear-gradient(to right, #4da3ff, #7c4dff);
  transform-origin: 0 50%; transform: scaleX(0); pointer-events: none;
}
/* 进度信息：仅 百分比 / 已读时间（弱遮挡 + 不拦截鼠标） */
#ty-progress-info{
  position: fixed; top: 6px; right: 6px; z-index: 10000;
  font: 12px/1.4 system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;
  color:#fff; background: rgba(0,0,0,.25);
  padding: 2px 6px; border-radius: 7px; backdrop-filter: saturate(120%) blur(1.5px);
  user-select: none; pointer-events: none;
}
#ty-progress-info b{ font-weight:600 }

/* 右下功能栏 */
#ty-tools {
  position: fixed; z-index: 9999; right: 18px; bottom: 24px; display: flex; gap: 10px; flex-direction: column;
  font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  transition: transform .25s ease, opacity .2s ease;
}
.ty-btn {
  background: rgba(0,0,0,.7); color: #fff; border-radius: 10px; padding: 8px 10px;
  font-size: 12px; cursor: pointer; user-select: none; backdrop-filter: saturate(120%) blur(2px);
  transition: transform .15s ease, background .2s ease;
}
.ty-btn:hover { transform: translateY(-1px); background: rgba(0,0,0,.82); }
.ty-btn[hidden] { display: none !important; }

/* 工具栏内的收起按钮（纯图标、很小） */
#ty-tools .ty-mini{
  width: 26px; height: 26px; padding: 0;
  border-radius: 50%;
  display: grid; place-items: center;
  font-size: 16px; line-height: 1;
}

/* 工具栏收起时隐藏，仅保留“抽屉拉手” */
body.ty-tools-collapsed #ty-tools{ opacity:0; pointer-events:none; transform: translateX(18px); }

/* 抽屉拉手：超小、仅图标，避免与工具栏重叠（默认样式，保留普通浏览器的行为） */
#ty-tools-tab{
  --tab-size: 26px;
  position: fixed;
  right: 6px;
  bottom: 26px;
  z-index: 10001;
  width: var(--tab-size);
  height: var(--tab-size);
  display: grid;
  place-items: center;
  background: rgba(0,0,0,.65);
  color:#fff;
  font-size: 15px;
  border-radius: 50%;
  cursor: pointer;
  user-select: none;
  transition: background .2s ease, opacity .2s ease;
  backdrop-filter: saturate(120%) blur(2px);
  /* 不再使用 translateX 推出视口 */
  transform: none;
}
body:not(.ty-tools-collapsed) #ty-tools-tab{
  opacity: 0;
  pointer-events: none;
}
#ty-tools-tab:hover{ background: rgba(0,0,0,.8); }
#ty-tools-tab .ico{ line-height: 1; font-weight: 600; }

/* 防止微小水平溢出触发 WKWebView 的整页缩放（基础防线，不影响普通浏览器布局） */
html, body { overflow-x: hidden; }

/* 窄宽度时的基本降噪（保留你原有规则） */
@media (max-width: 720px){
  .typora-export-sidebar { display: none !important; }
  .outline,
  .outline-panel,
  .typora-export .sidebar { display: none !important; }
  #ty-progress-info{ display: none !important; }
}

/* 标题锚点（左侧“#”） */
#write h1,#write h2,#write h3,#write h4,#write h5,#write h6{ position:relative; }
.ty-anchor {
  position:absolute; left:-1.2em; top:50%; transform:translateY(-50%);
  opacity:0; text-decoration:none; color:#999; font-weight:600; font-size:.9em;
  padding:0 .2em; border-radius:4px;
}
#write h1:hover .ty-anchor,#write h2:hover .ty-anchor,#write h3:hover .ty-anchor,
#write h4:hover .ty-anchor,#write h5:hover .ty-anchor,#write h6:hover .ty-anchor{ opacity:1 }
@media (max-width:768px){ .ty-anchor{ left:auto; right:-.8em } }

/* 复制提示气泡 */
.ty-tip {
  position:absolute; left:-1.2em; top:0; transform: translate(-10%, -120%);
  background: rgba(0,0,0,.8); color: #fff; padding: 3px 8px; border-radius: 6px;
  font-size: 12px; white-space: nowrap; pointer-events: none; opacity: 0;
}
@media (max-width:768px){ .ty-tip{ left:auto; right:-.8em; transform: translate(10%,-120%) }}

/* 大纲高亮 */
.outline-content .active,
.outline-content .active > .outline-item,
.outline-content a.active { color: #2a72ff; }

/* 简单收起侧栏：仅隐藏 */
body.ty-outline-hidden .typora-export-sidebar{ display:none !important; }

/* ========= 图片灯箱（含左侧缩略条、非重叠布局） ========= */
#ty-lightbox {
  /* 预留左侧缩略条安全区，避免与大图/按钮重叠 */
  --lb-strip-w: 108px; /* 左侧缩略条宽度（含边距） */
  position: fixed; inset: 0; background: rgba(0,0,0,.92); display: none; z-index: 9998;
  padding-left: calc(var(--lb-strip-w) + 12px);
}
#ty-lightbox.open { display: flex; align-items: center; justify-content: center; }
.ty-lb-img { max-width: calc(92vw - var(--lb-strip-w)); max-height: 86vh; }
.ty-lb-cap { position: fixed; bottom: 64px; left: 50%; transform: translateX(-50%); color: #ddd; font-size: 13px; }

/* 画廊控制按钮（左箭头避开缩略条） */
.ty-lb-prev, .ty-lb-next, .ty-lb-close {
  position: fixed; top: 50%; transform: translateY(-50%);
  background: rgba(255,255,255,.12); color: #fff; border-radius: 50%; width: 40px; height: 40px;
  display: grid; place-items: center; font-size: 18px; cursor: pointer; user-select: none;
}
.ty-lb-prev:hover, .ty-lb-next:hover, .ty-lb-close:hover { background: rgba(255,255,255,.18); }
.ty-lb-prev { left: calc(var(--lb-strip-w) + 24px); }
.ty-lb-next { right: 24px; } 
.ty-lb-close { right: 24px; top: 24px; transform: none; }

/* 画廊顶部序号 */
#ty-lb-count{
  position: fixed; top: 14px; left: 50%; transform: translateX(-50%);
  color:#eee; background: rgba(0,0,0,.35); padding: 4px 10px;
  border-radius: 8px; font: 12px/1.3 system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;
}

/* 画廊底部动作区 */
#ty-lb-actions{
  position: fixed; bottom: 18px; left: 50%; transform: translateX(-50%);
  display: flex; gap: 10px; background: rgba(0,0,0,.35); padding: 8px 10px; border-radius: 12px;
}
.ty-act-btn{
  background: rgba(255,255,255,.16); color:#fff; border-radius: 8px; padding: 6px 10px;
  font-size: 12px; cursor: pointer; user-select: none; border: 1px solid rgba(255,255,255,.18);
}
.ty-act-btn:hover{ background: rgba(255,255,255,.22); }

/* 画廊左侧缩略图条（不与大图重叠） */
#ty-lb-strip{
  position: fixed; left: 12px; top: 50%; transform: translateY(-50%);
  display: flex; flex-direction: column; gap: 8px; max-height: 80vh; overflow: auto; padding-right: 4px;
  width: var(--lb-strip-w);
}
.ty-thumb{
  position: relative; width: 96px; height: 68px; object-fit: cover; border-radius: 6px;
  border: 1px solid rgba(255,255,255,.25); cursor: pointer; opacity: .9; background: #111;
}
.ty-thumb:hover{ opacity: 1; }
.ty-thumb.active{ outline: 2px solid #7c4dff; opacity: 1; }
.ty-thumb::after{
  content: attr(data-idx); position: absolute; left: 4px; top: 2px;
  font: 10px/1.1 system-ui,-apple-system,"Segoe UI"; background: rgba(0,0,0,.55); color:#fff;
  padding: 1px 4px; border-radius: 4px;
}

/* —— 快速帮助浮层 —— */
#ty-help-overlay{
  position: fixed; inset: 0; background: rgba(0,0,0,.55); display: none; z-index: 10000;
}
#ty-help-overlay.open{ display: flex; align-items: center; justify-content: center; }
.ty-help-dialog{
  position: relative; width: min(720px, 92vw); max-height: 84vh; overflow: auto;
  background: #fff; color: #222; border-radius: 12px; padding: 18px 20px;
  box-shadow: 0 12px 36px rgba(0,0,0,.25);
  font-family: system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;
}
.ty-help-dialog h3{ margin: 0 0 6px; font-size: 20px; }
.ty-help-dialog h4{ margin: 14px 0 6px; font-size: 15px; color: #444; }
.ty-help-dialog code, .ty-help-dialog kbd{
  background: #f4f6f8; border: 1px solid #e5e8eb; border-radius: 6px; padding: 2px 6px; font-size: 12px;
}
.ty-help-close{
  position: absolute; right: 10px; top: 8px; width: 34px; height: 34px;
  display: grid; place-items: center; border-radius: 8px; cursor: pointer;
  background: #f2f3f5; color: #444; font-size: 16px; user-select: none;
}
.ty-help-close:hover{ background: #e9eaee; }
.ty-help-grid{ display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
@media (max-width:680px){
  /* 小屏缩窄缩略条并自动适配左侧安全区 */
  #ty-lightbox{ --lb-strip-w: 80px; padding-left: calc(var(--lb-strip-w) + 8px); }
  .ty-thumb{ width: 72px; height: 52px; }
  .ty-lb-prev{ left: calc(var(--lb-strip-w) + 16px) }
}

/* —— 可视化注释（由 HTML 注释生成） —— */
.ty-cmt{
  display: inline-block; max-width: 100%;
  background: #fffbe6; border: 1px solid #ffe58f; color: #333;
  border-radius: 8px; padding: 4px 8px; margin: 2px 4px; vertical-align: baseline;
  font-size: 12px; line-height: 1.5; box-shadow: 0 1px 0 rgba(0,0,0,.03);
}
.ty-cmt::before{
  content: "注释"; font-weight: 600; color: #ad6800;
  margin-right: .5em; padding: 1px 6px; border-radius: 6px;
  background: #fff1b8; border: 1px solid #ffe58f;
}
body.ty-cmt-hidden .ty-cmt{ display: none !important; }

/* 文中图片跳回高亮动画（保留） */
@keyframes ty-img-flash{
  0%{ box-shadow: 0 0 0 0 rgba(124,77,255,.0) }
  50%{ box-shadow: 0 0 0 6px rgba(124,77,255,.3) }
  100%{ box-shadow: 0 0 0 0 rgba(124,77,255,0) }
}
.ty-img-flash{ animation: ty-img-flash 1.2s ease-out 1; border-radius: 6px; }

/* =========================
   === MN4 专用：仅在 WKWebView 且窄窗口时生效 ===
   （通过 <html>.mn4-narrow 进行作用域限制，避免影响普通浏览器）
   ========================= */

/* 1) WKWebView 禁止文字自动缩放 */
html.ty-wk{
  -webkit-text-size-adjust: 100%;
  text-size-adjust: 100%;
}

/* 2) MN4 窄窗：隐藏目录 + 进度信息 + 去除正文阴影/边框，仅在 mn4-narrow 生效 */
html.mn4-narrow .typora-export-sidebar,
html.mn4-narrow .outline,
html.mn4-narrow .outline-panel,
html.mn4-narrow .typora-export .sidebar{
  display: none !important;
}

html.mn4-narrow #ty-progress-info{
  display: none !important;
}

/* 去除正文容器两侧的阴影/边框（不影响普通浏览器，因为有作用域） */
html.mn4-narrow #write,
html.mn4-narrow .typora-export,
html.mn4-narrow .typora-export-content{
  box-shadow: none !important;
  border: none !important;
  max-width: 100% !important;
  margin: 0 auto !important;
}

/* 防止任何横向溢出导致整体缩放（仅在 mn4-narrow 下更激进） */
html.mn4-narrow body{ overflow-x: hidden !important; }
html.mn4-narrow #write img,
html.mn4-narrow #write table{ max-width: 100% !important; height: auto; }
html.mn4-narrow #write p,
html.mn4-narrow #write li,
html.mn4-narrow #write blockquote{ overflow-wrap: anywhere; word-break: break-word; }

/* 抽屉拉手在 MN4 下也绝不越界 */
html.mn4-narrow #ty-tools-tab{ right: 6px !important; bottom: 26px !important; transform: none !important; }

/* === MN4 窄窗字体修正（避免整页缩放）=== */
/* 关键：不要把 text-size-adjust 设成 >100%，否则 WKWebView 可能整页缩小 */
html.ty-wk.mn4-narrow{
  -webkit-text-size-adjust: 100% !important;
  text-size-adjust: 100% !important;
}

/* 用像素提升正文基准字号（不要用 pt），只在 MN4 窄窗生效 */
html.mn4-narrow #write{
  font-size: 12px !important;   /* 可改 16~18px 之间微调 */
  line-height: 1.25 !important;
}

/* 标题按比例微调，避免过大或过小 */
html.mn4-narrow #write h1{ font-size: 1.9em !important; }
html.mn4-narrow #write h2{ font-size: 1.6em !important; }
html.mn4-narrow #write h3{ font-size: 1.35em !important; }
html.mn4-narrow #write h4{ font-size: 1.15em !important; }

/* 避免“横向撑爆 → 触发整页缩放”：表格与代码块在窄窗必须自适应 */
html.mn4-narrow #write table{
  display: block;               /* 允许内滚动，阻断页面被迫缩放 */
  width: 100% !important;
  overflow-x: auto !important;
}

html.mn4-narrow #write .md-fences,
html.mn4-narrow #write pre{
  max-width: 100% !important;
  overflow-x: auto !important;  /* 保留等宽格式，用横向滚动而不是压缩页面 */
  white-space: pre;             /* 不强制换行，避免代码失真 */
  -webkit-overflow-scrolling: touch;
  font-size: 0.95em !important; /* 代码略微小一档，整体更协调 */
}

/* 数学公式轻微放大，避免相对变小 */
html.mn4-narrow .math,
html.mn4-narrow .md-math-block,
html.mn4-narrow .md-inline-math-container mjx-container{
  font-size: 1.04em !important;
}

/* MN4：全局水平留白，用一个变量统一调 */
html.mn4-narrow{ --mn4-pad-x: 11px; }   /* 你觉得还大就改 8px；还小就改 12px */

html.mn4-narrow body{ margin: 0 !important; } /* 清掉 iOS/Safari 的默认 8px 外边距 */

html.mn4-narrow .typora-export,
html.mn4-narrow .typora-export-content,
html.mn4-narrow #write{
  padding-left:  var(--mn4-pad-x) !important;
  padding-right: var(--mn4-pad-x) !important;
}

html.mn4-narrow .typora-export,
html.mn4-narrow .typora-export-content,
html.mn4-narrow #write{
  max-width: none !important;
  width: 100% !important;
}

</style>

<div id="ty-progress"></div>
<div id="ty-progress-info" aria-live="polite">进度 <b>0.0%</b> ｜ 已读 <b>00:00</b></div>

<!-- 工具栏抽屉拉手（仅图标，默认收起） -->
<div id="ty-tools-tab" title="展开工具栏">
  <span class="ico">≡</span>
</div>

<div id="ty-tools" aria-label="Page tools">

  <!-- 新增：收起按钮，图标 × -->
  <div class="ty-btn ty-mini" id="ty-tools-close" title="收起工具栏">×</div>

  <div class="ty-btn" id="ty-outline" title="收起/展开左侧大纲（O）">收起/展开大纲（O）</div>
  <div class="ty-btn" id="ty-top" title="回到顶部（T）">回到顶部（T）</div>
  <div class="ty-btn" id="ty-urlmode" title="切换复制链接样式（当前：原文）
快捷键：U 循环；Alt+1 原文，Alt+2 %编码，Alt+3 富文本片段">链接样式：原文</div>
  <div class="ty-btn" id="ty-copyfmt" title="切换复制格式（当前：URL）
快捷键：M 切换；Alt+U URL，Alt+M Markdown" hidden="">复制为：URL</div>
  <div class="ty-btn" id="ty-expand" hidden="" title="大纲一键展开（E）">展开全部（E）</div>
  <div class="ty-btn" id="ty-collapse" hidden="" title="大纲一键收起（R）">收起全部（R）</div>
  <div class="ty-btn" id="ty-help" title="快速帮助（H）">帮助 / 快捷键（H）</div>
  <div class="ty-btn" id="ty-comments" title="显示/隐藏注释（C）">隐藏注释（C）</div>
</div>

<!-- 图片灯箱 -->
<div id="ty-lightbox" aria-modal="true" role="dialog">
  <!-- 左侧缩略图条 -->
  <div id="ty-lb-strip"></div>

  <!-- 顶部序号 -->
  <div id="ty-lb-count"></div>

  <img class="ty-lb-img" alt="">
  <div class="ty-lb-cap"></div>

  <!-- 底部动作按钮 -->
  <div id="ty-lb-actions">
    <div class="ty-act-btn" id="ty-lb-copy" title="复制图片链接">复制图片链接</div>
    <div class="ty-act-btn" id="ty-lb-fmt" title="切换复制格式（URL / Markdown）">复制为：URL</div>
    <div class="ty-act-btn" id="ty-lb-jump" title="跳转到文中该图片位置">跳转到文中</div>
  </div>

  <div class="ty-lb-prev">‹</div>
  <div class="ty-lb-next">›</div>
  <div class="ty-lb-close">✕</div>
</div>

<!-- 快速帮助浮层（保持不变） -->
<div id="ty-help-overlay" role="dialog" aria-modal="true" aria-label="快速帮助">
  <div class="ty-help-dialog">
    <div class="ty-help-close" id="ty-help-close" title="关闭（Esc）">✕</div>
    <h3>快速帮助</h3>
    <div class="ty-help-grid">
      <div>
        <h4>当前模式</h4>
        <p>链接样式：<b id="ty-help-cur-urlmode">—</b></p>
        <p>复制为：<b id="ty-help-cur-copyfmt">—</b></p>
      </div>
      <div>
        <h4>常用操作</h4>
        <p><kbd>#</kbd> 图标：复制段落链接 / 片段</p>
        <p>收起/展开大纲：<kbd>O</kbd>；回到顶部：<kbd>T</kbd></p>
        <p>显示/隐藏注释：<kbd>C</kbd></p>
      </div>
    </div>
    <h4>链接样式</h4>
    <ul>
      <li><b>原文</b>：<code>#段落</code>（<kbd>Alt</kbd>+<kbd>1</kbd>）</li>
      <li><b>%编码</b>：<code>#%E6%AE%B5%E8%90%BD</code>（<kbd>Alt</kbd>+<kbd>2</kbd>）</li>
      <li><b>富文本片段</b>（HTML 片段）（<kbd>Alt</kbd>+<kbd>3</kbd>）</li>
      <li>循环切换：<kbd>U</kbd></li>
    </ul>
    <h4>复制格式（仅“原文 / %编码”可用）</h4>
    <ul>
      <li>设为 <b>URL</b>：<kbd>Alt</kbd>+<kbd>U</kbd></li>
      <li>设为 <b>Markdown</b>：<kbd>Alt</kbd>+<kbd>M</kbd></li>
      <li>二者切换：<kbd>M</kbd></li>
    </ul>
    <h4>大纲与导航</h4>
    <ul>
      <li>展开全部：<kbd>E</kbd>；收起全部：<kbd>R</kbd></li>
      <li>滚动时自动高亮并展开对应大纲分支</li>
    </ul>
  </div>
</div>

<script>
(()=> {
  const $  = (s, r=document)=>r.querySelector(s);
  const $$ = (s, r=document)=>Array.from(r.querySelectorAll(s));

  const write       = $('#write') || document.body;
  const outlineRoot = $('.outline-content');

  /* ========== -1) 识别 WKWebView & MN4 窄窗标记：只影响 MN4，普通浏览器不变 ========== */
  const isWK = !!(window.webkit && window.webkit.messageHandlers);
  if (isWK) document.documentElement.classList.add('ty-wk');

  function applyMN4Narrow(){
    // 经验阈值：MN4 小窗常见 CSS 宽度 <= 1100
    const vw = Math.min(window.innerWidth || 0, document.documentElement.clientWidth || 0);
    const narrow = isWK && vw > 0 && vw <= 1100;
    document.documentElement.classList.toggle('mn4-narrow', !!narrow);

    // 在 MN4 窄窗时：确保目录逻辑被隐藏（与旧版行为一致）
    if (narrow) {
      document.body.classList.add('ty-outline-hidden');
      const side = document.querySelector('.typora-export-sidebar');
      if (side) side.style.display = 'none';
    }
  }
  applyMN4Narrow();
  window.addEventListener('resize', applyMN4Narrow, { passive:true });

  /* ========== 0) 工具栏抽屉：默认收起（仅图标按钮，避免重叠） ========== */
  const TOOLS_KEY = 'ty_tools_opened';
  const toolsTab  = $('#ty-tools-tab');
  function setToolsOpen(open){
    document.body.classList.toggle('ty-tools-collapsed', !open);
    toolsTab.title = open ? '收起工具栏' : '展开工具栏';
    toolsTab.querySelector('.ico').textContent = open ? '×' : '≡';
  }
  setToolsOpen(localStorage.getItem(TOOLS_KEY) === '1');
  toolsTab.addEventListener('click', ()=>{
    const nextOpen = document.body.classList.contains('ty-tools-collapsed');
    setToolsOpen(nextOpen);
    localStorage.setItem(TOOLS_KEY, nextOpen ? '1' : '0');
  });

  const toolsClose = $('#ty-tools-close');
  if (toolsClose) toolsClose.addEventListener('click', ()=>{
    setToolsOpen(false);               // 收起
    localStorage.setItem(TOOLS_KEY,'0');
  });

  /* ========== 1) 图片路径自动纠偏（图床通常不会触发） ========== */
  (function fixLocalImages(){
    const imgs = $$('img', write);
    const folders = ['.', 'assets', 'images', 'image', 'img', 'pics', '资源'];
    imgs.forEach(img=>{
      if (img.dataset && img.dataset.src && !img.src) img.src = img.dataset.src;
      try {
        const u = img.getAttribute('src') || '';
        if (u && !/^https?:/i.test(u)) {
          const d = decodeURI(u);
          const parts = d.split(/[/\\]/);
          const file  = parts.pop();
          if (file) {
            parts.push(encodeURIComponent(file));
            const enc = parts.join('/');
            if (enc !== u) img.src = enc;
          }
        }
      } catch(e){}
      img.addEventListener('error', ()=>{
        const original = img.getAttribute('data-src') || img.getAttribute('src') || '';
        const baseName = (original.split('?')[0]||'').split(/[\\/]/).pop();
        if (!baseName) return;
        const tried = new Set((img.dataset.tyTried||'').split('|').filter(Boolean));
        for (const folder of folders){
          const guess = (folder === '.') ? `./${baseName}` : `./${folder}/${baseName}`;
          if (tried.has(guess)) continue;
          tried.add(guess); img.dataset.tyTried = Array.from(tried).join('|'); img.src = guess; return;
        }
      });
    });
  })();

  /* ========== 2) 顶部阅读进度条 + 信息（百分比/时间） ========== */
  const bar = $('#ty-progress');
  const info = $('#ty-progress-info');
  const startAnchor = { t0: null };
  function fmtTime(sec){
    sec = Math.max(0, Math.floor(sec));
    const m = Math.floor(sec/60), s = sec%60;
    return String(m).padStart(2,'0') + ':' + String(s).padStart(2,'0');
  }
  function updateProgress(){
    const st = document.documentElement.scrollTop || document.body.scrollTop || 0;
    const sh = document.documentElement.scrollHeight || document.body.scrollHeight || 1;
    const max = Math.max(1, sh - window.innerHeight);
    const p = Math.min(1, st / max);
    bar.style.transform = 'scaleX(' + p + ')';
    const now = performance.now();
    if (startAnchor.t0 == null && st > 8) startAnchor.t0 = now;
    const pct = (p*100).toFixed(1);
    const elapsed = startAnchor.t0 ? (now - startAnchor.t0)/1000 : 0;
    info.innerHTML = `进度 <b>${pct}%</b> ｜ 已读 <b>${fmtTime(elapsed)}</b>`;
  }
  updateProgress();
  addEventListener('scroll', updateProgress, { passive:true });
  addEventListener('resize', updateProgress);

  /* ========== 3) 左侧大纲开合（保持） ========== */
  $('#ty-outline').addEventListener('click', ()=>{
    const hide = !document.body.classList.contains('ty-outline-hidden');
    document.body.classList.toggle('ty-outline-hidden', hide);
    document.body.classList.remove('typora-export-no-collapse-outline','typora-export-collapse-outline');
  });
  $('#ty-top').addEventListener('click', ()=> window.scrollTo({top:0, behavior:'smooth'}));

  /* ========== 4) 链接样式 & 复制格式（保持） ========== */
  const MODE_KEY = 'ty_url_mode';        // raw / encoded / rich
  const FMT_KEY  = 'ty_copy_fmt';        // url / md
  let urlMode = (localStorage.getItem(MODE_KEY) || 'raw');
  if (!['raw','encoded','rich'].includes(urlMode)) urlMode = 'raw';
  let copyFmt = (localStorage.getItem(FMT_KEY)  || 'url');

  const btnUrlMode = $('#ty-urlmode');
  const btnCopyFmt = $('#ty-copyfmt');

  function urlModeLabel(m){ return m==='encoded' ? '%编码' : (m==='rich' ? '富文本片段' : '原文'); }
  function renderHelp(){
    $('#ty-help-cur-urlmode').textContent = urlModeLabel(urlMode);
    $('#ty-help-cur-copyfmt').textContent = (urlMode === 'rich') ? '（富文本片段下不适用）' : (copyFmt === 'md' ? 'Markdown' : 'URL');
  }
  function updateUrlModeButton(){
    const label = urlModeLabel(urlMode);
    btnUrlMode.textContent = '链接样式：' + label;
    btnUrlMode.title = '切换复制链接样式（当前：' + label + '）\n快捷键：U 循环；Alt+1 原文，Alt+2 %编码，Alt+3 富文本片段';
    btnCopyFmt.hidden = (urlMode === 'rich');
    renderHelp();
  }
  function updateCopyFmtButton(){
    btnCopyFmt.textContent = '复制为：' + (copyFmt==='md' ? 'Markdown' : 'URL');
    btnCopyFmt.title = '切换复制格式（当前：' + (copyFmt==='md' ? 'Markdown' : 'URL') + '）\n快捷键：M 切换；Alt+U URL，Alt+M Markdown';
    renderHelp();
  }
  function baseURL(){ return (location.href.split('#')[0] || location.href); }
  function buildURL(id, encoded=false){
    return baseURL() + '#' + (encoded ? encodeURIComponent(id) : id);
  }
  function setUrlMode(mode){
    if (!['raw','encoded','rich'].includes(mode)) return;
    urlMode = mode; localStorage.setItem(MODE_KEY, urlMode); updateUrlModeButton();
  }
  function setCopyFmt(fmt){
    if (!['url','md'].includes(fmt)) return;
    copyFmt = fmt; localStorage.setItem(FMT_KEY, copyFmt); updateCopyFmtButton();
  }
  btnUrlMode.addEventListener('click', ()=>{ setUrlMode(urlMode==='raw' ? 'encoded' : (urlMode==='encoded' ? 'rich' : 'raw')); });
  btnCopyFmt.addEventListener('click', ()=>{ setCopyFmt(copyFmt==='url' ? 'md' : 'url'); });
  updateUrlModeButton(); updateCopyFmtButton();

  /* ========== 5) 一键展开/收起所有层级（保持） ========== */
  const btnExpand = $('#ty-expand'), btnCollapse = $('#ty-collapse');
  if (outlineRoot){ btnExpand.hidden = false; btnCollapse.hidden = false; }
  const allWrappers = ()=> $$('.outline-item-wrapper', outlineRoot);
  function expandAll(){ allWrappers().forEach(w=> w.classList.add('outline-item-open')); document.body.classList.remove('typora-export-no-collapse-outline','typora-export-collapse-outline'); }
  function collapseAll(){ allWrappers().forEach(w=> w.classList.remove('outline-item-open')); document.body.classList.remove('typora-export-no-collapse-outline','typora-export-collapse-outline'); }
  btnExpand.addEventListener('click', expandAll);
  btnCollapse.addEventListener('click', collapseAll);

  /* ========== 6) 大纲节点点击（保持） ========== */
  if (outlineRoot){
    outlineRoot.addEventListener('click', (e)=>{
      const expander = e.target.closest('.outline-expander');
      if (expander){
        e.preventDefault();
        const w = expander.closest('.outline-item-wrapper');
        if (w) w.classList.toggle('outline-item-open');
        return;
      }
      const label = e.target.closest('.outline-label');
      if (label && !label.closest('a')){
        const w = label.closest('.outline-item-wrapper');
        if (w) w.classList.toggle('outline-item-open');
      }
    });
  }

  /* ========== 7) 文本工具：干净标题；从文件名推断论文标题（保持） ========== */
  function getCleanHeadingText(h){
    const clone = h.cloneNode(true);
    clone.querySelectorAll('.ty-anchor,.ty-tip').forEach(n=> n.remove());
    return (clone.textContent || '').replace(/\s+/g,' ').trim();
  }
  function filenameDerivedTitle(){
    const name = decodeURIComponent((location.pathname.split('/').pop()||'').replace(/\.[^.]+$/,''));
    const noTs = name.replace(/([_-])\d{4}-\d{2}-\d{2}(?:([_-])\d{2}\2\d{2}\2\d{2})?$/,'');
    const underscoresToSpace = noTs.replace(/_/g,' ').trim();
    const m = underscoresToSpace.match(/^(\d{4})[ _-]+(.*)$/);
    if (m) {
      const year = m[1]; const rest = (m[2]||'').trim();
      return year + (rest ? '-' + rest : '');
    }
    return underscoresToSpace;
  }

  /* ========== 8) 标题锚点复制（三种样式 + 两种格式）（保持） ========== */
  const used = new Set();
  function slugify(text){
    const base = text.toLowerCase().trim()
      .replace(/[\u2000-\u206F\u2E00-\u2E7F'!"#$%&()*+,./:;<=>?@\[\]\\^_`{|}~]/g,'')
      .replace(/\s+/g,'-') || 'section';
    let s = base, i=2; while(used.has(s)) s = base + '-' + (i++); used.add(s); return s;
  }

  const idToItem = new Map();
  if(outlineRoot){
    const links = $$('a[href^="#"]', outlineRoot);
    links.forEach(a=>{
      const raw = a.getAttribute('href').slice(1);
      const id1 = raw, id2 = decodeURIComponent(raw);
      const li = a.closest('.outline-item-wrapper') || a.closest('.outline-item') || a;
      idToItem.set(id1, li); idToItem.set(id2, li);
    });
  }
  function outlinePathFor(id, fallbackTitle){
    if(!outlineRoot) return fallbackTitle || '';
    const node = idToItem.get(id);
    if(!node) return fallbackTitle || '';
    let w = node.closest('.outline-item-wrapper') || node, parts=[];
    while (w && w !== outlineRoot){
      const label = w.querySelector(':scope > .outline-item .outline-label') || w.querySelector('.outline-label');
      const txt = label ? label.textContent.trim().replace(/\s+/g,' ') : '';
      if (txt) parts.push(txt);
      w = w.parentElement && w.parentElement.closest ? w.parentElement.closest('.outline-item-wrapper') : null;
    }
    parts = parts.reverse();
    return parts.join(' / ');
  }
  function buildRichSnippet(headingId, headingText){
    const rawURL = buildURL(headingId, false);
    const encURL = buildURL(headingId, true);
    const docTitle = filenameDerivedTitle();
    const path = outlinePathFor(headingId, headingText);
    return [
`- <p style="background-color: rgb(255, 240, 243); color: black;">${docTitle}</p>`,
`- <p style="background-color: rgb(255, 248, 230); color: black;">${path}</p>`,
`- \`${headingText}\``,
'',
`<div style="background-color: rgb(245, 240, 255); border: 1px solid rgb(217, 195, 250); padding: 9px 14px; border-radius: 5px;">`,
`中文路径锚点 <a href="${rawURL}"><b>${headingText}</b></a> 。`,
`</div>`,
`<div style="background-color: rgb(240, 255, 244); border: 1px solid rgb(183, 235, 201); padding: 8px 12px; border-radius: 3px;">`,
`URL编码锚点 <a href="${encURL}"><b>${headingText}</b></a> 。`,
`</div>`
].join('\n');
  }

  const heads = $$('#write h1,#write h2,#write h3,#write h4,#write h5,#write h6');
  heads.forEach(h=>{
    if(!h.id || !h.id.trim()) h.id = slugify(getCleanHeadingText(h));

    const a   = document.createElement('a');
    const tip = document.createElement('span');
    a.className = 'ty-anchor'; a.textContent = '#'; a.href = '#' + h.id; a.title = '复制此段落链接';
    tip.className = 'ty-tip'; tip.textContent = '已复制段落链接';

    a.addEventListener('click', async (e)=>{
      e.preventDefault();
      const titleText = getCleanHeadingText(h);
      let copyText = '';

      if (urlMode === 'rich') {
        copyText = buildRichSnippet(h.id, titleText);
        tip.textContent = '已复制片段';
      } else {
        const urlRaw = (urlMode === 'encoded') ? buildURL(h.id, true) : buildURL(h.id, false);
        if (copyFmt === 'md') {
          copyText = `[${titleText}](${urlRaw})`;
          tip.textContent = '已复制 Markdown 链接';
        } else {
          copyText = urlRaw;
          tip.textContent = '已复制段落链接';
        }
      }

      try{ await navigator.clipboard.writeText(copyText); }
      catch{
        const ta=document.createElement('textarea'); ta.value=copyText;
        document.body.appendChild(ta); ta.select(); document.execCommand('copy'); document.body.removeChild(ta);
      }
      history.replaceState(null,'','#'+h.id);
      tip.style.opacity='1'; clearTimeout(tip._t); tip._t=setTimeout(()=> tip.style.opacity='0', 1000);
    });

    h.insertBefore(a, h.firstChild);
    h.appendChild(tip);
  });

  /* ========== 9) ScrollSpy：滚动高亮 + 自动展开（保持） ========== */
  let activeId = null;
  function ensureOpenFor(id){
    const node = idToItem.get(id); if(!node) return;
    let w = node.closest('.outline-item-wrapper') || node;
    while (w && w !== outlineRoot){
      w.classList.add('outline-item-open');
      w = w.parentElement && w.parentElement.closest ? w.parentElement.closest('.outline-item-wrapper') : null;
    }
  }
  function setActive(id){
    if(!outlineRoot || !id || id===activeId) return;
    activeId = id;
    outlineRoot.querySelectorAll('.active').forEach(el=> el.classList.remove('active'));
    const el = idToItem.get(id);
    if(el){
      el.classList.add('active');
      const link = el.querySelector('a[href="#'+CSS.escape(id)+'"]');
      if(link) link.classList.add('active');
      ensureOpenFor(id);
      el.scrollIntoView && el.scrollIntoView({block:'nearest'});
    }
  }
  function updateActiveByScroll(){
    const y = window.scrollY + 120;
    let cur = heads.length ? heads[0].id : null;
    for (const h of heads){ if(h.offsetTop <= y) cur = h.id; else break; }
    setActive(cur);
  }
  updateActiveByScroll();
  addEventListener('scroll', updateActiveByScroll, { passive:true });
  addEventListener('resize', updateActiveByScroll);

  /* ========== 10) 图片灯箱（缩略图点击不跳文；预留安全区防重叠） ========== */
  const lb = $('#ty-lightbox'), lbImg = $('.ty-lb-img', lb), lbCap = $('.ty-lb-cap', lb);
  const prevBtn = $('.ty-lb-prev', lb), nextBtn = $('.ty-lb-next', lb), closeBtn = $('.ty-lb-close', lb);
  const lbCount = $('#ty-lb-count'), lbStrip = $('#ty-lb-strip');
  const lbCopy  = $('#ty-lb-copy'),  lbFmt   = $('#ty-lb-fmt'),   lbJump = $('#ty-lb-jump');

  const IMG_FMT_KEY = 'ty_img_copy_fmt'; // url / md
  let imgCopyFmt = (localStorage.getItem(IMG_FMT_KEY) || 'url');
  function setImgCopyFmt(fmt){
    if (!['url','md'].includes(fmt)) return;
    imgCopyFmt = fmt; localStorage.setItem(IMG_FMT_KEY, fmt);
    lbFmt.textContent = '复制为：' + (fmt==='md'?'Markdown':'URL');
  }
  setImgCopyFmt(imgCopyFmt);

  let list=[], idx=-1, thumbsBuilt=false;

  function collectImages(){
    list = $$('#write img').filter(img=>{
      const w = img.naturalWidth || img.clientWidth;
      const h = img.naturalHeight || img.clientHeight;
      return (w*h) >= (48*48);
    });
  }
  function buildThumbs(){
    lbStrip.innerHTML = '';
    list.forEach((el,i)=>{
      const t = document.createElement('img');
      t.className = 'ty-thumb';
      const src = el.getAttribute('data-src') || el.currentSrc || el.src;
      t.src = src; t.alt=''; t.loading='lazy';
      t.setAttribute('data-idx', (i+1));
      // 点击缩略图：在画廊内切换到该图（不跳出）
      t.addEventListener('click', ()=> showAt(i));
      lbStrip.appendChild(t);
    });
    thumbsBuilt = true;
  }
  function updateThumbActive(){
    const thumbs = $$('.ty-thumb', lbStrip);
    thumbs.forEach(t=> t.classList.remove('active'));
    const cur = thumbs[idx]; if (cur) cur.classList.add('active');
  }
  function showAt(i){
    if(i<0 || i>=list.length) return;
    idx=i;
    const el=list[idx];
    const src = el.getAttribute('data-src') || el.currentSrc || el.src;
    const cap = el.getAttribute('alt') || el.title || '';
    lbImg.src=src; lbImg.alt=cap; lbCap.textContent=cap;
    lbCount.textContent = (idx+1) + ' / ' + list.length;
    updateThumbActive();
    lb.classList.add('open'); document.body.style.overflow='hidden';
  }
  function close(){ lb.classList.remove('open'); document.body.style.overflow=''; lbImg.src=''; lbImg.alt=''; }
  function prev(){ showAt((idx-1+list.length)%list.length); }
  function next(){ showAt((idx+1)%list.length); }

  // 文中点击图片 → 打开画廊（并构建缩略条）
  write.addEventListener('click', (e)=>{
    const target = e.target.closest && e.target.closest('img');
    if(!target) return;
    e.preventDefault();
    collectImages();
    if (!thumbsBuilt) buildThumbs();
    const i = list.indexOf(target);
    if(i>=0) showAt(i);
  });
  prevBtn.addEventListener('click', prev);
  nextBtn.addEventListener('click', next);
  closeBtn.addEventListener('click', close);
  lb.addEventListener('click', (e)=>{ if(e.target===lb) close(); });
  document.addEventListener('keydown', (e)=>{
    if(!lb.classList.contains('open')) return;
    if(e.key==='Escape') close();
    if(e.key==='ArrowLeft') prev();
    if(e.key==='ArrowRight') next();
  });

  // 复制图片链接（URL / Markdown）
  lbCopy.addEventListener('click', async ()=>{
    if(idx<0 || idx>=list.length) return;
    const el = list[idx];
    const src = el.getAttribute('data-src') || el.currentSrc || el.src;
    const txt = (imgCopyFmt==='md') ? `![](${src})` : src;
    try{ await navigator.clipboard.writeText(txt); lbCopy.textContent='已复制'; setTimeout(()=> lbCopy.textContent='复制图片链接', 900); }
    catch{
      const ta=document.createElement('textarea'); ta.value=txt;
      document.body.appendChild(ta); ta.select(); document.execCommand('copy'); document.body.removeChild(ta);
      lbCopy.textContent='已复制'; setTimeout(()=> lbCopy.textContent='复制图片链接', 900);
    }
  });
  lbFmt.addEventListener('click', ()=> setImgCopyFmt(imgCopyFmt==='url' ? 'md' : 'url'));
  // 跳回文中
  lbJump.addEventListener('click', ()=>{
    if(idx<0 || idx>=list.length) return;
    const el = list[idx];
    close();
    el.scrollIntoView({behavior:'smooth', block:'center'});
    el.classList.add('ty-img-flash');
    setTimeout(()=> el.classList.remove('ty-img-flash'), 1300);
  });

  /* ========== 11) 帮助浮层（保持） ========== */
  const helpOverlay = $('#ty-help-overlay');
  const helpClose   = $('#ty-help-close');
  const helpBtn     = $('#ty-help');
  function openHelp(){
    renderHelp();
    helpOverlay.classList.add('open');
    document.body.style.overflow = 'hidden';
  }
  function closeHelp(){
    helpOverlay.classList.remove('open');
    document.body.style.overflow = '';
  }
  helpBtn.addEventListener('click', openHelp);
  helpClose.addEventListener('click', closeHelp);
  helpOverlay.addEventListener('click', (e)=>{ if(e.target === helpOverlay) closeHelp(); });

  /* ========== 12) 快捷键（白名单：仅单键 & Alt 组合；其它全部放行） ========== */
  document.addEventListener('keydown', (e)=>{
    const tag = (e.target && e.target.tagName || '').toLowerCase();
    const inEditable = !!(e.target && (e.target.isContentEditable || /^(input|textarea|select)$/i.test(tag)));
    if (inEditable) return;

    if (e.getModifierState && (e.getModifierState('AltGraph') || e.getModifierState('OS'))) return;

    const k    = (e.key || '').toLowerCase();
    const code = e.code || '';

    // Alt-only 组合：Alt+1/2/3/U/M
    if (e.altKey && !e.ctrlKey && !e.metaKey && !e.shiftKey) {
      if (code==='Digit1' || code==='Numpad1' || k==='1') { e.preventDefault(); setUrlMode('raw');     return; }
      if (code==='Digit2' || code==='Numpad2' || k==='2') { e.preventDefault(); setUrlMode('encoded'); return; }
      if (code==='Digit3' || code==='Numpad3' || k==='3') { e.preventDefault(); setUrlMode('rich');    return; }
      if (!btnCopyFmt.hidden && code==='KeyU') { e.preventDefault(); setCopyFmt('url'); return; }
      if (!btnCopyFmt.hidden && code==='KeyM') { e.preventDefault(); setCopyFmt('md');  return; }
      return;
    }

    // 包含 Ctrl/Cmd/Shift 的组合：放行
    if (e.ctrlKey || e.metaKey || e.shiftKey) return;

    // 单键白名单
    const SINGLE = new Set(['o','t','e','r','u','m','c','h']);
    if (SINGLE.has(k)) {
      e.preventDefault();
      if (k==='o') $('#ty-outline')?.click();
      else if (k==='t') $('#ty-top')?.click();
      else if (k==='e') $('#ty-expand')?.click();
      else if (k==='r') $('#ty-collapse')?.click();
      else if (k==='u') $('#ty-urlmode')?.click();
      else if (k==='m' && !btnCopyFmt.hidden) $('#ty-copyfmt')?.click();
      else if (k==='c') $('#ty-comments')?.click();
      else if (k==='h') openHelp();
      return;
    }

    // Esc 仅在帮助打开时拦截
    if (k==='escape' && helpOverlay.classList.contains('open')) { e.preventDefault(); closeHelp(); }
  });

  /* ========== 13) 将 HTML 注释转为可见元素 + 开关（保持） ========== */
  const btnComments = $('#ty-comments');
  let tyCmtInited = false;
  function injectCommentsOnce(){
    if (tyCmtInited) return;
    tyCmtInited = true;
    const walker = document.createTreeWalker(write, NodeFilter.SHOW_COMMENT, null, false);
    const nodes = [];
    for (let n = walker.nextNode(); n; n = walker.nextNode()) nodes.push(n);

    nodes.forEach(cmt=>{
      const txt = (cmt.data || '').trim();
      if (!txt) return;
      const span = document.createElement('span');
      span.className = 'ty-cmt';
      span.textContent = txt;
      cmt.parentNode && cmt.parentNode.insertBefore(span, cmt);
    });
    if (!write.querySelector('.ty-cmt')) btnComments.hidden = true;
  }
  injectCommentsOnce();
  document.body.classList.remove('ty-cmt-hidden');
  btnComments.textContent = '隐藏注释（C）';
  btnComments.title = '显示/隐藏注释（C）';
  btnComments.addEventListener('click', ()=>{
    injectCommentsOnce();
    const hide = !document.body.classList.contains('ty-cmt-hidden');
    document.body.classList.toggle('ty-cmt-hidden', hide);
    btnComments.textContent = hide ? '显示注释（C）' : '隐藏注释（C）';
  });
})();
</script></body>
</html>